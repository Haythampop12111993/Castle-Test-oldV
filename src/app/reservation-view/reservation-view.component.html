<ng-container *ngIf="reservation_details">
  <section class="unit">
    <div class="container-fluid">
      <h2>Reservation</h2>
      <div class="row">
        <div class="col-xs-12"></div>
        <div class="col-xs-12">
          <div class="lead-details">
            <div class="header-lead">
              <div class="row">
                <div class="col-md-9">
                  <div class="media">
                    <div class="media-left">
                      <a>
                        {{ reservation_details?.status?.substr(0, 6) }}
                      </a>
                    </div>
                    <div class="media-body">
                      <h3>
                        Reservation [{{ reservation_details?.unit.serial }}]
                        <span>#{{ reservation_details?.id }}</span>
                        <span>
                          Financial Position:
                          {{
                            this.reservation_details.financial_position == "0"
                              ? "مسدد بالكامل"
                              : this.reservation_details.financial_position +
                                "اقساط متاخرة"
                          }}
                        </span>
                      </h3>
                      <div class="row">
                        <div class="col-xs-4">
                          <ul class="list-unstyled">
                            <li *ngIf="reservation_details?.status">
                              Status: {{ reservation_details?.status }}
                            </li>
                            <li *ngIf="reservation_details?.contract_type">
                              Contract Type:
                              {{ reservation_details?.contract_type }}
                            </li>
                            <li *ngIf="reservation_details?.unit?.serial">
                              Unit Serial :
                              {{ reservation_details?.unit.serial }}
                            </li>
                            <li
                              *ngIf="reservation_details?.unit?.phase?.serial"
                            >
                              phase:
                              {{ reservation_details?.unit?.phase?.serial }}
                            </li>
                            <li *ngIf="reservation_details?.unit.building_num">
                              Building Number:
                              {{ reservation_details?.unit.building_num }}
                            </li>
                            <li *ngIf="reservation_details?.unit?.design_type">
                              Design Type:
                              {{ reservation_details?.unit?.design_type }}
                            </li>

                            <li>
                              Type:
                              {{ reservation_details?.unit.unit_type?.name }}
                            </li>
                            <!-- <li>Price: {{reservation_details?.unit_price | currency: ' '}}</li> -->
                          </ul>
                        </div>
                        <div class="col-xs-4">
                          <ul class="list-unstyled">
                            <li>
                              Gross Area:
                              {{ reservation_details?.unit_building_area }} M
                              <sup>2</sup>
                            </li>
                            <li *ngIf="reservation_details?.unit.floor_number">
                              Floor:
                              {{ reservation_details?.unit.floor_number }}
                            </li>
                            <li *ngIf="reservation_details?.unit?.num_rooms">
                              Rooms: {{ reservation_details?.unit?.num_rooms }}
                            </li>
                            <li
                              *ngIf="reservation_details?.finishing_type?.name"
                            >
                              Finishing Type:
                              {{ reservation_details?.finishing_type?.name }}
                            </li>
                            <li *ngIf="reservation_details?.indoor_meter_price">
                              Indoor Meter Price:
                              {{
                                reservation_details?.indoor_meter_price
                                  | currency : " "
                              }}
                              <sup>EGP</sup>
                            </li>
                            <li
                              *ngIf="reservation_details?.outdoor_meter_price"
                            >
                              Outdoor Meter Price:
                              {{
                                reservation_details?.outdoor_meter_price
                                  | currency : " "
                              }}
                              <sup>EGP</sup>
                            </li>
                            <li *ngIf="reservation_details?.unit.land_area">
                              Land Area:
                              {{ reservation_details?.unit.land_area }} M
                              <sup>2</sup>
                            </li>
                            <li *ngIf="reservation_details?.unit?.roof_area">
                              Roof Area:
                              {{ reservation_details?.unit?.roof_area }} M
                              <sup>2</sup>
                            </li>
                            <li *ngIf="reservation_details?.unit.garage_area">
                              Garage Area:
                              {{ reservation_details?.unit.garage_area }} M
                              <sup>2</sup>
                            </li>
                            <li *ngIf="reservation_details?.unit.garden_area">
                              Garden Area:
                              {{ reservation_details?.unit.garden_area }} M
                              <sup>2</sup>
                            </li>
                          </ul>
                        </div>
                        <div class="col-xs-4">
                          <ul class="list-unstyled">
                            <li *ngIf="reservation_details?.unit_price">
                              Selling Price:
                              {{
                                reservation_details?.unit_price | currency : " "
                              }}
                            </li>
                            <li *ngIf="reservation_details?.origin_price">
                              Origin Price:
                              {{
                                reservation_details?.origin_price
                                  | currency : " "
                              }}
                            </li>
                            <li
                              *ngIf="
                                reservation_details?.unit_maintenance_price
                              "
                            >
                              Maintenance Fees:
                              {{
                                reservation_details?.unit_maintenance_price
                                  | currency : " "
                              }}
                              <sup>EGP</sup>
                            </li>
                            <li *ngIf="reservation_details?.slots">
                              Number of Garage Slots:
                              {{ reservation_details?.slots }}
                            </li>
                            <li *ngIf="reservation_details?.unit_garage_price">
                              Total Garage Price :
                              {{
                                reservation_details?.unit_garage_price
                                  | currency : " "
                              }}
                            </li>
                            <li>
                              Extra Slots:
                              {{ reservation_details?.extra_slots }}
                            </li>
                            <li>
                              Extra Garage Slots Price:
                              {{ reservation_details?.extra_garage_slots_price }}
                            </li>
                            <li
                              *ngIf="reservation_details?.extra_outdoor_meters"
                            >
                              Extra Outdoor Meters:
                              {{ reservation_details?.extra_outdoor_meters }}
                            </li>
                            <li
                              *ngIf="
                                reservation_details?.extra_outdoor_meters_price
                              "
                            >
                              Total Extra Outdoor Meters Price:
                              {{
                                reservation_details?.extra_outdoor_meters_price
                              }}
                            </li>
                            <li *ngIf="reservation_details?.storage_slots">
                              Number of Storage Slots:
                              {{ reservation_details?.storage_slots }}
                            </li>
                            <li>
                              Total Storage Price :
                              {{
                                reservation_details?.unit_storage_price
                                  | currency : " "
                              }}
                            </li>
                          </ul>
                        </div>
                        <div
                          class="col-12"
                          *ngIf="reservation_details?.comment"
                        >
                          <div>Comment: {{ reservation_details?.comment }}</div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="col-md-3 operation-container"></div>
              </div>
            </div>

            <div class="lead-content-section">
              <div>
                <!-- Nav tabs -->
                <ul class="nav nav-tabs" role="tablist">
                  <li role="presentation" class="active">
                    <a
                      href="#customer-info"
                      aria-controls="customer-info"
                      role="tab"
                      data-toggle="tab"
                      >Customer / Unit Info</a
                    >
                  </li>
                  <li role="presentation">
                    <a
                      href="#contract_rent_info"
                      aria-controls="contract_rent_info"
                      role="tab"
                      data-toggle="tab"
                      >Contract Info</a
                    >
                  </li>
                  <li role="presentation">
                    <a
                      href="#deal-type"
                      aria-controls="deal-type"
                      role="tab"
                      data-toggle="tab"
                      >Deal Type</a
                    >
                  </li>
                  <li role="presentation">
                    <a
                      href="#accountant-information"
                      aria-controls="accountant-information"
                      role="tab"
                      data-toggle="tab"
                      >Accountant Information</a
                    >
                  </li>
                  <li role="presentation">
                    <a
                      href="#contract-tracking"
                      aria-controls="contract-tracking"
                      role="tab"
                      data-toggle="tab"
                    >
                      Contract Document
                    </a>
                  </li>
                  <li role="presentation">
                    <a
                      href="#lead-info"
                      aria-controls="lead-info"
                      role="tab"
                      data-toggle="tab"
                    >
                      P.C Info
                    </a>
                  </li>
                  <li
                    role="presentation"
                    *ngIf="
                      userProfile.role === 'Admin' ||
                      userProfile.role == 'Super Development'
                    "
                  >
                    <a
                      href="#comment"
                      aria-controls="comment"
                      role="tab"
                      data-toggle="tab"
                    >
                      Comment
                    </a>
                  </li>
                  <li role="presentation">
                    <a
                      href="#unit-layout"
                      aria-controls="unit-layout"
                      role="tab"
                      data-toggle="tab"
                    >
                      Unit Layout
                    </a>
                  </li>
                  <li
                    role="presentation"
                    *ngIf="
                      userProfile.role != 'CCO' &&
                      userProfile.role != 'Development Director'
                    "
                  >
                    <a
                      href="#activity-log"
                      aria-controls="activity-log"
                      role="tab"
                      data-toggle="tab"
                    >
                      Activity Log
                    </a>
                  </li>
                  <li
                    role="presentation"
                    *ngIf="
                      userProfile?.role == 'Admin' ||
                      userProfile.role == 'Super Development' ||
                      userProfile.role == 'CCO' ||
                      userProfile.role == 'Development Director' ||
                      userProfile?.role == 'Accountant' ||
                      userProfile?.role == 'AR Manager' ||
                      userProfile?.role == 'A.R Accountant' ||
                      userProfile?.role == 'Treasury Accountant'
                    "
                  >
                    <a
                      href="#payment-collections"
                      aria-controls="payment-collections"
                      role="tab"
                      data-toggle="tab"
                    >
                      Cheques Book
                    </a>
                  </li>
                  <li
                    role="presentation"
                    *ngIf="
                      userProfile?.role == 'Admin' ||
                      userProfile.role == 'Super Development' ||
                      userProfile?.role == 'CFO' ||
                      userProfile.role == 'CCO' ||
                      userProfile?.role == 'A.R Accountant' ||
                      userProfile?.role == 'Treasury Accountant' ||
                      userProfile?.role == 'G.L Accountant'
                    "
                  >
                    <a
                      href="#fines"
                      aria-controls="fines"
                      role="tab"
                      data-toggle="tab"
                    >
                      Fines
                    </a>
                  </li>
                  <li
                    role="presentation"
                    *ngIf="
                      (userProfile?.role == 'Moderator' ||
                        userProfile?.role == 'Super Moderator' ||
                        userProfile?.role == 'Admin' ||
                        userProfile.role == 'Super Development' ||
                        userProfile?.role == 'Accountant' ||
                        userProfile?.role == 'AR Manager' ||
                        userProfile?.role == 'A.R Accountant' ||
                        userProfile?.role == 'Treasury Accountant') &&
                      userProfile.role != 'CCO' &&
                      userProfile.role != 'Development Director' &&
                      userProfile.role != 'Legal and Technical' &&
                      userProfile.role != 'Facility' &&
                      !isReadonlyMode
                    "
                  >
                    <a
                      href="#Final-payment-plan"
                      aria-controls="Final-payment-plan"
                      role="tab"
                      data-toggle="tab"
                    >
                      Final payment plan
                    </a>
                  </li>
                  <li
                    role="presentation"
                    *ngIf="
                      (userProfile?.role == 'Moderator' ||
                        userProfile?.role == 'Super Moderator' ||
                        userProfile?.role == 'Admin' ||
                        userProfile.role == 'Super Development') &&
                      userProfile.role != 'CCO' &&
                      userProfile.role != 'Development Director' &&
                      userProfile.role != 'Legal and Technical' &&
                      userProfile.role != 'Facility'
                    "
                  >
                    <a
                      href="#shared-comissions"
                      aria-controls="shared-comissions"
                      role="tab"
                      data-toggle="tab"
                    >
                      Shared Comissions
                    </a>
                  </li>
                  <li
                    role="presentation"
                    *ngIf="
                      reservation_details?.authorization
                        ?.can_see_documents_tab == 1
                    "
                  >
                    <a
                      href="#documents"
                      aria-controls="documents"
                      role="tab"
                      data-toggle="tab"
                    >
                      Documents
                    </a>
                  </li>
                  <li
                    role="presentation"
                    *ngIf="
                      userProfile.role == 'Helpdesk Supervisor' ||
                      userProfile.role == 'Super Moderator' ||
                      userProfile.role == 'Moderator' ||
                      userProfile.role == 'Departmen Head' ||
                      userProfile.role == 'Admin' ||
                      userProfile.role == 'Legal and Technical' ||
                      userProfile.role == 'Legal Head' ||
                      userProfile.role == 'Legal Agent' ||
                      userProfile.role == 'Super Development' ||
                      userProfile.role == 'CCO' ||
                      userProfile.role == 'Development Director' ||
                      userProfile.role == 'Helpdesk Agent' ||
                      userProfile.role == 'A.R Manager' ||
                      userProfile.role == 'Call Center'
                    "
                  >
                    <a
                      href="#tickets"
                      aria-controls="tickets"
                      role="tab"
                      data-toggle="tab"
                    >
                      Tickets
                    </a>
                  </li>
                  <li
                    role="presentation"
                    *ngIf="
                      reservation_details?.authorization
                        ?.can_see_documents_tab == 1
                    "
                  >
                    <a
                      href="#referrals"
                      aria-controls="referrals"
                      role="tab"
                      data-toggle="tab"
                    >
                      Referrals
                    </a>
                  </li>
                  <li role="presentation">
                    <a
                      href="#acknowledgement"
                      aria-controls="acknowledgement"
                      role="tab"
                      data-toggle="tab"
                    >
                      Acknowledgement
                    </a>
                  </li>
                  <li role="presentation" *ngIf="userProfile?.role == 'Admin'">
                    <a
                      href="#resale"
                      aria-controls="resale"
                      role="tab"
                      data-toggle="tab"
                    >
                      Resale
                    </a>
                  </li>
                  <li
                    role="presentation"
                    *ngIf="
                      userProfile.role == 'Admin' ||
                      userProfile.role == 'Moderator' ||
                      userProfile.role == 'A.R Manger' ||
                      userProfile.role == 'Legal and Technical' ||
                      userProfile.role == 'Legal Head' ||
                      userProfile.role == 'Legal Agent' ||
                      userProfile.role == 'Super Moderator' ||
                      userProfile.role == 'CRM Supervisor' ||
                      userProfile.role == 'CRM Agent' ||
                      userProfile.role == 'Helpdesk Supervisor' ||
                      userProfile.role == 'Helpdesk Agent' ||
                      userProfile.role == 'Treasury Accountant' ||
                      userProfile.role == 'A.R Accountant' ||
                      userProfile.role == 'G.L Accountant'
                    "
                  >
                    <a
                      href="#legal_action"
                      aria-controls="legal_action"
                      role="tab"
                      data-toggle="tab"
                    >
                      Legal Action
                    </a>
                  </li>
                  <li
                    role="presentation"
                    *ngIf="
                      userProfile.email == 'fabricasupport@castle.com' ||
                      userProfile.email == 'f.shaker@cred-eg.com' ||
                      userProfile.email == 'm.badr@cred-eg.com' ||
                      userProfile.role == 'Helpdesk Agent' ||
                      userProfile.role == 'Helpdesk Supervisor'
                    "
                  >
                    <a
                      href="#handover_status"
                      aria-controls="handover_status"
                      role="tab"
                      data-toggle="tab"
                    >
                      Handover Status
                    </a>
                  </li>
                </ul>
                <!-- Tab panes -->
                <div class="tab-content">
                  <div
                    role="tabpanel"
                    class="tab-pane fade in active"
                    id="customer-info"
                  >
                    <div class="box-mrg">
                      <div class="row-elements">
                        <div class="column">
                          <div>
                            <mat-expansion-panel
                              *ngFor="
                                let lead of reservation_details?.sharing_leads
                              "
                              style="margin-bottom: 15px"
                            >
                              <mat-expansion-panel-header>
                                <span
                                  class="accordion_header"
                                  *ngIf="lead?.lead_name"
                                >
                                  <strong> Customer Name : </strong>
                                  {{ lead?.lead_name }}
                                  <span class="vip" *ngIf="lead?.lead?.is_vip"
                                    >VIP</span
                                  >
                                </span>
                                <span
                                  class="accordion_header"
                                  *ngIf="lead?.lead_phone"
                                >
                                  <strong class="customer-phone">
                                    Customer Phone :
                                  </strong>
                                  {{ lead?.lead_phone }}
                                </span>
                                <span
                                  class="accordion_header"
                                  *ngIf="reservation_details?.legal_type_text"
                                >
                                  <strong class="customer-phone">
                                    Legal Action :
                                  </strong>
                                  <span class="p-3 bg-danger">
                                    {{ reservation_details?.legal_type_text }}
                                  </span>
                                </span>
                              </mat-expansion-panel-header>
                              <div class="row">
                                <div class="col-xs-6">
                                  <ul class="list-unstyled">
                                    <li class="row" *ngIf="lead?.lead_email">
                                      <div class="col-xs-6">
                                        Customer Email :
                                      </div>
                                      <div class="col-xs-6">
                                        {{ lead?.lead_email }}
                                      </div>
                                    </li>
                                    <li
                                      class="row"
                                      *ngIf="lead?.lead_national_id"
                                    >
                                      <div class="col-xs-6">
                                        Customer National ID :
                                      </div>
                                      <div class="col-xs-6">
                                        {{ lead?.lead_national_id }}
                                      </div>
                                    </li>
                                    <li
                                      class="row"
                                      *ngIf="lead?.lead_nationality"
                                    >
                                      <div class="col-xs-6">
                                        Customer Nationality :
                                      </div>
                                      <div class="col-xs-6">
                                        {{ lead?.lead_nationality }}
                                      </div>
                                    </li>
                                    <li
                                      class="row"
                                      *ngIf="lead?.lead_religion"
                                    >
                                      <div class="col-xs-6">
                                        Customer Religion :
                                      </div>
                                      <div class="col-xs-6">
                                        {{ lead?.lead_religion }}
                                      </div>
                                    </li>
                                    <li
                                      class="row"
                                      *ngIf="lead?.lead_gender"
                                    >
                                      <div class="col-xs-6">
                                        Customer Gender :
                                      </div>
                                      <div class="col-xs-6">
                                        {{ lead?.lead_gender }}
                                      </div>
                                    </li>
                                    <li
                                      class="row"
                                      *ngIf="lead?.lead_other_phone"
                                    >
                                      <div class="col-xs-6">
                                        Customer Other Phone :
                                      </div>
                                      <div class="col-xs-6">
                                        {{ lead?.lead_other_phone }}
                                      </div>
                                    </li>
                                    <li
                                      class="row"
                                      *ngIf="lead?.lead?.byc?.name"
                                    >
                                      <div class="col-xs-6">BYC Name :</div>
                                      <div class="col-xs-6">
                                        <a
                                          (click)="
                                            goToLead(lead?.lead?.byc?.id)
                                          "
                                          >{{ lead?.lead?.byc?.name }}</a
                                        >
                                      </div>
                                    </li>
                                    <li
                                      class="row"
                                      *ngIf="lead?.lead?.byc?.phone"
                                    >
                                      <div class="col-xs-6">BYC Phone :</div>
                                      <div class="col-xs-6">
                                        {{ lead?.lead?.byc?.phone }}
                                      </div>
                                    </li>
                                  </ul>
                                </div>
                                <div class="col-xs-6">
                                  <ul class="list-unstyled">
                                    <li class="row" *ngIf="lead?.lead_birthday">
                                      <div class="col-xs-6">
                                        Customer Birthday :
                                      </div>
                                      <div class="col-xs-6">
                                        {{ lead?.lead_birthday }}
                                      </div>
                                    </li>
                                    <li class="row" *ngIf="lead?.lead_address">
                                      <div class="col-xs-6">
                                        Customer Address :
                                      </div>
                                      <div class="col-xs-6">
                                        {{ lead?.lead_address }}
                                      </div>
                                    </li>
                                    <li class="row" *ngIf="lead?.lead_district">
                                      <div class="col-xs-6">
                                        Customer District :
                                      </div>
                                      <div class="col-xs-6">
                                        {{ lead?.lead_district }}
                                      </div>
                                    </li>
                                    <li
                                      class="row"
                                      *ngIf="lead?.sharing_percentage"
                                    >
                                      <div class="col-xs-6">
                                        Sharing Percentage :
                                      </div>
                                      <div class="col-xs-6">
                                        {{ lead?.sharing_percentage }}
                                      </div>
                                    </li>
                                    <li
                                      class="row"
                                      *ngIf="lead?.lead_country"
                                    >
                                      <div class="col-xs-6">
                                        Countery :
                                      </div>
                                      <div class="col-xs-6">
                                        {{ lead?.lead_country }}
                                      </div>
                                    </li>
                                    <li
                                      class="row"
                                      *ngIf="lead?.lead_age"
                                    >
                                      <div class="col-xs-6">
                                        Age :
                                      </div>
                                      <div class="col-xs-6">
                                        {{ lead?.lead_age }}
                                      </div>
                                    </li>
                                  </ul>
                                </div>
                                <div
                                  class="col-xs-12"
                                  style="text-align: right"
                                  *ngIf="
                                    userProfile.role != 'CCO' &&
                                    userProfile.role !=
                                      'Development Director' &&
                                    userProfile.role != 'Facility'
                                  "
                                >
                                  <button
                                    class="btn btn-primary"
                                    *ngIf="
                                      userProfile.role != 'Super Development'
                                    "
                                    (click)="editSingleLead.open(lead?.lead_id)"
                                    style="
                                      margin-right: 5px;
                                      background-color: #555;
                                      color: white;
                                    "
                                  >
                                    Edit Customer info
                                  </button>

                                  <button
                                    class="btn"
                                    (click)="deleteLead(lead?.id)"
                                    *ngIf="
                                      userProfile.role != 'CCO' &&
                                      userProfile.role !=
                                        'Development Director' &&
                                      userProfile.role !=
                                        'Legal and Technical' &&
                                      userProfile.role != 'Facility' &&
                                      userProfile.role != 'Super Development'
                                    "
                                    [disabled]="
                                      reservation_details?.sharing_leads
                                        .length == 1
                                    "
                                  >
                                    Delete
                                  </button>
                                </div>
                              </div>
                              <modal
                                #editSingleLead
                                title="Edit Customer Info"
                                submitButtonLabel="save"
                                modalClass="modal-md"
                                [hideCloseButton]="true"
                                [closeOnOutsideClick]="true"
                                (onOpen)="editLeadModalModalOpen(lead?.lead_id)"
                                (onClose)="
                                  editLeadModalModalClose(lead?.lead_id)
                                "
                                (onSubmit)="
                                  editLeadModalSubmit(
                                    lead?.lead_id,
                                    editSingleLead
                                  )
                                "
                              >
                                <modal-header> </modal-header>
                                <modal-content>
                                  <div class="row">
                                    <div class="col-md-6">
                                      <div class="form-group">
                                        <label for="">Customer Name</label>
                                        <input
                                          type="text"
                                          name="lead_name"
                                          [(ngModel)]="edit_lead_data.lead_name"
                                          class="form-control"
                                        />
                                      </div>
                                    </div>
                                    <div class="col-md-6">
                                      <div class="form-group">
                                        <label for="">Customer Phone</label>
                                        <input
                                          type="tel"
                                          name="lead_phone"
                                          [(ngModel)]="
                                            edit_lead_data.lead_phone
                                          "
                                          class="form-control"
                                        />
                                      </div>
                                    </div>
                                  </div>

                                  <div class="row">
                                    <div class="col-md-6">
                                      <div class="form-group">
                                        <label for="">Customer Email</label>
                                        <input
                                          type="text"
                                          name="lead_email"
                                          [(ngModel)]="
                                            edit_lead_data.lead_email
                                          "
                                          class="form-control"
                                        />
                                      </div>
                                    </div>
                                    <div class="col-md-6">
                                      <div class="form-group">
                                        <label for=""
                                          >Customer National ID</label
                                        >
                                        <input
                                          type="text"
                                          name="lead_national_id"
                                          [(ngModel)]="
                                            edit_lead_data.lead_national_id
                                          "
                                          class="form-control"
                                        />
                                      </div>
                                    </div>
                                  </div>

                                  <div class="row">
                                    <div class="col-md-6">
                                      <div class="form-group">
                                        <label for=""
                                          >Customer Nationality</label
                                        >
                                        <input
                                          type="text"
                                          name="lead_nationality"
                                          [(ngModel)]="
                                            edit_lead_data.lead_nationality
                                          "
                                          class="form-control"
                                        />
                                      </div>
                                    </div>
                                    <div class="col-md-6">
                                      <div class="form-group">
                                        <label for="">Customer Religion</label>
                                        <ng-select
                                          name="religion"
                                          placeholder="Select Religion"
                                          [(ngModel)]="edit_lead_data.lead_religion"
                                        >
                                          <ng-option value="Muslim">Muslim</ng-option>
                                          <ng-option value="Christian">Christian</ng-option>
                                        </ng-select>
                                      </div>
                                    </div>
                                  </div>

                                  <div class="row">
                                    <div class="col-md-6">
                                      <div class="form-group">
                                        <label for=""
                                          >Customer Other Phone</label
                                        >
                                        <input
                                          type="text"
                                          name="lead_other_phone"
                                          [(ngModel)]="
                                            edit_lead_data.lead_other_phone
                                          "
                                          class="form-control"
                                        />
                                      </div>
                                    </div>
                                    <div class="col-md-6">
                                      <div class="form-group">
                                        <label for="">Customer Address</label>
                                        <input
                                          type="text"
                                          name="lead_address"
                                          [(ngModel)]="
                                            edit_lead_data.lead_address
                                          "
                                          class="form-control"
                                        />
                                      </div>
                                    </div>
                                  </div>

                                  <div class="row">
                                    <div class="col-md-6">
                                      <div class="form-group">
                                        <label for="">Customer District</label>
                                        <input
                                          type="text"
                                          name="lead_district"
                                          [(ngModel)]="
                                            edit_lead_data.lead_district
                                          "
                                          class="form-control"
                                        />
                                      </div>
                                    </div>
                                    <div class="col-md-6">
                                      <div class="form-group">
                                        <label for="">Sharing Percentage</label>
                                        <input
                                          type="text"
                                          name="sharing_percentage"
                                          [(ngModel)]="
                                            edit_lead_data.sharing_percentage
                                          "
                                          class="form-control"
                                        />
                                      </div>
                                    </div>
                                  </div>

                                  <div class="row">
                                    <div class="col-md-6">
                                      <div class="form-group">
                                        <label for="">Gender</label>
                                        <ng-select
                                          name="lead_country"
                                          placeholder="Select Country"
                                          [(ngModel)]="edit_lead_data.lead_gender"
                                        >
                                          <ng-option value="Male">Male</ng-option>
                                          <ng-option value="Female">Female</ng-option>
                                        </ng-select>
                                      </div>
                                    </div>
                                    <div class="col-md-6">
                                      <div class="form-group">
                                        <label for="">Countery</label>
                                        <ng-select
                                          name="lead_country"
                                          placeholder="Select Country"
                                          [(ngModel)]="edit_lead_data.lead_country"
                                        >
                                          <ng-option
                                            *ngFor="let country of countries"
                                            [value]="country.country"
                                          >
                                            {{ country.country }}
                                          </ng-option>
                                        </ng-select>
                                      </div>
                                    </div>
                                    <div class="col-md-6">
                                      <div class="form-group">
                                        <label for="">Customer Birthday</label>
                                        <input
                                          type="text"
                                          name="lead_birthday"
                                          [(ngModel)]="
                                            edit_lead_data.lead_birthday
                                          "
                                          class="form-control"
                                        />
                                      </div>
                                    </div>
                                  </div>
                                </modal-content>
                                <modal-footer>
                                  <button
                                    class="btn btn-secondary"
                                    (click)="editSingleLead.close()"
                                  >
                                    close
                                  </button>
                                </modal-footer>
                              </modal>
                            </mat-expansion-panel>

                            <!-- <ul class="list-unstyled">
                            <li class="row">
                              <div class="col-xs-6">Customer Name :</div>
                              <div class="col-xs-6">
                                {{ reservation_details?.lead_name }}
                              </div>
                            </li>
                            <li class="row">
                              <div class="col-xs-6">Admin Decline Reason :</div>
                              <div class="col-xs-6">
                                {{ reservation_details?.refund_reason }}
                              </div>
                            </li>
                            <li class="row">
                              <div class="col-xs-6">Lead Nationality :</div>
                              <div class="col-xs-">
                                {{ reservation_details?.lead_nationality }}
                              </div>
                            </li>
                            <li class="row">
                              <div class="col-xs-6">Lead National ID :</div>
                              <div class="col-xs-">
                                {{ reservation_details?.lead_national_id }}
                              </div>
                            </li>
                            <li class="row">
                              <div class="col-xs-6">Admin Confirmation :</div>
                              <div class="col-xs-">
                                {{ reservation_details?.admin_confirmation }}
                              </div>
                            </li>
                            <li class="row">
                              <div class="col-xs-6">
                                Admin Confirmation Date :
                              </div>
                              <div class="col-xs-">
                                {{ reservation_details?.admin_confirmation_date }}
                              </div>
                            </li>
                            <li class="row">
                              <div class="col-xs-6">Refund Date :</div>
                              <div class="col-xs-">
                                {{ reservation_details?.refund_date }}
                              </div>
                            </li>
                            <li class="row">
                              <div class="col-xs-6">Refund Reason :</div>
                              <div class="col-xs-">
                                {{ reservation_details?.refund_reason }}
                              </div>
                            </li>
                          </ul> -->
                          </div>
                          <div class="row">
                            <div class="col-xs-4">
                              <ul class="list-unstyled">
                                <!-- <li class="row">
                              <div class="col-xs-6">Lead Address :</div>
                              <div class="col-xs-6">
                                {{ reservation_details?.lead_address }}
                              </div>
                            </li>
                            <li class="row">
                              <div class="col-xs-6">Lead Birthday :</div>
                              <div class="col-xs-6">
                                {{ reservation_details?.lead_birthday }}
                              </div>
                            </li>
                            <li class="row">
                              <div class="col-xs-6">Lead District :</div>
                              <div class="col-xs-6">
                                {{ reservation_details?.lead_district }}
                              </div>
                            </li> -->
                                <li
                                  class="row"
                                  *ngIf="
                                    reservation_details?.admin_confirmation_by
                                  "
                                >
                                  <div class="col-xs-6">
                                    Admin Confirmation By :
                                  </div>
                                  <div class="col-xs-">
                                    {{
                                      reservation_details?.admin_confirmation_by
                                    }}
                                  </div>
                                </li>
                                <!-- <li class="row">
                              <div class="col-xs-6">Lead Channel :</div>
                              <div class="col-xs-">
                                {{ reservation_details?.lead_channel }}
                              </div>
                            </li>
                            <li class="row">
                              <div class="col-xs-6">Lead Source :</div>
                              <div class="col-xs-">
                                {{ reservation_details?.lead_source }}
                              </div>
                            </li> -->
                              </ul>
                            </div>
                            <div class="col-xs-4">
                              <ul class="list-unstyled">
                                <!-- <li class="row">
                              <div class="col-xs-6">Garage Area :</div>
                              <div class="col-xs-6">
                                {{ reservation_details?.unit_garage_area }}
                              </div>
                            </li> -->
                                <!-- <li class="row">
                              <div class="col-xs-6">Lead Home Phone :</div>
                              <div class="col-xs-6">
                                {{ reservation_details?.lead_home_phone }}
                              </div>
                            </li>
                            <li class="row">
                              <div class="col-xs-6">Lead Phone :</div>
                              <div class="col-xs-6">
                                {{ reservation_details?.lead_phone }}
                              </div>
                            </li>
                            <li class="row">
                              <div class="col-xs-6">Lead Other Phone :</div>
                              <div class="col-xs-6">
                                {{ reservation_details?.lead_other_phone }}
                              </div>
                            </li>
                            <li class="row">
                              <div class="col-xs-6">Lead Source :</div>
                              <div class="col-xs-6">
                                {{ reservation_details?.lead_source }}
                              </div>
                            </li> -->
                                <!-- <li class="row">
                              <div class="col-xs-6">Garden Area :</div>
                              <div class="col-xs-6">
                                {{ reservation_details?.unit_garden_area }}
                              </div>
                            </li> -->
                              </ul>
                            </div>
                          </div>
                        </div>

                        <div
                          class="col-xs-3 col-xs-offset-1 operation-buttons"
                          *ngIf="
                            reservation_details?.authorization
                              ?.can_download_rf &&
                            userProfile.role != 'CCO' &&
                            userProfile.role != 'Super Development' &&
                            userProfile.role != 'Development Director'
                          "
                        >
                          <a
                            class="btn btn-primary"
                            (click)="downloadReservation()"
                            *ngIf="
                              reservation_details?.authorization
                                ?.can_download_rf && userProfile.role != 'CCO'
                            "
                          >
                            Download Reservation
                          </a>
                          <button
                            class="btn btn-secondary"
                            *ngIf="
                              (userProfile?.role == 'Admin' ||
                                userProfile.role == 'Super Development' ||
                                userProfile?.role == 'Moderator' ||
                                userProfile?.role == 'Super Moderator') &&
                              userProfile.role != 'Super Development' &&
                              userProfile.role != 'CCO'
                            "
                            (click)="changeConfirmationDateModal.open()"
                          >
                            Admin Confirmation
                          </button>
                          <button
                            class="btn btn-secondary decline-btn"
                            *ngIf="
                              reservation_details.authorization
                                .can_admin_decline == 1 &&
                              userProfile.role != 'CCO' &&
                              userProfile.role != 'Super Development' &&
                              userProfile.role != 'Development Director'
                            "
                            (click)="
                              adminDecline(
                                reservation_details.id,
                                refundAdminDeclineModal
                              )
                            "
                          >
                            {{
                              reservation_details.is_accountant_approved
                                ? "Refund"
                                : "Admin Decline"
                            }}
                          </button>
                          <button
                            class="btn btn-secondary"
                            *ngIf="
                              reservation_details.authorization
                                .can_delete_reservation == 1 &&
                              userProfile.role != 'CCO' &&
                              userProfile.role != 'Super Development' &&
                              userProfile.role != 'Development Director'
                            "
                            (click)="swalDelete(reservation_details.id)"
                          >
                            Delete Reservation
                          </button>
                          <button
                            class="btn btn-secondary"
                            (click)="installmentModal.open(reservation_details)"
                            *ngIf="
                              reservation_details?.authorization
                                .can_generate_installments == 1 &&
                              userProfile.role != 'CCO' &&
                              userProfile.role != 'Super Development' &&
                              userProfile.role != 'Development Director'
                            "
                          >
                            Installment Generator
                          </button>
                          <!-- <button class="btn btn-secondary" *ngIf="userProfile?.role == 'Admin'"
                            (click)="reAssignClientModal.open()">
                            Re-assign Client
                          </button> -->
                          <!-- <button class="btn btn-secondary" (click)="garageSlots.open()">
                            Change Number of Slots
                          </button> -->
                          <!-- <button class="btn btn-secondary" (click)="editLead.open()">
                            Edit Lead Info
                          </button> -->
                          <button
                            class="btn btn-secondary"
                            (click)="addCustomer.open()"
                            *ngIf="
                              (userProfile?.role == 'Admin' ||
                                userProfile?.role == 'Super Moderator' ||
                                userProfile?.role == 'Moderator' ||
                                userProfile?.role == 'Contractor' ||
                                userProfile?.role == 'Legal and Technical') &&
                              userProfile.role != 'CCO' &&
                              userProfile.role != 'Development Director'
                            "
                            [disabled]="
                              reservation_details?.sharing_leads?.length >= 4
                            "
                          >
                            Add Customer
                          </button>
                          <button
                            *ngIf="
                              (userProfile?.role == 'Admin' ||
                                userProfile?.role == 'Super Moderator' ||
                                userProfile?.role == 'Moderator' ||
                                userProfile?.role == 'Contractor' ||
                                userProfile?.role == 'Legal and Technical') &&
                              userProfile.role != 'CCO' &&
                              userProfile.role != 'Development Director'
                            "
                            class="btn btn-secondary"
                            (click)="addOldCustomer.open()"
                          >
                            Assign Customer
                          </button>
                          <button
                            class="btn btn-secondary btn-success"
                            *ngIf="
                              (userProfile.role == 'Admin' ||
                                userProfile.role == 'Super Development' ||
                                userProfile?.role == 'Super Moderator' ||
                                userProfile?.role == 'Moderator') &&
                              userProfile.role != 'CCO' &&
                              userProfile.role != 'Development Director' &&
                              (reservation_details.status == 'Cancelled' ||
                                reservation_details.status == 'Declined' ||
                                reservation_details.status == 'Refund Process')
                            "
                            (click)="reactivateReservation()"
                          >
                            Re-activate Reservation
                          </button>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div
                    role="tabpanel"
                    class="tab-pane fade"
                    id="contract_rent_info"
                  >
                    <div class="box-mrg">
                      <div class="row">
                        <div class="col-xs-4">
                          <ul class="list-unstyled">
                            <li
                              class="row"
                              *ngIf="reservation_details?.contract_type"
                            >
                              <div class="col-xs-6">Contract Type :</div>
                              <div class="col-xs-6">
                                {{ reservation_details?.contract_type }}
                              </div>
                            </li>
                            <li
                              class="row"
                              *ngIf="
                                reservation_details?.rent_details?.rent_value &&
                                reservation_details?.contract_type == 'rent'
                              "
                            >
                              <div class="col-xs-6">Rent Value :</div>
                              <div class="col-xs-6">
                                {{
                                  reservation_details?.rent_details?.rent_value
                                }}
                              </div>
                            </li>
                            <li
                              class="row"
                              *ngIf="
                                reservation_details?.rent_details
                                  ?.rent_years_num &&
                                reservation_details?.contract_type == 'rent'
                              "
                            >
                              <div class="col-xs-6">Rent Years Num :</div>
                              <div class="col-xs-6">
                                {{
                                  reservation_details?.rent_details
                                    ?.rent_years_num
                                }}
                              </div>
                            </li>
                            <li
                              class="row"
                              *ngIf="
                                reservation_details?.payment_type &&
                                reservation_details?.contract_type == 'sale'
                              "
                            >
                              <div class="col-xs-6">Payment Type :</div>
                              <div class="col-xs-6">
                                {{ reservation_details?.payment_type }}
                              </div>
                            </li>
                            <li
                              class="row"
                              *ngIf="
                                reservation_details?.contract_type == 'sale' &&
                                reservation_details?.is_overseas !== null
                              "
                            >
                              <div class="col-xs-6">Is Overseas :</div>
                              <div class="col-xs-6">
                                {{
                                  reservation_details?.is_overseas == 0
                                    ? "no"
                                    : "yes"
                                }}
                              </div>
                            </li>
                          </ul>
                        </div>
                        <div class="col-xs-4">
                          <ul class="list-unstyled">
                            <li
                              class="row"
                              *ngIf="
                                reservation_details?.contract_type == 'rent'
                              "
                            >
                              <div class="col-xs-6">Rent Start Date :</div>
                              <div class="col-xs-6">
                                {{
                                  reservation_details?.rent_details
                                    ?.rent_start_date
                                }}
                              </div>
                            </li>
                            <li
                              class="row"
                              *ngIf="
                                reservation_details?.contract_type == 'rent'
                              "
                            >
                              <div class="col-xs-6">Rent End Date :</div>
                              <div class="col-xs-6">
                                {{
                                  reservation_details?.rent_details
                                    ?.rent_end_date
                                }}
                              </div>
                            </li>
                            <li
                              class="row"
                              *ngIf="
                                reservation_details?.contract_type == 'sale'
                              "
                            >
                              <div class="col-xs-6">Payment Plan :</div>
                              <div class="col-xs-6">
                                {{ reservation_details?.installment_years }}
                              </div>
                            </li>
                            <!-- <li
                              class="row"
                              *ngIf="
                                reservation_details?.contract_type == 'sale'
                              "
                            >
                              <div class="col-xs-6">Installment Fees :</div>
                              <div class="col-xs-6">
                                {{ reservation_details?.installment_fees }}
                              </div>
                            </li> -->
                          </ul>
                        </div>
                        <div
                          class="col-xs-3 col-xs-offset-1 operation-buttons"
                          *ngIf="
                            !isReadonlyMode &&
                            userProfile.role != 'CCO' &&
                            userProfile.role != 'Development Director' &&
                            userProfile.role != 'Legal and Technical' &&
                            userProfile.role != 'Facility'
                          "
                        >
                          <button
                            *ngIf="userProfile?.role != 'Super Development'"
                            class="btn btn-secondary"
                            (click)="contractTypeModal.open()"
                          >
                            Change Contract Type
                          </button>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div role="tabpanel" class="tab-pane fade" id="deal-type">
                    <div class="box-mrg">
                      <div class="row">
                        <div class="col-xs-4">
                          <ul class="list-unstyled">
                            <li
                              class="row"
                              *ngIf="reservation_details?.is_overseas !== null"
                            >
                              <div class="col-xs-6">Is Overseas :</div>
                              <div
                                class="col-xs-6"
                                *ngIf="reservation_details?.is_overseas == 1"
                              >
                                Yes
                              </div>
                              <div
                                class="col-xs-6"
                                *ngIf="reservation_details?.is_overseas == 0"
                              >
                                No
                              </div>
                            </li>
                            <li
                              class="row"
                              *ngIf="reservation_details?.lead_source === 'BYC'"
                            >
                              <div class="col-xs-6">BYC Name :</div>
                              <div class="col-xs-6">
                                {{ reservation_details?.byc_name }}
                              </div>
                            </li>
                            <li
                              class="row"
                              *ngIf="reservation_details?.ambassador !== null"
                            >
                              <div class="col-xs-6">AMB :</div>
                              <div
                                class="col-xs-6"
                                *ngIf="reservation_details?.ambassador"
                              >
                                Yes
                              </div>
                              <div
                                class="col-xs-6"
                                *ngIf="!reservation_details?.ambassador"
                              >
                                No
                              </div>
                            </li>
                            <li
                              class="row"
                              *ngIf="reservation_details?.broker !== null"
                            >
                              <div class="col-xs-6">Broker :</div>
                              <div
                                class="col-xs-6"
                                *ngIf="reservation_details?.broker"
                              >
                                Yes
                              </div>
                              <div
                                class="col-xs-6"
                                *ngIf="!reservation_details?.broker"
                              >
                                No
                              </div>
                            </li>
                            <li
                              class="row"
                              *ngIf="
                                (userProfile?.role == 'Admin' ||
                                  userProfile.role == 'Super Development' ||
                                  userProfile?.role == 'Super Moderator' ||
                                  userProfile?.role == 'Moderator') &&
                                userProfile.role != 'CCO' &&
                                userProfile.role != 'Development Director' &&
                                userProfile.role != 'Legal and Technical' &&
                                userProfile.role != 'Facility' &&
                                reservation_details?.deal_type == 'In-Direct'
                              "
                            >
                              <div class="col-xs-6">Change P.C in charge :</div>
                              <div class="col-xs-6">
                                <div class="form-group">
                                  <ng-select
                                    name="agent_in_charge"
                                    [(ngModel)]="agent_in_charge"
                                    (change)="onAgentInChargeSelected($event)"
                                    placeholder="Select Agent"
                                  >
                                    <ng-option
                                      *ngFor="let agent of agents"
                                      [value]="agent.id"
                                      >{{ agent.name }}</ng-option
                                    >
                                  </ng-select>
                                </div>
                              </div>
                            </li>
                            <li
                              class="row"
                              *ngIf="reservation_details?.deal_type"
                            >
                              <div class="col-xs-6">Division :</div>
                              <div class="col-xs-6">
                                {{ reservation_details?.deal_type }}
                              </div>
                            </li>
                            <li
                              class="row"
                              *ngIf="reservation_details?.deal_category"
                            >
                              <div class="col-xs-6">Category :</div>
                              <div class="col-xs-6">
                                {{ reservation_details?.deal_category }}
                              </div>
                            </li>
                          </ul>
                        </div>
                        <div class="col-xs-4">
                          <ul class="list-unstyled">
                            <li
                              class="row"
                              *ngIf="reservation_details?.ambassador?.name"
                            >
                              <div class="col-xs-6">Ambassador Name :</div>
                              <div class="col-xs-6">
                                {{ reservation_details?.ambassador?.name }}
                              </div>
                            </li>
                            <li
                              class="row"
                              *ngIf="reservation_details?.broker?.name"
                            >
                              <div class="col-xs-6">Broker Name :</div>
                              <div class="col-xs-6">
                                {{ reservation_details?.broker?.name }}
                              </div>
                            </li>
                            <li
                              class="row"
                              *ngIf="
                                reservation_details?.broker_incentive?.name
                              "
                            >
                              <div class="col-xs-6">
                                Broker Incentive Name :
                              </div>
                              <div class="col-xs-6">
                                {{
                                  reservation_details?.broker_incentive?.name
                                }}
                              </div>
                            </li>
                            <li class="row" *ngIf="reservation_details?.event">
                              <div class="col-xs-6">Exhibition & Events:</div>
                              <div class="col-xs-6">
                                {{ reservation_details?.event.name }}
                              </div>
                            </li>
                          </ul>
                        </div>
                        <div
                          class="col-xs-3 col-xs-offset-1 operation-buttons"
                        ></div>
                        <div
                          class="col-xs-3 col-xs-offset-1 operation-buttons"
                          *ngIf="
                            !isReadonlyMode &&
                            userProfile.role != 'CCO' &&
                            userProfile.role != 'Super Development' &&
                            userProfile.role != 'Development Director' &&
                            userProfile.role != 'Legal and Technical' &&
                            userProfile.role != 'Facility'
                          "
                        >
                          <button
                            class="btn btn-secondary"
                            (click)="openChangeDealType(divisionModal)"
                          >
                            Change Deal Type
                          </button>
                          <button
                            class="btn btn-secondary"
                            *ngIf="reservation_details?.broker_id"
                            (click)="assignBrokerIncentiveModal.open()"
                          >
                            Assign Broker Incentive
                          </button>
                          <button
                            class="btn btn-secondary"
                            (click)="overseasModal.open()"
                          >
                            Change Overseas
                          </button>
                          <button
                            class="btn btn-secondary"
                            (click)="changeEventModal.open()"
                          >
                            Change Event
                          </button>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div
                    role="tabpanel"
                    class="tab-pane fade"
                    id="accountant-information"
                  >
                    <div class="box-mrg">
                      <div class="col-xs-4">
                        <ul class="list-unstyled">
                          <li
                            class="row"
                            *ngIf="reservation_details?.total_down_payment"
                          >
                            <div class="col-xs-6">Total Down Payment :</div>
                            <div class="col-xs-6">
                              {{
                                reservation_details?.total_down_payment
                                  | currency : " "
                              }}
                            </div>
                          </li>
                          <li
                            class="row"
                            *ngIf="reservation_details?.amount_received"
                          >
                            <div class="col-xs-6">Received Down Payment :</div>
                            <div class="col-xs-6">
                              {{
                                reservation_details?.amount_received
                                  | currency : " "
                              }}
                            </div>
                          </li>
                          <li class="row">
                            <div class="col-xs-6">Has Basement :</div>
                            <div class="col-xs-6">
                              {{
                                reservation_details?.has_basement ? "Yes" : "No"
                              }}
                            </div>
                          </li>
                          <li class="row">
                            <div class="col-xs-6">Basement Area :</div>
                            <div class="col-xs-6">
                              {{ reservation_details?.unit_basement_area }}
                            </div>
                          </li>
                          <li class="row">
                            <div class="col-xs-6">Basement Price :</div>
                            <div class="col-xs-6">
                              {{
                                reservation_details?.unit_basement_price
                                  | currency : " "
                              }}
                            </div>
                          </li>
                          <li
                            class="row"
                            *ngIf="reservation_details?.remaining_down_payment"
                          >
                            <div class="col-xs-6">Remaining Down Payment :</div>
                            <div class="col-xs-6">
                              {{
                                reservation_details?.remaining_down_payment
                                  | currency
                                    : "
                              "
                              }}
                            </div>
                          </li>
                          <li
                            class="row"
                            *ngIf="reservation_details?.payment_type"
                          >
                            <div class="col-xs-6">Payment Type :</div>
                            <div class="col-xs-6">
                              {{ reservation_details?.payment_type }}
                            </div>
                          </li>
                          <li
                            class="row"
                            *ngIf="reservation_details?.installment_years"
                          >
                            <div class="col-xs-6">Payment Term :</div>
                            <div class="col-xs-6">
                              {{ reservation_details?.installment_years }}
                            </div>
                          </li>
                          <li
                            class="row"
                            *ngIf="reservation_details?.percentage"
                          >
                            <div class="col-xs-6">Down Payment :</div>
                            <div class="col-xs-6">
                              {{ reservation_details?.percentage }} %
                            </div>
                          </li>
                          <li class="row">
                            <div class="col-xs-6">Accountant Approved :</div>
                            <div
                              class="col-xs-6"
                              *ngIf="
                                reservation_details?.is_accountant_approved
                              "
                            >
                              Yes
                            </div>
                            <div
                              class="col-xs-6"
                              *ngIf="reservation_details?.is_accountant_decline"
                            >
                              Declined
                            </div>
                          </li>
                          <li
                            class="row"
                            *ngIf="
                              reservation_details?.accountant_status_date &&
                              (reservation_details?.is_accountant_approved ||
                                reservation_details?.is_accountant_decline)
                            "
                          >
                            <div class="col-xs-6">
                              Accountant Approved Date :
                            </div>
                            <div class="col-xs-6">
                              {{ reservation_details?.accountant_status_date }}
                            </div>
                          </li>
                          <li class="row">
                            <div class="col-xs-6">Cheque Status :</div>
                            <div
                              class="col-xs-6"
                              *ngIf="reservation_details?.cheque_recieved"
                            >
                              Yes
                            </div>
                            <div
                              class="col-xs-6"
                              *ngIf="!reservation_details?.cheque_recieved"
                            >
                              No
                            </div>
                          </li>
                          <li class="row">
                            <div class="col-xs-6">Cheque Recieved Date :</div>
                            <div
                              class="col-xs-6"
                              *ngIf="reservation_details?.cheque_recieved_date"
                            >
                              {{ reservation_details?.cheque_recieved_date }}
                            </div>
                            <div
                              class="col-xs-6"
                              *ngIf="!reservation_details?.cheque_recieved_date"
                            >
                              N/A
                            </div>
                          </li>
                          <!-- <li class="row">
                                                <div class="col-xs-6">Down Payment Collected :</div>
                                                <div class="col-xs-6">missing</div>
                                              </li> -->
                          <!-- <li class="row">
                                                <div class="col-xs-6">Payment :</div>
                                                <div class="col-xs-6">missing</div>
                                              </li> -->
                          <!-- <li class="row">
                                                <div class="col-xs-6">Cheque Written :</div>
                                                <div class="col-xs-6">missing</div>
                                              </li> -->
                          <!-- <li class="row">
                                                <div class="col-xs-6">Date :</div>
                                                <div class="col-xs-6">missing</div>
                                              </li> -->
                          <!-- <li class="row">
                                                <div class="col-xs-6">Cheque Status :</div>
                                                <div class="col-xs-6">missing</div>
                                              </li> -->
                        </ul>
                      </div>
                      <div class="col-xs-4">
                        <ul class="list-unstyled">
                          <li
                            class="row"
                            *ngIf="reservation_details?.unit_price"
                          >
                            <div class="col-xs-6">Selling Price :</div>
                            <div class="col-xs-6">
                              {{
                                reservation_details?.unit_price | currency : " "
                              }}
                            </div>
                          </li>
                          <li
                            class="row"
                            *ngIf="reservation_details?.origin_price"
                          >
                            <div class="col-xs-6">Unit Price :</div>
                            <div class="col-xs-6">
                              {{
                                reservation_details?.origin_price
                                  | currency : " "
                              }}
                            </div>
                          </li>
                          <li
                            class="row"
                            *ngIf="reservation_details?.unit_maintenance_price"
                          >
                            <div class="col-xs-6">Maintenance Fees :</div>
                            <div class="col-xs-6">
                              {{
                                reservation_details?.unit_maintenance_price
                                  | currency : " "
                              }}
                            </div>
                          </li>
                          <li class="row">
                            <div class="col-xs-6">Discount Percentage :</div>
                            <div
                              class="col-xs-6"
                              *ngIf="
                                reservation_details?.discount_percentage;
                                then discountpercentageshow;
                                else discountpercentagehide
                              "
                            ></div>
                            <ng-template #discountpercentageshow>
                              <div class="col-xs-6">
                                {{ reservation_details?.discount_percentage }}
                              </div>
                            </ng-template>
                            <ng-template #discountpercentagehide>
                              <div class="col-xs-6">NA</div>
                            </ng-template>
                          </li>
                          <li class="row">
                            <div class="col-xs-6">Slip Number:</div>
                            <div
                              class="col-xs-6"
                              *ngIf="reservation_details?.slip_number"
                            >
                              {{ reservation_details?.slip_number }}
                            </div>
                          </li>
                          <li class="row">
                            <div class="col-xs-6">Discount Reason :</div>
                            <div class="col-xs-6">
                              {{ reservation_details?.discount_reason }}
                            </div>
                            <ng-template #discountreasonshow>
                              <div class="col-xs-6">
                                {{ reservation_details?.discount_percentage }}
                              </div>
                            </ng-template>
                            <ng-template #discountreasonhide>
                              <div class="col-xs-6">NA</div>
                            </ng-template>
                          </li>
                          <li class="row">
                            <div class="col-xs-6">Is Commisioned :</div>
                            <div
                              class="col-xs-6"
                              *ngIf="reservation_details?.commission_date"
                            >
                              Yes
                            </div>
                            <div
                              class="col-xs-6"
                              *ngIf="!reservation_details?.commission_date"
                            >
                              No
                            </div>
                          </li>
                          <li
                            class="row"
                            *ngIf="reservation_details?.commission_date"
                          >
                            <div class="col-xs-6">Commission Date :</div>
                            <div class="col-xs-6">
                              {{ reservation_details?.commission_date }}
                            </div>
                          </li>
                          <li class="row">
                            <div class="col-xs-6">Is Broker Commisioned :</div>
                            <div
                              class="col-xs-6"
                              *ngIf="
                                reservation_details?.is_broker_commissioned
                              "
                            >
                              Yes
                            </div>
                            <div
                              class="col-xs-6"
                              *ngIf="
                                !reservation_details?.is_broker_commissioned
                              "
                            >
                              No
                            </div>
                          </li>
                          <li
                            class="row"
                            *ngIf="reservation_details?.broker_commission_date"
                          >
                            <div class="col-xs-6">Broker Commission Date :</div>
                            <div class="col-xs-6">
                              {{ reservation_details?.broker_commission_date }}
                            </div>
                          </li>
                          <li
                            class="row"
                            *ngIf="reservation_details?.broker_claim_date"
                          >
                            <div class="col-xs-6">Broker Claim Date :</div>
                            <div class="col-xs-6">
                              {{ reservation_details?.broker_claim_date }}
                            </div>
                          </li>
                          <li class="row">
                            <div class="col-xs-6">
                              Is Ambassador Commisioned :
                            </div>
                            <div
                              class="col-xs-6"
                              *ngIf="
                                reservation_details?.is_ambassador_commissioned
                              "
                            >
                              Yes
                            </div>
                            <div
                              class="col-xs-6"
                              *ngIf="
                                !reservation_details?.is_ambassador_commissioned
                              "
                            >
                              No
                            </div>
                          </li>
                          <li
                            class="row"
                            *ngIf="
                              reservation_details?.ambassador_commission_date
                            "
                          >
                            <div class="col-xs-6">
                              Ambassador Commission Date :
                            </div>
                            <div class="col-xs-6">
                              {{
                                reservation_details?.ambassador_commission_date
                              }}
                            </div>
                          </li>
                          <li
                            class="row"
                            *ngIf="reservation_details?.ambassador_claim_date"
                          >
                            <div class="col-xs-6">Ambassador Claim Date :</div>
                            <div class="col-xs-6">
                              {{ reservation_details?.ambassador_claim_date }}
                            </div>
                          </li>
                        </ul>
                      </div>
                      <div
                        class="col-xs-4 operation-buttons"
                        *ngIf="
                          !isReadonlyMode &&
                          userProfile.role != 'CCO' &&
                          userProfile.role != 'Super Development' &&
                          userProfile.role != 'Legal and Technical' &&
                          userProfile.role != 'Facility'
                        "
                      >
                        <!-- <button
                          *ngIf="
                            userProfile?.role == 'Admin' ||
                            userProfile?.role == 'Moderator' ||
                            userProfile?.role == 'Accountant'
                          "
                          (click)="printChequeModal.open()"
                          class="btn btn-secondary"
                        >
                          Print Cheque
                        </button> -->
                        <button
                          class="btn btn-secondary"
                          (click)="changeBasementModal.open()"
                        >
                          Change Basement Data
                        </button>
                        <button
                          class="btn btn-secondary"
                          *ngIf="
                            reservation_details.receipts &&
                            reservation_details.receipts.length > 0 &&
                            (userProfile?.role == 'Admin' ||
                              userProfile.role == 'Super Development' ||
                              userProfile?.role == 'Moderator' ||
                              userProfile?.role == 'A.R Accountant' ||
                              userProfile?.role == 'Treasury Accountant')
                          "
                          (click)="printReciptModal.open()"
                        >
                          Print Recipt
                        </button>
                        <button
                          class="btn btn-secondary"
                          *ngIf="
                            userProfile.role === 'Admin' ||
                            userProfile.role == 'Super Development' ||
                            userProfile?.role == 'A.R Accountant' ||
                            userProfile?.role == 'Treasury Accountant'
                          "
                          (click)="addBankTransferModal.open()"
                        >
                          Add Bank Transfer
                        </button>
                        <button
                          class="btn btn-secondary"
                          *ngIf="
                            userProfile.role === 'Admin' ||
                            userProfile.role == 'Super Development' ||
                            userProfile?.role == 'A.R Accountant' ||
                            userProfile?.role == 'Treasury Accountant'
                          "
                          (click)="viewBankTransferModal.open()"
                        >
                          View Bank Transfer
                        </button>
                        <button
                          class="btn btn-secondary"
                          *ngIf="
                            userProfile.role != 'CCO' &&
                            userProfile.role != 'Development Director' &&
                            userProfile?.role != 'Super Moderator' &&
                            userProfile.role != 'Moderator' &&
                            reservation_details.authorization
                              .can_accountant_approve == 1
                          "
                          (click)="
                            accountApproveModal.open(reservation_details.id)
                          "
                        >
                          Accountant Approve
                        </button>
                        <button
                          class="btn btn-secondary"
                          *ngIf="
                            userProfile.role == 'Admin' ||
                            userProfile.role == 'Super Development' ||
                            userProfile.role == 'AR Manager'
                          "
                          (click)="
                            reserAccountantApprove(reservation_details.id)
                          "
                        >
                          Reset Accountant Approve
                        </button>
                        <button
                          class="btn btn-secondary"
                          *ngIf="
                            userProfile.role != 'CCO' &&
                            userProfile.role != 'Development Director' &&
                            reservation_details.is_deposit
                          "
                          (click)="
                            completeDownPaymentModal.open(
                              reservation_details.id
                            )
                          "
                        >
                          Complete Down Payment
                        </button>
                        <button
                          class="btn btn-secondary decline-btn"
                          *ngIf="
                            userProfile.role != 'CCO' &&
                            userProfile.role != 'Development Director' &&
                            reservation_details?.authorization
                              .can_accountant_decline == 1
                          "
                          (click)="accountDecline(reservation_details?.id)"
                        >
                          Accountant Decline
                        </button>
                        <button
                          class="btn btn-secondary"
                          (click)="actionChequeRecievedModal.open()"
                          *ngIf="
                            userProfile.role != 'CCO' &&
                            userProfile.role != 'Development Director' &&
                            reservation_details?.authorization
                              .can_cheque_recieved == 1
                          "
                        >
                          Cheque Recieved
                        </button>
                        <button
                          class="btn btn-secondary"
                          (click)="
                            cancel_cheque_recieved(reservation_details?.id)
                          "
                          *ngIf="
                            userProfile.role != 'CCO' &&
                            userProfile.role != 'Development Director' &&
                            reservation_details?.cheque_recieved == 1
                          "
                        >
                          Cancel Cheuqe Recieved
                        </button>
                        <button
                          class="btn btn-secondary"
                          (click)="installmentModal.open(reservation_details)"
                          *ngIf="
                            userProfile.role != 'CCO' &&
                            userProfile.role != 'Development Director' &&
                            reservation_details?.authorization
                              .can_generate_installments == 1
                          "
                        >
                          Installment Generator
                        </button>
                        <button
                          class="btn btn-secondary"
                          (click)="commissionModal.open()"
                          *ngIf="
                            userProfile.role != 'CCO' &&
                            userProfile.role != 'Development Director' &&
                            reservation_details?.authorization.can_commission
                          "
                        >
                          Commission
                        </button>
                        <button
                          class="btn btn-secondary"
                          (click)="claimModal.open()"
                          *ngIf="
                            userProfile.role != 'CCO' &&
                            reservation_details?.authorization.can_claim
                          "
                        >
                          Claim
                        </button>
                        <button
                          class="btn btn-secondary"
                          *ngIf="
                            userProfile.role != 'CCO' &&
                            userProfile.role != 'Development Director'
                          "
                          (click)="paymentTypeModal.open()"
                        >
                          Change Payment Type
                        </button>
                        <button
                          class="btn btn-secondary"
                          *ngIf="
                            userProfile.role != 'CCO' &&
                            userProfile.role != 'Development Director'
                          "
                          (click)="paymentTermModal.open()"
                        >
                          Change Payment Term
                        </button>
                        <button
                          *ngIf="
                            reservation_details?.authorization
                              .can_edit_selling_price == 1 &&
                            userProfile.role != 'CCO' &&
                            userProfile.role != 'Development Director' &&
                            userProfile?.role != 'Super Moderator' &&
                            userProfile.role != 'Moderator'
                          "
                          (click)="editSellingPriceModal.open()"
                          class="btn btn-secondary"
                        >
                          Extra Discount
                        </button>
                        <button
                          *ngIf="
                            reservation_details?.is_extra_discount == 1 &&
                            reservation_details?.authorization
                              ?.can_cancel_extra_discount &&
                            reservation_details?.authorization
                              .can_edit_selling_price == 1 &&
                            userProfile.role != 'CCO' &&
                            userProfile.role != 'Development Director'
                          "
                          (click)="cancelExtraDiscount()"
                          class="btn btn-secondary"
                        >
                          Cancel Extra Discount
                        </button>
                        <button
                          class="btn btn-secondary"
                          *ngIf="
                            (userProfile?.role == 'Admin' ||
                              userProfile.role == 'Super Development' ||
                              userProfile?.role == 'Moderator' ||
                              userProfile?.role == 'Super Moderator') &&
                            userProfile.role != 'CCO' &&
                            userProfile.role != 'Development Director'
                          "
                          (click)="changeSellingDateModal.open()"
                        >
                          Change Selling Date
                        </button>
                        <button
                          class="btn btn-secondary"
                          (click)="garageSlots.open()"
                          *ngIf="
                            userProfile.role != 'CCO' &&
                            userProfile.role != 'Development Director'
                          "
                        >
                          Change Number of Slots
                        </button>
                        <button
                          class="btn btn-secondary"
                          (click)="garageExtraSlots.open()"
                          *ngIf="
                            userProfile.role != 'CCO' &&
                            userProfile.role != 'Development Director'
                          "
                        >
                          Change Number of Extra Slots
                        </button>
                        <button
                          class="btn btn-secondary"
                          (click)="storageSlots.open()"
                          *ngIf="
                            userProfile.role != 'CCO' &&
                            userProfile.role != 'Development Director'
                          "
                        >
                          Change Number of Storage Slots
                        </button>
                        <button
                          class="btn btn-secondary"
                          *ngIf="
                            (userProfile?.role == 'Admin' ||
                              userProfile.role == 'Super Development' ||
                              userProfile?.role == 'Moderator' ||
                              userProfile?.role == 'Super Moderator') &&
                            userProfile.role != 'CCO' &&
                            userProfile.role != 'Development Director'
                          "
                          (click)="changeSellingPriceModal.open()"
                        >
                          Change Selling Price
                        </button>
                      </div>
                    </div>
                  </div>

                  <div
                    role="tabpanel"
                    class="tab-pane fade"
                    id="contract-tracking"
                  >
                    <div class="box-mrg">
                      <div class="row">
                        <div class="col-xs-4">
                          <ul class="list-unstyled">
                            <li class="row">
                              <div class="col-xs-6">
                                OverSeas Contract Sent :
                              </div>
                              <div
                                class="col-xs-6"
                                *ngIf="reservation_details?.contract_send_date"
                              >
                                Yes ({{
                                  reservation_details?.contract_send_date
                                }})
                              </div>
                              <div
                                class="col-xs-6"
                                *ngIf="!reservation_details?.contract_send_date"
                              >
                                No
                              </div>
                            </li>
                            <li class="row">
                              <div class="col-xs-6">
                                Contract Signed By Client :
                              </div>
                              <div
                                class="col-xs-6"
                                *ngIf="reservation_details?.client_signature"
                              >
                                Yes
                              </div>
                              <div
                                class="col-xs-6"
                                *ngIf="!reservation_details?.client_signature"
                              >
                                No
                              </div>
                            </li>
                            <li class="row">
                              <div class="col-xs-6">
                                Contract Signature By Client Date :
                              </div>
                              <div
                                class="col-xs-6"
                                *ngIf="reservation_details?.client_signature"
                              >
                                {{ reservation_details?.client_signature }}
                              </div>
                              <div
                                class="col-xs-6"
                                *ngIf="!reservation_details?.client_signature"
                              >
                                No
                              </div>
                            </li>
                            <li class="row">
                              <div class="col-xs-6">Cheque Status :</div>
                              <div
                                class="col-xs-6"
                                *ngIf="reservation_details?.cheque_recieved"
                              >
                                Yes
                              </div>
                              <div
                                class="col-xs-6"
                                *ngIf="!reservation_details?.cheque_recieved"
                              >
                                No
                              </div>
                            </li>
                          </ul>
                        </div>
                        <div class="col-xs-4">
                          <ul class="list-unstyled">
                            <li class="row">
                              <div class="col-xs-6">
                                Contract Signed by CEO :
                              </div>
                              <div
                                class="col-xs-6"
                                *ngIf="reservation_details?.contract_approval"
                              >
                                Yes
                              </div>
                              <div
                                class="col-xs-6"
                                *ngIf="!reservation_details?.contract_approval"
                              >
                                No
                              </div>
                            </li>
                            <li
                              class="row"
                              *ngIf="reservation_details?.contract_approval"
                            >
                              <div class="col-xs-6">
                                Contract Signed by CEO date :
                              </div>
                              <div class="col-xs-6">
                                {{ reservation_details?.contract_approval }}
                              </div>
                            </li>
                            <li class="row">
                              <div class="col-xs-6">Contract Delivered :</div>
                              <div
                                class="col-xs-6"
                                *ngIf="reservation_details?.contract_delivered"
                              >
                                Yes
                              </div>
                              <div
                                class="col-xs-6"
                                *ngIf="!reservation_details?.contract_delivered"
                              >
                                No
                              </div>
                            </li>
                            <li class="row">
                              <div class="col-xs-6">
                                Contract Delivered Date :
                              </div>
                              <div
                                class="col-xs-6"
                                *ngIf="reservation_details?.contract_delivered"
                              >
                                {{
                                  reservation_details?.contract_delivered_date
                                }}
                              </div>
                              <div
                                class="col-xs-6"
                                *ngIf="!reservation_details?.contract_delivered"
                              >
                                No
                              </div>
                            </li>
                            <li class="row">
                              <div class="col-xs-6">
                                Contract To Be Delivered :
                              </div>
                              <div
                                class="col-xs-6"
                                *ngIf="reservation_details?.contract_to_be_delivered"
                              >
                                Yes
                              </div>
                              <div
                                class="col-xs-6"
                                *ngIf="!reservation_details?.contract_to_be_delivered"
                              >
                                No
                              </div>
                            </li>
                            <li class="row" *ngIf="reservation_details?.contract_to_be_delivered_date">
                              <div class="col-xs-6">
                                Contract To Be Delivered Date :
                              </div>
                              <div class="col-xs-6">
                                {{
                                  reservation_details?.contract_to_be_delivered_date
                                }}
                              </div>
                            </li>
                          </ul>
                        </div>
                        <div
                          class="col-xs-4 operation-buttons"
                          *ngIf="
                            userProfile.role != 'CCO' &&
                            userProfile.role != 'Super Development' &&
                            userProfile.role != 'Development Director'
                          "
                        >
                          <button
                            class="btn btn-secondary"
                            *ngIf="userProfile.role != 'CCO'"
                            (click)="overSeaContractSentModal.open()"
                          >
                            Send Overseaes Contract
                          </button>
                          <button
                            class="btn btn-danger"
                            *ngIf="
                              userProfile.role != 'CCO' &&
                              userProfile.role != 'Development Director'
                            "
                            (click)="cancelSendOverseasContract()"
                          >
                            Cancel Send Overseas Contract
                          </button>
                          <button
                            class="btn btn-secondary"
                            *ngIf="
                              userProfile.role != 'CCO' &&
                              userProfile.role != 'Development Director' &&
                              reservation_details?.authorization
                                .can_contract_agent_approve == 1
                            "
                            (click)="firstModal.open(reservation_details?.id)"
                          >
                            Contract Review
                          </button>
                          <button
                            class="btn btn-danger"
                            *ngIf="
                              userProfile.role != 'CCO' &&
                              userProfile.role != 'Development Director' &&
                              reservation_details?.is_contractor_approved == 1
                            "
                            (click)="cancelContractReview()"
                          >
                            Cancel Contract Review
                          </button>
                          <button
                            class="btn btn-secondary"
                            *ngIf="
                              userProfile.role != 'CCO' &&
                              userProfile.role != 'Development Director' &&
                              reservation_details?.authorization
                                .can_generate_contract == 1
                            "
                            [routerLink]="['/pages/projects/conrtact-generate']"
                            [queryParams]="{
                              id: reservation_details?.id,
                              project_id: reservation_details?.unit?.project?.id
                            }"
                          >
                            Contract Generator
                          </button>
                          <button
                            class="btn btn-secondary"
                            (click)="contractSignedByClientModal.open()"
                            *ngIf="
                              userProfile.role != 'CCO' &&
                              userProfile.role != 'Development Director' &&
                              reservation_details?.authorization
                                .can_signed_by_client == 1
                            "
                          >
                            Contract Signed By Client
                          </button>
                          <button
                            class="btn btn-danger"
                            *ngIf="
                              reservation_details?.is_contract_signed == 1 &&
                              userProfile.role != 'CCO' &&
                              userProfile.role != 'Development Director'
                            "
                            (click)="cancelContractSignedByClient()"
                          >
                            Cancel Contract Signed By Client
                          </button>
                          <button
                            class="btn btn-secondary"
                            (click)="contractApproveModal.open()"
                            *ngIf="
                              userProfile.role != 'CCO' &&
                              userProfile.role != 'Development Director' &&
                              reservation_details?.authorization
                                .can_contract_approve == 1
                            "
                          >
                            Contract Sign by CEO
                          </button>
                          <button
                            class="btn btn-danger"
                            *ngIf="
                              userProfile.role != 'CCO' &&
                              userProfile.role != 'Development Director' &&
                              reservation_details?.is_contract_approval == 1
                            "
                            (click)="cancelContractApprove()"
                          >
                            Cancel Contract Signed by CEO
                          </button>
                          <button
                            class="btn btn-secondary"
                            (click)="contractDileveredModal.open()"
                            *ngIf="
                              userProfile.role != 'CCO' &&
                              userProfile.role != 'Development Director' &&
                              reservation_details?.authorization
                                .can_contract_delivered == 1
                            "
                          >
                            Contract Delivered
                          </button>
                          <button
                            class="btn btn-primary"
                            *ngIf="
                              userProfile.role != 'CCO' &&
                              userProfile.role != 'Development Director' &&
                              reservation_details?.contract_delivered == 1
                            "
                            (click)="cancelContractDelivered()"
                          >
                            Cancel Contract Delivered
                          </button>
                          <button
                            class="btn btn-primary"
                            *ngIf="
                              userProfile.role == 'Admin' ||
                              userProfile.role == 'Moderator' ||
                              userProfile.role == 'AR Manager' ||
                              userProfile.role == 'A.R Accountant' ||
                              userProfile.role == 'Contractor'
                            "
                            (click)="contractToBeDelivered()"
                          >
                            Contract To Be Delivered
                          </button>
                          <button
                            class="btn btn-primary"
                            *ngIf="
                              userProfile.role == 'Admin' ||
                              userProfile.role == 'Super Development'
                            "
                            (click)="addContractLogModal.open()"
                          >
                            Add Contract Log
                          </button>
                        </div>
                      </div>
                      <ng-container
                        *ngIf="
                          userProfile.role == 'Admin' ||
                          userProfile.role == 'Super Development'
                        "
                      >
                        <hr class="hr" />
                        <div class="row">
                          <div class="col-md-8">
                            <div class="time-line">
                              <ul class="list-unstyled">
                                <li
                                  *ngFor="
                                    let log of reservation_details?.contract_logs
                                  "
                                >
                                  <span class="crcle-t"></span>
                                  <div class="tm-content">
                                    <div class="dateformat">
                                      {{ log?.created_at | date : "medium" }}
                                    </div>
                                    <div class="activity-details">
                                      <p>
                                        {{ log?.agent?.name }}
                                        <span class="badge">{{
                                          log?.status
                                        }}</span>
                                      </p>
                                      <p>{{ log?.details }}</p>
                                      <p class="text-muted">
                                        Created By: {{ log?.user?.name }} |
                                        Delivered At:
                                        {{
                                          log?.delivered_at | date : "dd/M/yyyy"
                                        }}
                                      </p>
                                    </div>
                                  </div>
                                </li>
                              </ul>
                            </div>
                          </div>
                        </div>
                      </ng-container>
                    </div>
                  </div>

                  <div role="tabpanel" class="tab-pane" id="lead-info">
                    <div class="box-mrg">
                      <div class="row">
                        <div class="col-xs-4">
                          <ul class="list-unstyled">
                            <li
                              class="row"
                              *ngFor="let user of reservation_details?.users"
                            >
                              <div class="col-xs-6">{{ user?.role }}</div>
                              <div class="col-xs-6">
                                {{ user?.user?.name }}
                              </div>
                            </li>
                            <li
                              class="row"
                              *ngIf="reservation_details?.team?.name"
                            >
                              <div class="col-xs-6">Team :</div>
                              <div class="col-xs-6">
                                {{ reservation_details?.team?.name }}
                              </div>
                            </li>
                            <li
                              class="row"
                              *ngIf="reservation_details?.branch?.name"
                            >
                              <div class="col-xs-6">Branch :</div>
                              <div class="col-xs-6">
                                {{ reservation_details?.branch?.name }}
                              </div>
                            </li>
                          </ul>
                        </div>
                        <div class="col-xs-4">
                          <ul class="list-unstyled">
                            <li
                              class="row"
                              *ngIf="reservation_details?.created_at"
                            >
                              <div class="col-xs-6">Creation Date :</div>
                              <div class="col-xs-6">
                                {{ reservation_details?.created_at }}
                              </div>
                            </li>
                            <li
                              class="row"
                              *ngIf="reservation_details?.selling_date"
                            >
                              <div class="col-xs-6">Selling Date :</div>
                              <div class="col-xs-6">
                                {{ reservation_details?.selling_date }}
                              </div>
                            </li>
                            <!-- <li class="row">
                              <div class="col-xs-6">
                                Last Modify By :
                              </div>
                              <div class="col-xs-6">
                                missing
                              </div>
                            </li> -->
                          </ul>
                        </div>
                        <div
                          class="col-xs-3 col-xs-offset-1 operation-buttons"
                          *ngIf="
                            !isReadonlyMode &&
                            userProfile.role != 'Legal and Technical' &&
                            userProfile.role != 'Super Development' &&
                            userProfile.role != 'Facility'
                          "
                        >
                          <button
                            class="btn btn-secondary"
                            *ngIf="
                              userProfile.role != 'CCO' &&
                              userProfile.role != 'Development Director' &&
                              reservation_details?.authorization
                                .can_change_signature_date == 1
                            "
                            (click)="changeSignatureModal.open()"
                          >
                            Change Signature Date
                          </button>
                          <button
                            class="btn btn-secondary"
                            *ngIf="
                              (userProfile?.role == 'Admin' ||
                                userProfile.role == 'Super Development' ||
                                userProfile?.role == 'Moderator' ||
                                userProfile?.role == 'Super Moderator') &&
                              userProfile.role != 'Development Director' &&
                              userProfile.role != 'CCO'
                            "
                            (click)="changeSellingDateModal.open()"
                          >
                            Change Selling Date
                          </button>
                          <button
                            class="btn btn-secondary first-btn"
                            (click)="
                              assignModal.open(reservation_details?.unit.id)
                            "
                            *ngIf="
                              (userProfile?.role == 'Admin' ||
                                userProfile.role == 'Super Development' ||
                                userProfile?.role == 'Moderator' ||
                                userProfile?.role == 'Super Moderator') &&
                              userProfile.role != 'Development Director' &&
                              userProfile.role != 'CCO'
                            "
                          >
                            Assign to Agent
                          </button>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div
                    role="tabpanel"
                    class="tab-pane"
                    id="comment"
                    *ngIf="
                      userProfile.role === 'Admin' ||
                      userProfile.role == 'Super Development'
                    "
                  >
                    <div class="box-mrg">
                      <div class="row">
                        <div class="col-xs-8">
                          <ul class="list-unstyled">
                            <li class="row">
                              <div class="col-xs-6">Comment :</div>
                              <div
                                *ngIf="reservation_details?.comment"
                                class="col-xs-6"
                              >
                                {{ reservation_details?.comment }}
                              </div>
                              <div
                                *ngIf="!reservation_details?.comment"
                                class="col-xs-6"
                              >
                                No Comment Available.
                              </div>
                            </li>
                          </ul>
                        </div>
                        <div
                          class="col-xs-3 col-xs-offset-1 operation-buttons"
                          *ngIf="userProfile.role != 'Super Development'"
                        >
                          <!-- <button
                            class="btn btn-secondary"
                            *ngIf="
                              reservation_details.authorization
                                .can_add_comment == 1 &&
                              userProfile.role != 'CCO' &&
                              userProfile.role != 'Legal and Technical'
                            "
                            (click)="commentModal.open(reservation_details)"
                          > -->
                          <button
                            class="btn btn-secondary"
                            (click)="commentModal.open(reservation_details)"
                          >
                            Add Comment
                          </button>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div role="tabpanel" class="tab-pane" id="unit-layout">
                    <div class="box-mrg">
                      <div class="row" style="text-align: center">
                        <div class="col-md-12">
                          <!-- <section class="slideshow">
                                                      <div class="slideshow-container slide">
                                                        <img
                                                          *ngFor="let unit_img of reservation_details?.unit?.layout_images; let i = index" [src]="unit_img.url"
                                                          (click)="openUnitLAyoutGallery(reservation_details?.unit?.layout_images, i)">
                                                      </div>
                                                    </section> -->
                          <div
                            class="unit-slider-container"
                            *ngIf="
                              reservation_details?.unit?.layout_images &&
                              reservation_details?.unit?.layout_images?.length >
                                0
                            "
                          >
                            <div class="prev" (click)="prevSlide()">
                              &#10094;
                            </div>
                            <pinch-zoom [wheel]="false">
                              <img
                                [src]="
                                  reservation_details?.unit?.layout_images[
                                    currentSlide
                                  ].url
                                "
                              />
                            </pinch-zoom>
                            <div class="next" (click)="nextSlide()">
                              &#10095;
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div role="tabpanel" class="tab-pane" id="activity-log">
                    <div class="col-md-8">
                      <div class="time-line">
                        <ul class="list-unstyled">
                          <li *ngFor="let item of reservation_details?.logs">
                            <span class="crcle-t"></span>
                            <div class="tm-content">
                              <div class="dateformat">
                                {{ item?.created_at | date : "medium" }}
                              </div>
                              <div class="activity-details">
                                {{ item?.details }}
                              </div>
                            </div>
                          </li>
                        </ul>
                      </div>
                    </div>
                  </div>

                  <div
                    role="tabpanel"
                    class="tab-pane"
                    id="payment-collections"
                  >
                    <div
                      class="col-md-12 margin-top-20"
                      *ngIf="reservation_details?.collected_cheques_percentage"
                    >
                      <h4>
                        Collected Cheques Percentage:
                        {{ reservation_details?.collected_cheques_percentage }}
                        %
                      </h4>
                    </div>
                    <div
                      class="col-md-12 payment-collections-actions"
                      *ngIf="userProfile?.role != 'Super Development'"
                    >
                      <p
                        class="is-final-payment-info"
                        *ngIf="
                          reservation_details?.is_final_plan_confirmed == 1
                        "
                      >
                        (تم تأكيد طريقة الدفع النهائية)
                      </p>
                      <p
                        class="is-final-payment-info"
                        *ngIf="
                          reservation_details?.is_final_plan_confirmed == 0
                        "
                      >
                        (لم يتم تأكيد طريقة الدفع النهائية)
                      </p>
                      <button
                        class="btn btn-secondary"
                        (click)="addChequeModal.open()"
                        *ngIf="
                          userProfile?.role == 'Admin' ||
                          userProfile.role == 'Super Development' ||
                          userProfile?.role == 'A.R Accountant'
                        "
                      >
                        Add Payment
                      </button>
                      <button
                        class="btn btn-secondary"
                        (click)="enablePaymentCollectionEdit(true)"
                        *ngIf="
                          !enable_edit_payment_collections &&
                          (userProfile?.role == 'Admin' ||
                            userProfile.role == 'Super Development' ||
                            userProfile?.role == 'CFO' ||
                            userProfile?.role == 'CEO' ||
                            userProfile?.role == 'A.R Accountant' ||
                            userProfile?.role == 'Treasury Accountant')
                        "
                      >
                        Enable Edit
                      </button>
                      <button
                        class="btn btn-secondary decline-btn"
                        (click)="enablePaymentCollectionEdit(false)"
                        *ngIf="enable_edit_payment_collections"
                      >
                        Discard
                      </button>
                      <button
                        class="btn btn-primary"
                        (click)="savePaymnetcollection()"
                        *ngIf="enable_edit_payment_collections"
                        [disabled]="
                          disableSavePaymentCollection ||
                          ((userProfile?.role == 'Admin' ||
                            userProfile.role == 'Super Development' ||
                            userProfile?.role == 'A.R Accountant') &&
                            reservation_details?.unit_price -
                              totalChequeBookAmount !=
                              0)
                        "
                      >
                        Save
                      </button>
                      <button
                        *ngIf="
                          userProfile?.role == 'Admin' ||
                          userProfile.role == 'Super Development' ||
                          userProfile?.role == 'CFO' ||
                          userProfile?.role == 'CEO' ||
                          userProfile?.role == 'A.R Accountant' ||
                          userProfile?.role == 'Treasury Accountant' ||
                          userProfile?.role == 'G.L Accountant'
                        "
                        class="btn btn-primary"
                        (click)="addCDB.open()"
                      >
                        Add CDB
                      </button>
                      <button
                        *ngIf="
                          userProfile?.role == 'Admin' ||
                          userProfile.role == 'Super Development' ||
                          userProfile?.role == 'CFO' ||
                          userProfile?.role == 'CEO' ||
                          userProfile?.role == 'A.R Accountant' ||
                          userProfile?.role == 'Treasury Accountant'
                        "
                        class="btn btn-primary"
                        (click)="printPaymentsPdf()"
                      >
                        Print Payments Pdf
                      </button>
                      <button
                        *ngIf="
                          userProfile?.role == 'Admin' ||
                          userProfile.role == 'Super Development' ||
                          userProfile?.role == 'CFO' ||
                          userProfile?.role == 'CEO' ||
                          userProfile?.role == 'A.R Accountant' ||
                          userProfile?.role == 'Treasury Accountant'
                        "
                        class="btn btn-primary"
                        (click)="printPaymentCollectionModal.open()"
                      >
                        Print
                      </button>
                      <button
                        class="btn btn-primary"
                        (click)="disableSelectedReminder(disableReminder)"
                      >
                        Disable Selected Reminder
                      </button>
                      <button
                        class="btn btn-primary"
                        (click)="enableSelectedReminder(enableReminder)"
                      >
                        Enable Selected Reminder
                      </button>
                      <button
                        class="btn btn-primary"
                        (click)="collectSelectedCheque(collectCheque)"
                      >
                        Collect Selected
                      </button>
                      <button
                        class="btn btn-primary"
                        (click)="
                          rejectSelectedCheque(rejectPaymentCollectionModal)
                        "
                      >
                        Bounce Selected
                      </button>
                      <button
                        class="btn btn-primary"
                        (click)="printSelectedCheque()"
                      >
                        Print Selected
                      </button>
                    </div>
                    <div
                      class="col-md-12 text-center mt-3"
                      *ngIf="enable_edit_payment_collections"
                    >
                      <p class="lead m-0">
                        <b>Total Cheques Amount: </b>
                        {{ totalChequeBookAmount | currency : " " }}
                      </p>
                      <p class="lead m-0">
                        <b>Total CDB Amount: </b>
                        {{ totalCDBAmount | currency : " " }}
                      </p>
                      <p
                        class="lead m-0"
                        [ngClass]="{
                          'text-danger':
                            reservation_details?.unit_price -
                              totalChequeBookAmount !==
                            0,
                          'text-success':
                            reservation_details?.unit_price -
                              totalChequeBookAmount ==
                            0
                        }"
                      >
                        <b>Cheques Amount Difference: </b>
                        {{
                          reservation_details?.unit_price -
                            totalChequeBookAmount
                        }}
                      </p>
                    </div>
                    <div
                      class="col-md-12 text-center mt-3"
                      *ngIf="enable_edit_payment_collections"
                    >
                      <input
                        type="checkbox"
                        [(ngModel)]="ListEdits_inputs"
                        name="list_edits"
                        id="list_edits"
                      />
                      <label for="list_edits"
                        >List Edits To All Rows Below</label
                      >
                    </div>
                    <div class="col-md-12" style="margin-top: 30px">
                      <div class="table table-responsive">
                        <table class="table table-responsive table-bordered">
                          <tr>
                            <th>
                              <input
                                type="checkbox"
                                [(ngModel)]="check_all"
                                name="check_all"
                                (ngModelChange)="onCheckAllToggle($event)"
                              />
                            </th>
                            <th>Stage</th>
                            <th>Client Name</th>
                            <th>Name</th>
                            <th>Collect Method</th>
                            <th>Customer Bank</th>
                            <th>Location</th>
                            <th>RF Serial</th>
                            <th>Unit Serial</th>
                            <th>Cheque / Transaction No.</th>
                            <th>Received Amount</th>
                            <th>Remaining Amount</th>
                            <th>Total Amount</th>
                            <th>Early Payment Discount</th>
                            <th>Payment Date</th>
                            <th>Status</th>
                            <th>Payment Type</th>
                            <th>Reminder Status</th>
                            <th>Reminder Reason</th>
                            <th>Bounce Reason</th>
                            <th>Action Date</th>
                            <th
                              *ngIf="userProfile?.role != 'Super Development'"
                            >
                              Action
                            </th>
                          </tr>
                          <tr
                            *ngFor="
                              let list of payment_collections;
                              let index = index
                            "
                            [ngClass]="{
                              'bg-success': list.status == 'collected',
                              'bg-danger': list.status == 'bounced',
                              'border-row-danger': list.is_bulk == 1
                            }"
                            class="payment-collections"
                          >
                            <td>
                              <input
                                type="checkbox"
                                name="checked"
                                [(ngModel)]="list.checked"
                                [checked]="list.checked"
                              />
                            </td>
                            <td>
                              {{
                                list.send_to_treasury
                                  ? list.is_treasury_approve
                                    ? "Treasury"
                                    : "Pending Treasury Approve"
                                  : "AR"
                              }}
                            </td>
                            <td>
                              {{ list?.lead?.name }}
                            </td>
                            <td>{{ list.name }}</td>
                            <td>
                              <select
                                class="form-control min-width-200"
                                [(ngModel)]="list.partially_method"
                                name="partially_method_{{ index }}"
                                [disabled]="!enable_edit_payment_collections"
                              >
                                <option
                                  *ngFor="
                                    let method of partially_methods;
                                    let i = index
                                  "
                                  value="{{ i + 1 }}"
                                >
                                  {{ method }}
                                </option>
                              </select>
                            </td>
                            <td>
                              <select
                                (change)="
                                  ListEdits_inputs && onBankBlur($event, index)
                                "
                                class="form-control min-width-200"
                                [(ngModel)]="list.bank_id"
                                name="{{ list.bank_id }}"
                                [disabled]="!enable_edit_payment_collections"
                              >
                                <option
                                  *ngFor="let bank of banks"
                                  [value]="bank.id"
                                >
                                  {{ bank.name }}
                                </option>
                              </select>
                            </td>
                            <td>
                              <select
                                (change)="
                                  ListEdits_inputs &&
                                    onStoreBankBlur($event, index)
                                "
                                class="form-control min-width-200"
                                [(ngModel)]="list.store_status"
                                name="{{ list.store_status }}"
                                [disabled]="!enable_edit_payment_collections"
                              >
                                <option
                                  *ngFor="let bank of store_banks"
                                  [value]="bank.id"
                                >
                                  {{ bank.name }}
                                </option>
                              </select>
                            </td>
                            <td>{{ list.reservation_id }}</td>
                            <td>{{ list.unit?.serial }}</td>
                            <td>
                              <input
                                (blur)="
                                  ListEdits_inputs &&
                                    onChequeNumberBlur($event, index)
                                "
                                type="number"
                                class="table-input"
                                [disabled]="!enable_edit_payment_collections"
                                [(ngModel)]="list.cheque_number"
                                name="{{ list.cheque_number }}"
                              />
                            </td>
                            <td>
                              {{ list?.amount_received | currency : " " }}
                            </td>
                            <td>
                              {{ list?.remaining_amount | currency : " " }}
                            </td>
                            <td
                              *ngIf="
                                !(
                                  enable_edit_payment_collections &&
                                  (userProfile?.role == 'Admin' ||
                                    userProfile.role == 'Super Development' ||
                                    userProfile?.role == 'A.R Accountant')
                                )
                              "
                            >
                              {{ list?.amount | currency : " " }}
                            </td>
                            <td
                              *ngIf="
                                enable_edit_payment_collections &&
                                (userProfile?.role == 'Admin' ||
                                  userProfile.role == 'Super Development' ||
                                  userProfile?.role == 'A.R Accountant')
                              "
                            >
                              <input
                                type="text"
                                class="table-input"
                                [(ngModel)]="list.amount"
                                (ngModelChange)="onChequeAmountChanged()"
                                name="{{ list.amount }}"
                              />
                            </td>
                            <td>
                              {{
                                list?.early_payment_discount | currency : " "
                              }}
                            </td>
                            <td
                              *ngIf="
                                !(
                                  enable_edit_payment_collections &&
                                  (userProfile?.role == 'Admin' ||
                                    userProfile.role == 'Super Development' ||
                                    userProfile?.role ==
                                      'Treasury Accountant' ||
                                    userProfile?.role == 'A.R Accountant')
                                )
                              "
                            >
                              {{ list.date }}
                            </td>
                            <td
                              *ngIf="
                                enable_edit_payment_collections &&
                                (userProfile?.role == 'Admin' ||
                                  userProfile.role == 'Super Development' ||
                                  userProfile?.role == 'Treasury Accountant' ||
                                  userProfile?.role == 'A.R Accountant')
                              "
                            >
                              <input
                                type="date"
                                class="table-input"
                                [(ngModel)]="list.date"
                                (change)="
                                  ListEdits_inputs &&
                                    onChequeDateChanged($event, index)
                                "
                                name="{{ list.date }}"
                              />
                            </td>
                            <td>{{ list.status }}</td>
                            <td>{{ list.installment_type }}</td>
                            <td>
                              {{
                                list?.send_reminder == 0
                                  ? "Disabled"
                                  : "Enabled"
                              }}
                            </td>
                            <td>
                              {{ list?.reminder_reason }}
                            </td>
                            <td>{{ list?.reject_reason }}</td>
                            <td>
                              {{ list?.last_action_date }}
                            </td>
                            <td *ngIf="userProfile.role != 'Super Development'">
                              <div class="dropdown" dropdown>
                                <img
                                  class="more-options-icon"
                                  src="assets/img/show-more-button-with-three-dots.svg"
                                  dropdown-open
                                />
                                <ul class="dropdown-menu">
                                  <!-- <li *ngIf="roles?.role_can_collect" (click)="
                                    acceptPaymentCollection(list.id, index)
                                  ">
                                    <a>
                                      <span>Collect</span>
                                    </a>
                                  </li> -->
                                  <li>
                                    <a
                                      [routerLink]="[
                                        '/pages/payment-collections/',
                                        list.id
                                      ]"
                                      >View</a
                                    >
                                  </li>

                                  <li
                                    *ngIf="
                                      (userProfile.role !==
                                        'Treasury Accountant' ||
                                        !(
                                          list.send_to_treasury &&
                                          !list.is_treasury_approve
                                        )) &&
                                      list.status != 'cancelled' &&
                                      userProfile.role != 'G.L Accountant'
                                    "
                                    (click)="
                                      openDelayFineModal(
                                        AddDelayFineModal,
                                        list
                                      )
                                    "
                                  >
                                    <a>
                                      <span>Add Fine</span>
                                    </a>
                                  </li>
                                  <ng-container
                                    *ngIf="list.status !== 'fully-collected'"
                                  >
                                    <li
                                      (click)="
                                        onOpenCollectCheque(
                                          list.id,
                                          collectCheque
                                        )
                                      "
                                    >
                                      <a>
                                        <span>Collect</span>
                                      </a>
                                    </li>
                                    <li
                                      *ngIf="list.status !== 'cancelled'"
                                      (click)="
                                        onOpenCancelCheque(
                                          list.id,
                                          cancelCheque
                                        )
                                      "
                                    >
                                      <a>
                                        <span>Cancel</span>
                                      </a>
                                    </li>
                                    <li
                                      *ngIf="list.status !== 'bounced'"
                                      (click)="
                                        onOpenRejectCheque(
                                          list.id,
                                          rejectPaymentCollectionModal
                                        )
                                      "
                                    >
                                      <a>
                                        <span>Bounce</span>
                                      </a>
                                    </li>
                                  </ng-container>
                                  <li
                                    *ngIf="list?.receipts?.length > 0"
                                    (click)="
                                      this.current_active_cheque = list;
                                      printReciptChequeModal.open()
                                    "
                                  >
                                    <a>
                                      <span>Print Receipts</span>
                                    </a>
                                  </li>
                                  <li
                                    *ngIf="list?.send_reminder == 1"
                                    (click)="
                                      oOpenDisableReminder(
                                        list.id,
                                        disableReminder
                                      )
                                    "
                                  >
                                    <a>
                                      <span>Disable Reminder</span>
                                    </a>
                                  </li>
                                  <li
                                    *ngIf="
                                      !isReadonlyMode &&
                                      userProfile.role != 'CCO' &&
                                      userProfile.role !=
                                        'Development Director' &&
                                      userProfile.role !=
                                        'Legal and Technical' &&
                                      userProfile.role != 'Facility'
                                    "
                                    (click)="
                                      oOpenEnableReminder(
                                        list.id,
                                        enableReminder
                                      )
                                    "
                                  >
                                    <a>
                                      <span>Enable Reminder</span>
                                    </a>
                                  </li>
                                  <li (click)="printCheque(list.id)">
                                    <a>
                                      <span>Print Cheque</span>
                                    </a>
                                  </li>
                                  <li
                                    (click)="
                                      onOpenUploadScannedCheque(
                                        list.id,
                                        uploadScannedCheques
                                      )
                                    "
                                  >
                                    <a>
                                      <span>Upload Scanned Cheque</span>
                                    </a>
                                  </li>
                                  <li
                                    *ngIf="list?.print_status == 0"
                                    (click)="showCheque(list?.id)"
                                  >
                                    <a>
                                      <span>Show</span>
                                    </a>
                                  </li>
                                  <li
                                    *ngIf="list?.print_status == 1"
                                    (click)="hideCheque(list?.id)"
                                  >
                                    <a>
                                      <span>Hide</span>
                                    </a>
                                  </li>
                                  <li
                                    *ngIf="
                                      userProfile?.role == 'Admin' ||
                                      userProfile.role == 'Super Development' ||
                                      userProfile?.role == 'A.R Accountant'
                                    "
                                    (click)="deleteCheque(list?.id)"
                                  >
                                    <a>
                                      <span>Delete</span>
                                    </a>
                                  </li>
                                </ul>
                              </div>
                            </td>
                          </tr>
                        </table>
                      </div>
                    </div>
                  </div>

                  <div role="tabpanel" class="tab-pane" id="fines">
                    <div class="col-md-12 payment-collections-actions"></div>
                    <div class="col-md-12" style="margin-top: 30px">
                      <div class="table table-responsive">
                        <table class="table table-responsive table-bordered">
                          <tr>
                            <!-- <th>
                              <input
                                type="checkbox"
                                [(ngModel)]="check_all"
                                name="check_all"
                                (ngModelChange)="onCheckAllToggle($event)"
                              />
                            </th> -->
                            <th>Client Name</th>
                            <th>Number of days late</th>
                            <th>Bank Name</th>
                            <th>Store Bank Name</th>
                            <th>RF Serial</th>
                            <th>Unit Serial</th>
                            <th>Cheque Number</th>
                            <th>Received Amount</th>
                            <th>Remaining Amount</th>
                            <th>Total Amount</th>
                            <th>Payment Date</th>
                            <th>Status</th>
                            <th>Collect Types</th>
                            <th>Action</th>
                          </tr>
                          <tr
                            *ngFor="let list of fines; let index = index"
                            [ngClass]="{
                              'bg-success': list.status == 'collected',
                              'bg-danger': list.status == 'bounced'
                            }"
                            class="payment-collections"
                          >
                            <!-- <td>
                              <input
                                type="checkbox"
                                name="checked"
                                [(ngModel)]="list.checked"
                                [checked]="list.checked"
                              />
                            </td> -->
                            <td>
                              {{ list?.lead?.name }}
                            </td>
                            <td>
                              {{ list?.num_days_late }}
                            </td>
                            <td>
                              {{ list?.bank?.name }}
                            </td>
                            <td>
                              {{ list?.store_bank?.name }}
                            </td>
                            <td>{{ list.reservation_id }}</td>
                            <td>{{ list.unit?.serial }}</td>
                            <td>
                              {{ list?.collection_cheque?.cheque_number }}
                            </td>
                            <td>
                              {{ list?.amount_received | currency : " " }}
                            </td>
                            <td>
                              {{ list?.remaining_amount | currency : " " }}
                            </td>
                            <td>
                              {{ list.amount | currency : " " }}
                            </td>
                            <td>
                              {{ list.date }}
                            </td>
                            <td>{{ list.status }}</td>
                            <td>{{ list.collect_types }}</td>
                            <td>
                              <div class="dropdown" dropdown>
                                <img
                                  class="more-options-icon"
                                  src="assets/img/show-more-button-with-three-dots.svg"
                                  dropdown-open
                                />
                                <ul class="dropdown-menu">
                                  <li
                                    (click)="
                                      onOpenCollectChequeFine(
                                        list.id,
                                        collectChequeFine
                                      )
                                    "
                                  >
                                    <a>
                                      <span>Collect</span>
                                    </a>
                                  </li>
                                  <li (click)="deleteFine(list.id)">
                                    <a>
                                      <span>Delete</span>
                                    </a>
                                  </li>
                                </ul>
                              </div>
                            </td>
                          </tr>
                        </table>
                      </div>
                    </div>
                  </div>

                  <div role="tabpanel" class="tab-pane" id="Final-payment-plan">
                    <div class="row" style="margin-top: 30px">
                      <div
                        class="col-md-12"
                        *ngIf="userProfile.role != 'Super Development'"
                      >
                        <button
                          class="btn btn-secondary"
                          (click)="exportFinalPaymentPlan()"
                        >
                          Export final plan <i class="fa fa-download"></i>
                        </button>
                        <button
                          class="btn btn-secondary"
                          (click)="printFinalPaymentPlan()"
                        >
                          Print final plan <i class="fa fa-print"></i>
                        </button>
                        <button
                          class="btn btn-danger"
                          *ngIf="
                            reservation_details?.final_payment_plan_added &&
                            userProfile.role != 'Development Director' &&
                            userProfile.role != 'CCO'
                          "
                          (click)="deleteFinalPaymentCollection()"
                        >
                          Delete Final Payment Collection
                          <i class="fa fa-trash"></i>
                        </button>
                        <div
                          style="margin-top: 30px"
                          *ngIf="
                            userProfile.role != 'Development Director' &&
                            userProfile.role != 'CCO'
                          "
                        >
                          <label
                            >Import final plan <i class="fa fa-upload"></i
                          ></label>
                          <input
                            type="file"
                            accept=".xlsx, .xls"
                            id="unit_excel"
                            #file
                            (change)="onImportPlanChange($event)"
                            class="form-control"
                          />
                          <small
                            >Upload final plan excel sheet (It will upload once
                            you select a file)</small
                          >
                        </div>
                      </div>
                    </div>
                  </div>

                  <div role="tabpanel" class="tab-pane" id="shared-comissions">
                    <div class="col-md-8">
                      <div class="table table-responsive">
                        <tr>
                          <th>Agent Name</th>
                          <th>Agent Commission</th>
                          <th></th>
                        </tr>
                        <ng-container
                          *ngIf="
                            (userProfile?.role == 'Moderator' ||
                              userProfile?.role == 'Super Moderator' ||
                              userProfile?.role == 'Admin' ||
                              userProfile.role == 'Super Development') &&
                              userProfile.role != 'Development Director' &&
                              userProfile.role != 'CCO' &&
                              userProfile.role != 'Legal and Technical' &&
                              userProfile.role != 'Facility';
                            else view_shared_commision
                          "
                        >
                          <tr
                            *ngFor="
                              let agent_commission of sharedAgentsCommissions.controls;
                              let index = index
                            "
                          >
                            <ng-container
                              [formGroup]="agent_commission"
                              *ngIf="
                                (userProfile?.role == 'Moderator' ||
                                  userProfile?.role == 'Super Moderator' ||
                                  userProfile?.role == 'Admin' ||
                                  userProfile.role == 'Super Development') &&
                                  userProfile.role != 'Development Director' &&
                                  userProfile.role != 'CCO' &&
                                  userProfile.role != 'Legal and Technical' &&
                                  userProfile.role != 'Facility';
                                else view_shared_commision
                              "
                            >
                              <td>
                                <!-- <input type="text" class="form-control table-input" formControlName="user_id" name="{{name + index}}"> -->
                                <select
                                  class="form-control"
                                  formControlName="user_id"
                                  name="{{ user_id + index }}"
                                  id="user_id"
                                >
                                  <option
                                    *ngFor="let agent of agents"
                                    [value]="agent?.id"
                                  >
                                    {{ agent?.name }}
                                  </option>
                                </select>
                              </td>
                              <td>
                                <input
                                  type="number"
                                  class="form-control table-input"
                                  formControlName="comission_percentage"
                                  name="{{ name + comission_percentage }}"
                                />
                              </td>
                              <td class="flex-end">
                                <button
                                  (click)="
                                    deleteSharedCommissionFromAgent(index)
                                  "
                                  class="add-commission-inputs-btn remove-btn"
                                >
                                  <i class="fa fa-trash" aria-hidden="true"></i>
                                </button>
                                <button
                                  (click)="addInputsForSharedComissions()"
                                  class="add-commission-inputs-btn"
                                  *ngIf="
                                    sharedAgentsCommissions.controls.length -
                                      1 ==
                                    index
                                  "
                                >
                                  <i class="fa fa-plus" aria-hidden="true"></i>
                                </button>
                              </td>
                            </ng-container>
                          </tr>
                          <tr>
                            <td></td>
                            <td></td>
                            <td>
                              <button
                                (click)="getReservation()"
                                class="save-commission-btn black-btn"
                                *ngIf="userProfile?.role != 'Super Development'"
                              >
                                Discard Changes
                              </button>
                              <button
                                *ngIf="userProfile?.role != 'Super Development'"
                                [ngClass]="{
                                  'no-interaction-on-btn':
                                    disable_save_shared_comission
                                }"
                                (click)="saveSharedCommission()"
                                class="save-commission-btn"
                              >
                                Save
                              </button>
                            </td>
                          </tr>
                        </ng-container>
                        <ng-template #view_shared_commision>
                          <tr
                            *ngFor="
                              let agent_commission of sharedAgentsCommissionsView;
                              let index = index
                            "
                          >
                            <td>
                              {{ agent_commission.user.name }}
                            </td>
                            <td>
                              {{ agent_commission.comission_percentage }}
                            </td>
                            <td class="flex-end"></td>
                          </tr>
                        </ng-template>
                      </div>
                    </div>
                    <div class="col-md-4">
                      <button
                        *ngIf="
                          reservation_details?.is_commission_paid == 1 &&
                          reservation_details?.authorization
                            ?.can_cancel_commission
                        "
                        class="btn btn-secondary btn-danger"
                        (click)="cancelCommission()"
                      >
                        Cancel Commissions
                      </button>
                    </div>
                  </div>

                  <div role="tabpanel" class="tab-pane" id="documents">
                    <ng-container
                      *ngIf="
                        !isReadonlyMode &&
                        !isAccountant &&
                        userProfile.role != 'Development Director' &&
                        userProfile.role != 'Super Development' &&
                        userProfile.role != 'CCO'
                      "
                    >
                      <h3>Add Documents</h3>
                      <form
                        [formGroup]="documentForm"
                        (ngSubmit)="onDocumentSubmit()"
                      >
                        <div class="row">
                          <div class="col-xs-6">
                            <div class="form-group">
                              <label for="">Document Name</label>
                              <input
                                type="text"
                                class="form-control"
                                id="document_name"
                                name="document_name"
                                placeholder="Document Name"
                                formControlName="name"
                                require
                              />
                            </div>
                          </div>
                          <div class="col-xs-6">
                            <div
                              class="form-group"
                              *ngIf="userProfile.role != 'Super Development'"
                            >
                              <label for="">Upload Document</label>
                              <input
                                type="file"
                                id="documentFileInput"
                                #documentFileInput
                                (change)="onFileChange($event)"
                                required
                              />
                            </div>
                          </div>
                          <div class="col-xs-12">
                            <div
                              class="form-group"
                              *ngIf="userProfile.role != 'Super Development'"
                            >
                              <button
                                class="btn btn-primary pull-right"
                                type="submit"
                                [disabled]="documentForm.invalid"
                              >
                                CONFIRM
                              </button>
                            </div>
                          </div>
                        </div>
                      </form>
                    </ng-container>
                    <h4>Documents</h4>
                    <table class="table">
                      <tr>
                        <th>ID</th>
                        <th>Name</th>
                        <th>Is Scan Applied</th>
                        <th>Create At</th>
                        <th>Download</th>
                        <th
                          *ngIf="
                            !isReadonlyMode &&
                            !isAccountant &&
                            userProfile.role != 'Development Director' &&
                            userProfile.role != 'CCO' &&
                            userProfile.role != 'Super Development' &&
                            userProfile.role != 'Legal and Technical' &&
                            userProfile.role != 'Facility'
                          "
                        >
                          Delete
                        </th>
                        <th *ngIf="userProfile.role != 'Super Development'">
                          Upload scanned
                        </th>
                        <td *ngIf="userProfile.role != 'Super Development'">
                          Scanned Files
                        </td>
                        <td *ngIf="userProfile.role != 'Super Development'">
                          Apply scanned
                        </td>
                      </tr>
                      <tr *ngFor="let document of documents">
                        <td>{{ document?.id }}</td>
                        <td>{{ document?.name }}</td>
                        <td>
                          <span
                            *ngIf="
                              document?.scan_by == 1;
                              else scan_not_applied
                            "
                          >
                            Yes
                          </span>
                          <ng-template #scan_not_applied> No </ng-template>
                        </td>
                        <td>{{ document?.created_at }}</td>
                        <td>
                          <a
                            [href]="document.full_url"
                            target="_blank"
                            download="{{ document?.name }}"
                            >Download</a
                          >
                        </td>
                        <td
                          *ngIf="
                            !isReadonlyMode &&
                            !isAccountant &&
                            userProfile.role != 'Development Director' &&
                            userProfile.role != 'Super Development' &&
                            userProfile.role != 'CCO' &&
                            userProfile.role != 'Legal and Technical' &&
                            userProfile.role != 'Facility'
                          "
                        >
                          <button
                            (click)="deleteDocument(document.id)"
                            class="delete-btn"
                          >
                            Delete
                          </button>
                        </td>
                        <td *ngIf="userProfile.role != 'Super Development'">
                          <input
                            type="file"
                            class="form-control"
                            id="document"
                            multiple
                            #fileInput
                            (change)="
                              uploadScanned($event, document.id, fileInput)
                            "
                            required
                          />
                        </td>
                        <td>
                          <a
                            *ngFor="let scanned_files of document?.scans"
                            [href]="scanned_files.full_url"
                            class="d-block margin-top-5"
                            target="_blank"
                            download="{{ document?.name }}"
                          >
                            {{ scanned_files?.name }}
                          </a>
                        </td>
                        <td *ngIf="userProfile.role != 'Super Development'">
                          <button (click)="applyScanned(document.id)">
                            Apply
                          </button>
                        </td>
                      </tr>
                    </table>
                  </div>

                  <div role="tobpanel" class="tab-pane" id="referrals">
                    <h4>Referrals</h4>
                    <table class="table">
                      <tr>
                        <th>Reservation Serial</th>
                        <th>Commission Amount</th>
                        <th>Lead</th>
                        <th>Created At</th>
                      </tr>
                      <tr
                        *ngFor="
                          let referral_lead of reservation_details?.referral_leads
                        "
                      >
                        <td>
                          <a
                            (click)="
                              goToReservation(
                                referral_lead?.referral_reservation
                              )
                            "
                          >
                            {{ referral_lead?.referral_reservation?.id }}
                          </a>
                        </td>
                        <td>
                          {{
                            referral_lead?.commission_amount | currency : " "
                          }}
                        </td>
                        <td>
                          <a
                            (click)="goToLead(referral_lead?.referral_lead?.id)"
                          >
                            {{ referral_lead?.referral_lead?.name }}
                          </a>
                        </td>
                        <td>
                          {{ referral_lead?.created_at }}
                        </td>
                      </tr>
                    </table>
                  </div>

                  <div role="tabpanel" class="tab-pane" id="acknowledgement">
                    <div class="box-mrg">
                      <!-- <div class="row">
                        <div
                          *ngFor="let form of dynamicForms"
                          class="col-xs-3 operation-buttons"
                        >
                          <button
                            class="btn btn-secondary"
                            (click)="
                              onAcknowledgmentFormClick(
                                form,
                                acknowledgmentForm
                              )
                            "
                          >
                            {{ form?.title }}
                          </button>
                        </div>
                      </div> -->
                    </div>
                  </div>

                  <div role="tabpanel" class="tab-pane" id="resale">
                    <div class="box-mrg">
                      <li class="row" style="list-style: none">
                        <div class="col-xs-12 my-10">
                          <div
                            class="flex justify-content-between items-center"
                          >
                            <!-- <h4>Old Customers</h4> -->
                          </div>
                        </div>
                        <div class="col-xs-12">
                          <mat-expansion-panel
                            *ngFor="
                              let lead of reservation_details?.old_customers
                            "
                            style="margin-bottom: 15px"
                          >
                            <mat-expansion-panel-header>
                              <span
                                class="accordion_header"
                                *ngIf="lead?.lead_name"
                              >
                                <strong> Customer Name : </strong>
                                {{ lead?.lead_name }}
                              </span>
                              <span
                                class="accordion_header"
                                *ngIf="lead?.lead_phone"
                              >
                                <strong class="customer-phone">
                                  Customer Phone :
                                </strong>
                                {{ lead?.lead_phone }}
                              </span>
                            </mat-expansion-panel-header>
                            <div class="row">
                              <div class="col-xs-6">
                                <ul class="list-unstyled">
                                  <li class="row" *ngIf="lead?.lead_email">
                                    <div class="col-xs-6">Customer Email :</div>
                                    <div class="col-xs-6">
                                      {{ lead?.lead_email }}
                                    </div>
                                  </li>
                                  <li
                                    class="row"
                                    *ngIf="lead?.lead_national_id"
                                  >
                                    <div class="col-xs-6">
                                      Customer National ID :
                                    </div>
                                    <div class="col-xs-6">
                                      {{ lead?.lead_national_id }}
                                    </div>
                                  </li>
                                  <li
                                    class="row"
                                    *ngIf="lead?.lead_nationality"
                                  >
                                    <div class="col-xs-6">
                                      Customer Nationality :
                                    </div>
                                    <div class="col-xs-6">
                                      {{ lead?.lead_nationality }}
                                    </div>
                                  </li>
                                  <li
                                    class="row"
                                    *ngIf="lead?.lead_other_phone"
                                  >
                                    <div class="col-xs-6">
                                      Customer Other Phone :
                                    </div>
                                    <div class="col-xs-6">
                                      {{ lead?.lead_other_phone }}
                                    </div>
                                  </li>
                                  <li class="row" *ngIf="lead?.lead?.byc?.name">
                                    <div class="col-xs-6">BYC Name :</div>
                                    <div class="col-xs-6">
                                      <a
                                        (click)="goToLead(lead?.lead?.byc?.id)"
                                        >{{ lead?.lead?.byc?.name }}</a
                                      >
                                    </div>
                                  </li>
                                  <li
                                    class="row"
                                    *ngIf="lead?.lead?.byc?.phone"
                                  >
                                    <div class="col-xs-6">BYC Phone :</div>
                                    <div class="col-xs-6">
                                      {{ lead?.lead?.byc?.phone }}
                                    </div>
                                  </li>
                                </ul>
                              </div>
                              <div class="col-xs-6">
                                <ul class="list-unstyled">
                                  <li class="row" *ngIf="lead?.lead_birthday">
                                    <div class="col-xs-6">
                                      Customer Birthday :
                                    </div>
                                    <div class="col-xs-6">
                                      {{ lead?.lead_birthday }}
                                    </div>
                                  </li>
                                  <li class="row" *ngIf="lead?.lead_address">
                                    <div class="col-xs-6">
                                      Customer Address :
                                    </div>
                                    <div class="col-xs-6">
                                      {{ lead?.lead_address }}
                                    </div>
                                  </li>
                                  <li class="row" *ngIf="lead?.lead_district">
                                    <div class="col-xs-6">
                                      Customer District :
                                    </div>
                                    <div class="col-xs-6">
                                      {{ lead?.lead_district }}
                                    </div>
                                  </li>
                                  <li
                                    class="row"
                                    *ngIf="lead?.sharing_percentage"
                                  >
                                    <div class="col-xs-6">
                                      Sharing Percentage :
                                    </div>
                                    <div class="col-xs-6">
                                      {{ lead?.sharing_percentage }}
                                    </div>
                                  </li>
                                </ul>
                              </div>
                              <div
                                class="col-xs-12"
                                style="text-align: right"
                                *ngIf="
                                  userProfile.role != 'CCO' &&
                                  userProfile.role != 'Development Director' &&
                                  userProfile.role != 'Facility'
                                "
                              >
                                <button
                                  class="btn btn-primary"
                                  (click)="
                                    openEditOldCustomerModa(editOldLead, lead)
                                  "
                                  style="
                                    margin-right: 5px;
                                    background-color: #555;
                                    color: white;
                                  "
                                >
                                  Edit Customer info
                                </button>

                                <button
                                  class="btn"
                                  (click)="deleteOldCustomer(lead?.id)"
                                  *ngIf="
                                    userProfile.role != 'CCO' &&
                                    userProfile.role !=
                                      'Development Director' &&
                                    userProfile.role != 'Legal and Technical' &&
                                    userProfile.role != 'Facility'
                                  "
                                >
                                  Delete
                                </button>
                              </div>
                            </div>
                          </mat-expansion-panel>
                        </div>
                      </li>
                    </div>
                  </div>

                  <div role="tabpanel" class="tab-pane" id="legal_action">
                    <div class="box-mrg">
                      <div class="row">
                        <div
                          class="col-md-12 mt-3 d-flex justify-content-end align-items-center"
                        >
                          <div class="col-md-6">
                            <ul class="list-unstyled">
                              <li class="col-md-12 mb-3">
                                <span class="col-md-6">Last Legal Stage:</span>
                                <span class="col-md-6">{{
                                  reservation_details?.legal_type_text
                                }}</span>
                              </li>
                              <li class="col-md-12">
                                <span class="col-md-6"
                                  >Last Legal Comment:</span
                                >
                                <span class="col-md-6">{{
                                  reservation_details?.last_legal_note
                                }}</span>
                              </li>
                            </ul>
                          </div>
                          <div class="col-md-6 d-flex justify-content-end">
                            <button
                              *ngIf="
                                userProfile.role == 'Admin' ||
                                userProfile.role == 'Legal and Technical' ||
                                userProfile.role == 'Legal Head'
                              "
                              class="btn btn-primary"
                              (click)="legalAction.open()"
                            >
                              Legal Action
                            </button>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div role="tabpanel" class="tab-pane" id="handover_status">
                    <div class="box-mrg">
                      <div class="row">
                        <div
                          class="col-md-12 mt-3 d-flex justify-content-end align-items-center"
                        >
                          <div class="col-md-6">
                            <ul class="list-unstyled">
                              <li class="col-md-12 mb-3">
                                <span class="col-md-6">HandOver Status:</span>
                                <span class="col-md-6">{{
                                  reservation_details?.handover_status
                                }}</span>
                              </li>
                              <li class="col-md-12">
                                <span class="col-md-6">HandOver Date:</span>
                                <span class="col-md-6">{{
                                  reservation_details?.handover_date | date
                                }}</span>
                              </li>
                            </ul>
                          </div>
                          <div class="col-md-6 d-flex justify-content-end">
                            <button
                              *ngIf="
                                userProfile.email ==
                                  'fabricasupport@castle.com' ||
                                userProfile.email == 'f.shaker@cred-eg.com' ||
                                userProfile.email == 'm.badr@cred-eg.com' ||
                                userProfile.role == 'Helpdesk Agent' ||
                                userProfile.role == 'Helpdesk Supervisor'
                              "
                              class="btn btn-primary"
                              (click)="handoverAction.open()"
                            >
                              HandOver Action
                            </button>
                          </div>
                        </div>
                        <div class="col-md-8">
                          <div class="time-line">
                            <ul class="list-unstyled">
                              <li *ngFor="let item of handoverLogs">
                                <span class="crcle-t"></span>
                                <div class="tm-content">
                                  <div class="dateformat">
                                    {{ item?.created_at | date : "medium" }}
                                  </div>
                                  <div class="activity-details">
                                    {{ item?.details }}
                                  </div>
                                </div>
                              </li>
                            </ul>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div role="tabpanel" class="tab-pane" id="tickets">
                    <div
                      class="d-flex justify-content-between align-items-center"
                    >
                      <div class="col-xs-4">
                        <h3>Tickets</h3>
                      </div>
                      <div class="col-xs">
                        <button
                          class="btn btn-secoundary"
                          [routerLink]="['/pages/add-ticket']"
                          [queryParams]="{ reservation_id: reservationId }"
                        >
                          Add Ticket
                        </button>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-md-12">
                        <div class="table table-responsive">
                          <table class="table table-bordered">
                            <tr>
                              <th>Ticket ID</th>
                              <th>Priority</th>
                              <th>Type</th>
                              <th>Source</th>
                              <th>Lead Name</th>
                              <th>Lead Phone</th>
                              <th>Customer Name</th>
                              <th>Customer Phone</th>
                              <th>Assigned To</th>
                              <th>Department</th>
                              <th>Description</th>
                              <th>Created At</th>
                              <th>Created By</th>
                              <th>Action</th>
                            </tr>

                            <tr *ngFor="let ticket of tickets">
                              <td>#{{ ticket.id || "-" }}</td>
                              <td>{{ ticket.priority?.name || "-" }}</td>
                              <td>{{ ticket.type?.name || "-" }}</td>
                              <td>{{ ticket.source?.name || "-" }}</td>
                              <td
                                class="routable"
                                title="opens the lead in new page"
                                (click)="viewLead(ticket?.lead?.id)"
                              >
                                {{ ticket.lead?.name || "-" }}
                              </td>
                              <td>{{ ticket.lead?.phone || "-" }}</td>
                              <td>{{ ticket.customer?.name || "-" }}</td>
                              <td>{{ ticket.customer?.phone || "-" }}</td>
                              <td>{{ ticket.assigned_user?.name || "-" }}</td>
                              <td>{{ ticket.department?.name || "-" }}</td>
                              <td>{{ getTicketDescription(ticket) }}</td>
                              <td>{{ ticket.created_at || "-" }}</td>
                              <td>{{ ticket.user?.name }}</td>
                              <td>
                                <div class="dropdown" dropdown>
                                  <img
                                    class="more-options-icon"
                                    src="assets/img/show-more-button-with-three-dots.svg"
                                    dropdown-open
                                  />
                                  <ul class="dropdown-menu">
                                    <li (click)="goToTicketView(ticket.id)">
                                      <a>
                                        <span class="doc_link">View</span>
                                      </a>
                                    </li>

                                    <li
                                      *ngIf="
                                        ticket.permissions.can_edit_ticket &&
                                        role != 'CCO'
                                      "
                                      (click)="goToEditTicket(ticket.id)"
                                    >
                                      <a>
                                        <span class="doc_link">Edit</span>
                                      </a>
                                    </li>
                                  </ul>
                                </div>
                              </td>
                            </tr>

                            <tr *ngIf="!tickets || tickets.length == 0">
                              <td colspan="15">
                                <h4>No Data Found</h4>
                              </td>
                            </tr>
                          </table>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="col-xs-12 margin-top">
          <button
            class="btn btn-default btn-black"
            [routerLink]="['/pages/reservations/']"
          >
            BACK
          </button>
        </div>
      </div>
    </div>
  </section>

  <modal
    #handoverAction
    title="Add Handover Action"
    submitButtonLabel="Add"
    modalClass="modal-md"
    [hideCloseButton]="true"
    [closeOnOutsideClick]="true"
    (onSubmit)="addHandoverActionSubmit(handoverAction)"
  >
    <modal-header> </modal-header>
    <modal-content>
      <div class="row">
        <div class="col-md-6">
          <div class="form-group">
            <label for="">Handover Status</label>
            <select class="form-control" [(ngModel)]="handover_status">
              <option selected disabled>None</option>
              <option value="Handed over">Handed over</option>
              <option value="Implied handed over">Implied handed over</option>
            </select>
          </div>
        </div>
        <div class="col-md-6">
          <div class="form-group">
            <label for="">Handover Date</label>
            <input
              type="date"
              id="handover_date"
              name="handover_date"
              [(ngModel)]="handover_date"
              class="form-control"
            />
          </div>
        </div>
      </div>
    </modal-content>
    <modal-footer>
      <button class="btn btn-secondary" (click)="handoverAction.close()">
        close
      </button>
    </modal-footer>
  </modal>

  <modal
    #legalAction
    title="Add Legal Action"
    submitButtonLabel="Add"
    modalClass="modal-md"
    [hideCloseButton]="true"
    [closeOnOutsideClick]="true"
    (onSubmit)="addLegalActionSubmit(legalAction)"
  >
    <modal-header> </modal-header>
    <modal-content>
      <div class="row">
        <div class="col-md-6">
          <div class="form-group">
            <label for="">Legal Stage</label>
            <select class="form-control" [(ngModel)]="legal_type">
              <option value="none">None</option>
              <option value="1">Legal Action</option>
              <option value="2">Under Legal Termination</option>
              <option value="3">Unit Terminated</option>
              <option value="4">Payment Settled</option>
            </select>
          </div>
        </div>
        <div class="col-md-6">
          <div class="form-group">
            <label for="">Comment</label>
            <textarea
              class="form-control"
              cols="5"
              rows="5"
              [(ngModel)]="legal_note"
            >
            </textarea>
          </div>
        </div>
      </div>
    </modal-content>
    <modal-footer>
      <button class="btn btn-secondary" (click)="legalAction.close()">
        close
      </button>
    </modal-footer>
  </modal>

  <modal
    #addOldCustomer
    title="Assign Customer"
    submitButtonLabel="Add"
    modalClass="modal-md"
    [hideCloseButton]="true"
    [closeOnOutsideClick]="true"
    (onSubmit)="addOldCustomerSubmit(addOldCustomer)"
  >
    <modal-header> </modal-header>
    <modal-content>
      <div class="row">
        <div class="col-md-12">
          <div class="form-group">
            <label>Search leads :</label>
            <div class="search-btn-container">
              <div style="margin-bottom: 10px">
                <input
                  ngui-auto-complete
                  [source]="customerSource.bind(this)"
                  placeholder="Search for lead by name "
                  class="form-control"
                  name="chosenCustomer"
                  [(ngModel)]="chosenCustomer"
                />
              </div>
              <button
                class="btn btn-default pull-right btn-black"
                type="button"
                [disabled]="!chosenCustomer"
                (click)="getCustomerDetails()"
              >
                Get info
              </button>
            </div>
          </div>
        </div>
      </div>

      <div class="row">
        <div class="col-md-6">
          <div class="form-group">
            <label for="">Customer Name</label>
            <input
              type="text"
              name="lead_name"
              [(ngModel)]="addCustomerForm.lead_name"
              class="form-control"
            />
          </div>
        </div>
        <div class="col-md-6">
          <div class="form-group">
            <label for="">Customer Phone</label>
            <input
              type="number"
              name="lead_phone"
              [(ngModel)]="addCustomerForm.lead_phone"
              class="form-control"
            />
          </div>
        </div>
      </div>

      <div class="row">
        <div class="col-md-6">
          <div class="form-group">
            <label for="">Customer Email</label>
            <input
              type="email"
              name="lead_email"
              [(ngModel)]="addCustomerForm.lead_email"
              class="form-control"
            />
          </div>
        </div>
        <div class="col-md-6">
          <div class="form-group">
            <label for="">Customer National ID</label>
            <input
              type="text"
              name="lead_national_id"
              [(ngModel)]="addCustomerForm.lead_national_id"
              class="form-control"
            />
          </div>
        </div>
      </div>

      <div class="row">
        <div class="col-md-6">
          <div class="form-group">
            <label for="">Customer Nationality</label>
            <input
              type="text"
              name="lead_nationality"
              [(ngModel)]="addCustomerForm.lead_nationality"
              class="form-control"
            />
          </div>
        </div>
        <div class="col-md-6">
          <div class="form-group">
            <label for="">Customer Other Phone</label>
            <input
              type="number"
              name="lead_other_phone"
              [(ngModel)]="addCustomerForm.lead_other_phone"
              class="form-control"
            />
          </div>
        </div>
      </div>

      <div class="row">
        <div class="col-md-6">
          <div class="form-group">
            <label for="">Customer Birthday</label>
            <input
              type="date"
              name="lead_birthday"
              [(ngModel)]="addCustomerForm.lead_birthday"
              class="form-control"
            />
          </div>
        </div>
        <div class="col-md-6">
          <div class="form-group">
            <label for="">Customer Address</label>
            <input
              type="text"
              name="lead_address"
              [(ngModel)]="addCustomerForm.lead_address"
              class="form-control"
            />
          </div>
        </div>
      </div>

      <div class="row">
        <div class="col-md-6">
          <div class="form-group">
            <label for="">Customer District</label>
            <input
              type="text"
              name="lead_district"
              [(ngModel)]="addCustomerForm.lead_district"
              class="form-control"
            />
          </div>
        </div>
        <div class="col-md-6">
          <div class="form-group">
            <label for="">Sharing Percentage</label>
            <input
              type="number"
              name="sharing_percentage"
              [(ngModel)]="addCustomerForm.sharing_percentage"
              class="form-control"
            />
          </div>
        </div>
      </div>
    </modal-content>
    <modal-footer>
      <button class="btn btn-secondary" (click)="addOldCustomer.close()">
        close
      </button>
    </modal-footer>
  </modal>

  <modal
    #editOldLead
    title="Edit Customer Info"
    submitButtonLabel="update"
    modalClass="modal-md"
    [hideCloseButton]="true"
    [closeOnOutsideClick]="true"
    (onSubmit)="editOldLeadModalSubmit(editOldLead)"
  >
    <modal-header> </modal-header>
    <modal-content>
      <div class="row">
        <div class="col-md-6">
          <div class="form-group">
            <label for="">Customer Name</label>
            <input
              type="text"
              name="lead_name"
              [(ngModel)]="old_customer.lead_name"
              class="form-control"
            />
          </div>
        </div>
        <div class="col-md-6">
          <div class="form-group">
            <label for="">Customer Phone</label>
            <input
              type="number"
              name="lead_phone"
              [(ngModel)]="old_customer.lead_phone"
              class="form-control"
            />
          </div>
        </div>
      </div>

      <div class="row">
        <div class="col-md-6">
          <div class="form-group">
            <label for="">Customer Email</label>
            <input
              type="email"
              name="lead_email"
              [(ngModel)]="old_customer.lead_email"
              class="form-control"
            />
          </div>
        </div>
        <div class="col-md-6">
          <div class="form-group">
            <label for="">Customer National ID</label>
            <input
              type="text"
              name="lead_national_id"
              [(ngModel)]="old_customer.lead_national_id"
              class="form-control"
            />
          </div>
        </div>
      </div>

      <div class="row">
        <div class="col-md-6">
          <div class="form-group">
            <label for="">Customer Nationality</label>
            <input
              type="text"
              name="lead_nationality"
              [(ngModel)]="old_customer.lead_nationality"
              class="form-control"
            />
          </div>
        </div>
        <div class="col-md-6">
          <div class="form-group">
            <label for="">Customer Other Phone</label>
            <input
              type="number"
              name="lead_other_phone"
              [(ngModel)]="old_customer.lead_other_phone"
              class="form-control"
            />
          </div>
        </div>
      </div>

      <div class="row">
        <div class="col-md-6">
          <div class="form-group">
            <label for="">Customer Birthday</label>
            <input
              type="date"
              name="lead_birthday"
              [(ngModel)]="old_customer.lead_birthday"
              class="form-control"
            />
          </div>
        </div>
        <div class="col-md-6">
          <div class="form-group">
            <label for="">Customer Address</label>
            <input
              type="text"
              name="lead_address"
              [(ngModel)]="old_customer.lead_address"
              class="form-control"
            />
          </div>
        </div>
      </div>

      <div class="row">
        <div class="col-md-6">
          <div class="form-group">
            <label for="">Customer District</label>
            <input
              type="text"
              name="lead_district"
              [(ngModel)]="old_customer.lead_district"
              class="form-control"
            />
          </div>
        </div>
        <div class="col-md-6">
          <div class="form-group">
            <label for="">Sharing Percentage</label>
            <input
              type="number"
              name="sharing_percentage"
              [(ngModel)]="old_customer.sharing_percentage"
              class="form-control"
            />
          </div>
        </div>
      </div>
    </modal-content>
    <modal-footer>
      <button class="btn btn-secondary" (click)="editOldLead.close()">
        close
      </button>
    </modal-footer>
  </modal>

  <modal
    #assignModal
    title="Assign Reservation to Lead"
    submitButtonLabel="submit"
    modalClass="modal-md"
    [hideCloseButton]="true"
    [closeOnOutsideClick]="true"
    (onOpen)="openAssignModal(reservation_details?.unit.id)"
    (onClose)="closeAssignModal()"
    (onSubmit)="submitAssignModal(reservation_details?.id, assignModal)"
  >
    <modal-header> </modal-header>
    <modal-content>
      <div class="search">
        <label for="">Search for Property Consultant :</label>
        <input
          ngui-auto-complete
          [source]="filterLeadObservable.bind(this)"
          placeholder=""
          [ngModelOptions]="{ standalone: true }"
          (valueChanged)="valueChanged($event)"
          class="form-control"
          name="filterAgentByWordText"
          [(ngModel)]="filterAgentByWordText"
        />
      </div>
    </modal-content>
    <modal-footer>
      <button class="btn btn-secondary" (click)="assignModal.close()">
        close
      </button>
    </modal-footer>
  </modal>

  <modal
    #editSellingPriceModal
    title="Change Selling Price"
    submitButtonLabel="submit"
    modalClass="modal-md"
    [hideCloseButton]="true"
    [closeOnOutsideClick]="true"
    (onOpen)="openEditSellingPriceModal(reservation_details)"
    (onClose)="closeEditSellingPriceModal(editSellingPriceModal)"
    (onSubmit)="
      submiteditSellingPriceModal(reservation_details, editSellingPriceModal)
    "
  >
    <modal-header> </modal-header>
    <modal-content>
      <div class="row">
        <form>
          <div class="form-group col-md-6">
            <label for="" class="price-label">Selling Price :</label>
            <input
              type="number"
              class="form-control"
              name="price"
              [(ngModel)]="selling_price_in_modal"
              (input)="sellingPriceChange($event)"
              disabled
            />
          </div>
          <div class="form-group col-md-6">
            <label for="">Discount On :</label>
            <select
              class="form-control"
              name="discount_on"
              id="discount_on"
              [(ngModel)]="discount_on"
            >
              <option value="garage">garage</option>
              <option value="storage">storage</option>
              <option value="unit">unit</option>
            </select>
          </div>
          <div class="form-group col-md-6">
            <label for="">Type :</label>
            <select
              class="form-control"
              name="type_extra_discount"
              id="type_extra_discount"
              [(ngModel)]="type_extra_discount"
            >
              <option value="percentage">percentage</option>
              <option value="amount">amount</option>
            </select>
          </div>
          <div class="form-group col-md-6">
            <label for="">Value :</label>
            <input
              type="number"
              class="form-control"
              name="value_extra_discount"
              [(ngModel)]="value_extra_discount"
            />
          </div>
          <div class="form-group col-md-6">
            <label for="">Reason</label>
            <input
              type="text"
              class="form-control"
              name="reason"
              [(ngModel)]="reason"
            />
          </div>
        </form>
      </div>
    </modal-content>
    <modal-footer>
      <button class="btn btn-secondary" (click)="editSellingPriceModal.close()">
        close
      </button>
    </modal-footer>
  </modal>

  <modal
    #changeSellingDateModal
    title="Change Selling Date"
    submitButtonLabel="submit"
    modalClass="modal-md"
    [hideCloseButton]="true"
    [closeOnOutsideClick]="true"
    (onOpen)="openChangeSellingDateModal(reservation_details)"
    (onClose)="closeChangeSellingDateModal()"
    (onSubmit)="
      submitChangeSellingDateModal(reservation_details, changeSellingDateModal)
    "
  >
    <modal-header> </modal-header>
    <modal-content>
      <div class="row">
        <form>
          <div class="form-group col-xs-6">
            <label for="">Selling Date</label>
            <input
              type="date"
              class="form-control"
              name="selling_date"
              [(ngModel)]="selling_date"
            />
          </div>
        </form>
      </div>
    </modal-content>
    <modal-footer>
      <button
        class="btn btn-secondary"
        (click)="changeSellingDateModal.close()"
      >
        close
      </button>
    </modal-footer>
  </modal>

  <modal
    #changeSellingPriceModal
    title="Change Selling Price"
    submitButtonLabel="submit"
    modalClass="modal-md"
    [hideCloseButton]="true"
    [closeOnOutsideClick]="true"
    (onSubmit)="
      submitChangeSellingPriceModal(
        change_unit_priceInput.value,
        unit_maintenance_priceInput.value,
        changeSellingPriceModal
      )
    "
  >
    <modal-header> </modal-header>
    <modal-content>
      <div class="row">
        <form>
          <div class="form-group col-xs-12">
            <label for="selling_price">Selling Price</label>
            <input
              type="number"
              class="form-control"
              name="selling_price"
              [ngModel]="reservation_details?.unit_price"
              #change_unit_priceInput="ngModel"
            />
          </div>
          <div class="form-group col-xs-12">
            <label for="unit_maintenance_price">Maintenance Fees</label>
            <input
              type="number"
              class="form-control"
              name="unit_maintenance_price"
              [ngModel]="reservation_details?.unit_maintenance_price"
              #unit_maintenance_priceInput="ngModel"
            />
          </div>
        </form>
      </div>
    </modal-content>
    <modal-footer>
      <button
        class="btn btn-secondary"
        (click)="changeSellingPriceModal.close()"
      >
        close
      </button>
    </modal-footer>
  </modal>

  <modal
    #commentModal
    title="Add reservation comment"
    submitButtonLabel="submit"
    modalClass="modal-lg"
    [hideCloseButton]="true"
    [closeOnOutsideClick]="true"
    (onOpen)="openCommentModal(reservation_details)"
    (onClose)="closeCommentModal()"
    (onSubmit)="submitCommentModal(reservation_details.id, commentModal)"
  >
    <modal-header> </modal-header>
    <modal-content>
      <div class="search">
        <label for="">Comment :</label>
        <textarea
          type="text"
          class="form-control"
          [(ngModel)]="commentReservation"
        ></textarea>
      </div>
    </modal-content>
    <modal-footer>
      <button class="btn btn-secondary" (click)="commentModal.close()">
        close
      </button>
    </modal-footer>
  </modal>

  <modal
    #installmentModal
    title="Installment Generator"
    submitButtonLabel="submit"
    modalClass="modal-md"
    [hideCloseButton]="true"
    [closeOnOutsideClick]="true"
    (onOpen)="openInstallmentModal(reservation_details)"
    (onClose)="closeInstallmentModal()"
    (onSubmit)="submitInstallmentModal(reservation_details, installmentModal)"
  >
    <modal-header> </modal-header>
    <modal-content>
      <form [formGroup]="installmentForm">
        <div class="row">
          <div class="col-xs-6">
            <div class="form-group">
              <label class="label-left">Payment Method Type</label>
              <!-- <select (change)="onPaymentPlanSelectionInInstallmentGenerator($event)" class="form-control"
              formControlName="type" name="type">
              <option *ngFor="let method of methods" value="{{ method.plan_name }}">{{ method.plan_name }}</option>
            </select> -->
              <input
                disabled
                type="text"
                formControlName="type"
                class="form-control"
                name="type"
              />
            </div>
            <div class="form-group">
              <label class="label-left">Down Payment As Percentage %</label>
              <input
                disabled
                type="string"
                class="form-control req"
                formControlName="percentage"
                name="percentage"
              />
            </div>
            <div class="form-group">
              <label class="label-left">Document Type</label>
              <select
                name="doc_type"
                formControlName="doc_type"
                class="form-control"
              >
                <option
                  *ngFor="let type of doc_type_installment_modal"
                  value="{{ type }}"
                >
                  {{ type }}
                </option>
              </select>
            </div>
            <div class="form-group">
              <label class="label-left">Installment Delay</label>
              <!-- <input type="date" formControlName="first_installmnet_date" class="form-control" name="first_installmnet_date"> -->
              <select formControlName="installment_delay" class="form-control">
                <option
                  value=""
                  disabled="true"
                  [selected]="!installment_delay"
                >
                  Period...
                </option>
                <option value="">Without</option>
                <option value="1">1 month</option>
                <option value="2">2 month</option>
                <option value="3">3 month</option>
                <option value="4">4 month</option>
                <option value="5">5 month</option>
                <option value="6">6 month</option>
                <option value="7">7 month</option>
                <option value="8">8 month</option>
                <option value="9">9 month</option>
                <option value="10">10 month</option>
                <option value="11">11 month</option>
                <option value="12">12 month</option>
              </select>
            </div>
          </div>
          <div class="col-xs-6">
            <div class="form-group">
              <label class="label-left">Number of parking Slots</label>
              <select class="form-control" formControlName="slots" name="slots">
                <option value="0">Without Parking Slots</option>
                <option value="1">One Parking Slots</option>
                <option value="2">Two Parking Slots</option>
              </select>
            </div>
            <!-- <div class="form-group">
            <label class="label-left">Down Payment As Cash</label>
            <input type="number" class="form-control req" [(ngModel)]="cash" formControlName="cash"
              (keyup)="cashChange(ev)" name="cash" />
          </div> -->
            <div class="form-group">
              <label for="">Installment Plan</label>
              <select
                class="form-control"
                formControlName="installment_plan"
                name="installment_plan"
              >
                <option *ngFor="let plan of payments_option" value="{{ plan }}">
                  {{ plan }}
                </option>
              </select>
            </div>
            <div class="form-group">
              <label class="label-left">Installment Start Day</label>
              <select class="form-control" formControlName="day" name="day">
                <option *ngFor="let day of installmentDays" value="{{ day }}">
                  {{ day }}
                </option>
              </select>
            </div>
          </div>
        </div>
      </form>
    </modal-content>
    <modal-footer>
      <button class="btn btn-secondary" (click)="installmentModal.close()">
        close
      </button>
    </modal-footer>
  </modal>

  <modal
    #addBankTransferModal
    title="Add Bank Transfer"
    submitButtonLabel="add"
    modalClass="modal-md"
    [hideCloseButton]="true"
    [closeOnOutsideClick]="true"
    (onOpen)="addBankTransferModalOpen(addBankTransferForm)"
    (onSubmit)="addBankTransfer(addBankTransferModal)"
  >
    <modal-header> </modal-header>
    <modal-content>
      <form #addBankTransferForm="ngForm" class="row">
        <div class="form-group col-xs-12">
          <label for="" class="transfer_by">Transfer By:</label>
          <input
            type="text"
            class="form-control"
            name="transfer_by"
            [(ngModel)]="addBankTransferFormData.transfer_by"
            required
          />
        </div>
        <div class="form-group col-xs-12">
          <label for="">Upload Transfer</label>
          <input
            type="file"
            id="bank_transfer_document"
            name="bank_transfer_document"
            #fileInput
            accept="image/*, .pdf"
            (change)="onBankTransferFileChange($event)"
            ngModel
            required
          />
        </div>
      </form>
    </modal-content>
    <modal-footer>
      <button class="btn btn-secondary" (click)="addBankTransferModal.close()">
        close
      </button>
    </modal-footer>
  </modal>

  <modal
    #viewBankTransferModal
    title="View Bank Transfers"
    submitButtonLabel="Ok"
    modalClass="modal-md"
    [hideCloseButton]="true"
    [closeOnOutsideClick]="true"
    (onOpen)="ViewBankTransferModalOpen(addBankTransferForm)"
    (onSubmit)="viewBankTransferModal.close()"
  >
    <modal-header> </modal-header>
    <modal-content>
      <form>
        <div class="row">
          <ng-container *ngFor="let file of BanksTransfersFiles">
            <div class="col-xs-8">{{ file.transfer_by }}</div>
            <div class="col-xs-4">
              <button
                class="btn btn-primary"
                (click)="downloadFile(file.full_url)"
              >
                download
              </button>
            </div>
          </ng-container>
        </div>
      </form>
    </modal-content>
    <modal-footer>
      <button class="btn btn-secondary" (click)="printReciptModal.close()">
        close
      </button>
    </modal-footer>
  </modal>

  <modal
    #accountApproveModal
    title="Accountant Approve"
    submitButtonLabel="approve"
    modalClass="modal-md"
    [hideCloseButton]="true"
    [closeOnOutsideClick]="true"
    (onOpen)="accountantApproveModalOpen(reservation_details)"
    (onClose)="accountantApproveModalClose()"
    (onSubmit)="accountApprove(reservation_details, accountApproveModal)"
  >
    <modal-header> </modal-header>
    <modal-content>
      <div class="row price-row">
        <div class="form-group col-xs-12">
          <label for="">Payment Type:</label>
          <select
            class="form-control"
            (change)="onPaymentTypeChange()"
            [(ngModel)]="payment_type"
            name="payment_type"
          >
            <option value="down_payment">Down Payment</option>
            <option value="deposit">Deposit</option>
            <option value="extra">Extra</option>
          </select>
        </div>
        <div class="form-group col-xs-12">
          <label for="" class="price-label">Total Down Payment:</label>
          <input
            type="number"
            class="form-control"
            name="price"
            [(ngModel)]="reservation_details.total_down_payment"
            [disabled]="payment_type && payment_type !== 'extra'"
          />
        </div>
        <div *ngIf="payment_type == 'deposit'" class="form-group col-xs-12">
          <label for="">Deposit Amount</label>
          <input
            type="number"
            class="form-control"
            name="deposit_amount"
            [(ngModel)]="deposit_amount"
          />
        </div>
        <div class="form-group col-xs-12">
          <label for="slip_type">Type:</label>
          <select class="form-control" [(ngModel)]="slip_type" name="slip_type">
            <option value="1">CASH</option>
            <option value="2">VISA</option>
            <option value="3">TRANSFER</option>
            <option value="4">CHEQUE</option>
          </select>
        </div>
        <div class="form-group col-xs-12 margin-top">
          <label for="">Cheque / Transaction No.:</label>
          <input
            type="text"
            class="form-control"
            name="cheque_number"
            [(ngModel)]="cheque_number"
          />
        </div>
        <ng-container *ngIf="slip_type == 4">
          <div class="form-group col-xs-12 margin-top">
            <label for="bank_id">Bank</label>
            <select class="form-control" [(ngModel)]="bank_id" name="bank_id">
              <option *ngFor="let bank of banks" [value]="bank.id">
                {{ bank.name }}
              </option>
            </select>
          </div>
          <div class="form-group col-xs-12 margin-top">
            <label for="store_status">Location</label>
            <select
              class="form-control"
              [(ngModel)]="store_status"
              name="store_status"
              required
            >
              <option *ngFor="let bank of store_banks" [value]="bank.id">
                {{ bank.name }}
              </option>
            </select>
          </div>
        </ng-container>

        <div class="form-group col-xs-12 margin-top">
          <label for="due_date">Due Date:</label>
          <input
            type="text"
            class="form-control"
            name="due_date"
            [(ngModel)]="due_date"
          />
        </div>
        <div class="form-group col-xs-12 margin-top">
          <label for="collection_date">Collection Date:</label>
          <input
            type="text"
            class="form-control"
            name="collection_date"
            [(ngModel)]="collection_date"
          />
        </div>
        <div class="form-group col-xs-12">
          <label for="slip_customer">Customer:</label>
          <select
            class="form-control"
            [(ngModel)]="slip_customer"
            name="slip_customer"
          >
            <option
              [value]="customer.lead_id"
              *ngFor="let customer of reservation_details?.sharing_leads"
            >
              {{ customer.lead_name }}
            </option>
          </select>
        </div>
        <div class="form-group col-xs-12 margin-top">
          <label for="">Slip Number:</label>
          <input
            type="text"
            class="form-control"
            name="slip_number"
            [(ngModel)]="slip_number"
          />
        </div>
      </div>
    </modal-content>
    <modal-footer>
      <button class="btn btn-secondary" (click)="accountApproveModal.close()">
        close
      </button>
    </modal-footer>
  </modal>

  <modal
    #completeDownPaymentModal
    title="Complete Down Payment"
    submitButtonLabel="complete"
    modalClass="modal-md"
    [hideCloseButton]="true"
    [closeOnOutsideClick]="true"
    (onOpen)="completeDownPaymentModalOpen(reservation_details)"
    (onClose)="completeDownPaymentModalClose()"
    (onSubmit)="
      completeDownPaymentSubmit(reservation_details, completeDownPaymentModal)
    "
  >
    <modal-header> </modal-header>
    <modal-content>
      <div class="row price-row">
        <div class="form-group col-xs-12">
          <label for="" class="price-label">Total Down Payment:</label>
          <input
            type="number"
            class="form-control"
            name="price"
            [(ngModel)]="reservation_details.total_down_payment"
            disabled
          />
        </div>
        <div class="form-group col-xs-12">
          <label for="" class="price-label">Recieved Amount:</label>
          <input
            type="number"
            class="form-control"
            name="price"
            [(ngModel)]="reservation_details.amount_received"
            disabled
          />
        </div>
        <div class="form-group col-xs-12">
          <label for="" class="price-label">Remaining Amount:</label>
          <input
            type="number"
            class="form-control"
            name="price"
            [(ngModel)]="reservation_details.remaining_down_payment"
            disabled
          />
        </div>
        <div class="form-group col-xs-12">
          <label for="" class="price-label">Amount:</label>
          <input
            type="number"
            class="form-control"
            name="price"
            [(ngModel)]="complete_down_payment_amount"
          />
        </div>
        <div class="form-group col-xs-12">
          <label for="slip_type">Type:</label>
          <select class="form-control" [(ngModel)]="slip_type" name="slip_type">
            <option value="1">CASH</option>
            <option value="2">VISA</option>
            <option value="3">TRANSFER</option>
            <option value="4">CHEQUE</option>
          </select>
        </div>
        <div class="form-group col-xs-12 margin-top" *ngIf="slip_type == 4">
          <label for="">Cheque Number:</label>
          <input
            type="text"
            class="form-control"
            name="cheque_number"
            [(ngModel)]="cheque_number"
          />
        </div>
        <div class="form-group col-xs-12">
          <label for="slip_customer">Customer:</label>
          <select
            class="form-control"
            [(ngModel)]="slip_customer"
            name="slip_customer"
          >
            <option
              *ngFor="let customer of reservation_details?.sharing_leads"
              [value]="customer.lead_id"
            >
              {{ customer.lead_name }}
            </option>
          </select>
        </div>
        <div class="form-group col-xs-12 margin-top">
          <label for="">Slip Number:</label>
          <input
            type="text"
            class="form-control"
            name="slip_number"
            [(ngModel)]="slip_number"
          />
        </div>
      </div>
    </modal-content>
    <modal-footer>
      <button
        class="btn btn-secondary"
        (click)="completeDownPaymentModal.close()"
      >
        close
      </button>
    </modal-footer>
  </modal>

  <modal
    #firstModal
    title="Upload Files"
    submitButtonLabel="submit"
    modalClass="modal-lg"
    [hideCloseButton]="true"
    [closeOnOutsideClick]="true"
    (onOpen)="actionOnOpen(reservation_details?.id)"
    (onClose)="actionOnClose()"
    (onSubmit)="actionOnSubmit(reservation_details?.id, firstModal)"
  >
    <modal-header> </modal-header>
    <modal-content>
      <form [formGroup]="filesForm">
        <div class="form-group flex-column">
          <label for="">Receipt File</label>
          <input
            type="file"
            id="receipt"
            (change)="handleReceiptFile($event)"
          />
        </div>
        <div class="form-group flex-column">
          <label for="">Signed File</label>
          <input type="file" id="signed" (change)="handleSignedFile($event)" />
        </div>
        <div class="form-group flex-column">
          <label for="">Date</label>
          <input
            class="form-control"
            type="date"
            id="date"
            formControlName="date"
          />
        </div>
      </form>
    </modal-content>
    <modal-footer>
      <button class="btn btn-secondary" (click)="firstModal.close()">
        close
      </button>
    </modal-footer>
  </modal>

  <modal
    #contractSignedByClientModal
    title="Contract Signed By Client"
    submitButtonLabel="submit"
    modalClass="modal-lg"
    [hideCloseButton]="true"
    [closeOnOutsideClick]="true"
    (onSubmit)="contractSignedByClientModalSubmit(contractSignedByClientModal)"
  >
    <modal-header> </modal-header>
    <modal-content>
      <div class="form-group flex-column">
        <label for="">Date</label>
        <input
          class="form-control"
          type="date"
          id="date"
          [(ngModel)]="contract_signed_by_client_date"
        />
      </div>
    </modal-content>
    <modal-footer>
      <button
        class="btn btn-secondary"
        (click)="contractSignedByClientModal.close()"
      >
        close
      </button>
    </modal-footer>
  </modal>

  <modal
    #contractApproveModal
    title="Contract Sign by CEO Modal"
    submitButtonLabel="submit"
    modalClass="modal-lg"
    [hideCloseButton]="true"
    [closeOnOutsideClick]="true"
    (onSubmit)="contractApproveModalSubmit(contractApproveModal)"
  >
    <modal-header> </modal-header>
    <modal-content>
      <div class="form-group flex-column">
        <label for="">Date</label>
        <input
          class="form-control"
          type="date"
          id="date"
          [(ngModel)]="contract_approve_date"
        />
      </div>
    </modal-content>
    <modal-footer>
      <button class="btn btn-secondary" (click)="contractApproveModal.close()">
        close
      </button>
    </modal-footer>
  </modal>

  <modal
    #contractDileveredModal
    title="Contract Delivered Modal"
    submitButtonLabel="submit"
    modalClass="modal-lg"
    [hideCloseButton]="true"
    [closeOnOutsideClick]="true"
    (onSubmit)="contractDileveredModalSubmit(contractDileveredModal)"
  >
    <modal-header> </modal-header>
    <modal-content>
      <div class="form-group flex-column">
        <label for="">Date</label>
        <input
          class="form-control"
          type="date"
          id="date"
          [(ngModel)]="contract_dilever_date"
        />
      </div>
    </modal-content>
    <modal-footer>
      <button
        class="btn btn-secondary"
        (click)="contractDileveredModal.close()"
      >
        close
      </button>
    </modal-footer>
  </modal>

  <modal
    #changeSignatureModal
    title="Change Signature Date"
    submitButtonLabel="submit"
    modalClass="modal-md"
    [hideCloseButton]="true"
    [closeOnOutsideClick]="true"
    (onOpen)="openChangeSignatureModal(reservation_details)"
    (onClose)="closeChangeSignatureModal()"
    (onSubmit)="
      submitChangeSignatureModal(reservation_details, changeSignatureModal)
    "
  >
    <modal-header> </modal-header>
    <modal-content>
      <div class="row">
        <form>
          <div class="form-group col-xs-6">
            <label for="">Signature Date</label>
            <input
              type="date"
              class="form-control"
              name="signatureDate"
              [(ngModel)]="signature_date"
            />
          </div>
        </form>
      </div>
    </modal-content>
    <modal-footer>
      <button class="btn btn-secondary" (click)="changeSignatureModal.close()">
        close
      </button>
    </modal-footer>
  </modal>

  <modal
    #reAssignClientModal
    title="Re-assign Client"
    submitButtonLabel="approve"
    modalClass="modal-md"
    [hideCloseButton]="true"
    [closeOnOutsideClick]="true"
    (onOpen)="reAssignClientModalOpen(reservation_details)"
    (onClose)="reAssignClientModalClose()"
    (onSubmit)="reAssignClientSubmit(reservation_details, reAssignClientModal)"
  >
    <modal-header> </modal-header>
    <modal-content>
      <div class="row">
        <div class="col-xs-12">
          <div class="col-xs-8">
            <div class="form-group">
              <label>Search leads :</label>
              <div class="search-btn-container">
                <div>
                  <input
                    ngui-auto-complete
                    [source]="observableSource.bind(this)"
                    placeholder="Search for lead by name "
                    class="form-control"
                    name="chosen_lead"
                    [(ngModel)]="chosenLead"
                  />
                </div>
                <button
                  class="btn btn-default pull-right btn-black"
                  type="button"
                  [disabled]="!chosenLead"
                  (click)="getLeadDetails()"
                >
                  GET INFO
                </button>
              </div>
            </div>
          </div>
        </div>
        <div class="col-xs-12">
          <div class="col-xs-6 form-group">
            <label for="">Client name (ar) :</label>
            <input
              type="text"
              class="form-control"
              [(ngModel)]="chosenLeadName"
            />
          </div>
          <div class="col-xs-6 form-group">
            <label for="">Client phone</label>
            <input
              type="text"
              class="form-control"
              [(ngModel)]="chosenLeadPhone"
            />
          </div>
          <div class="col-xs-6 form-group">
            <label for="">Client Address</label>
            <input
              type="text"
              class="form-control"
              [(ngModel)]="chosenLeadAddress"
            />
          </div>
          <div class="col-xs-6 form-group">
            <label for="">Client Birthday</label>
            <input
              type="date"
              class="form-control"
              [(ngModel)]="chosenLeadBirthday"
            />
          </div>
          <div class="col-xs-6 form-group">
            <label for="">Civil Registery</label>
            <input
              type="text"
              class="form-control"
              [(ngModel)]="chosenLeadCivilRegistery"
            />
          </div>
          <div class="col-xs-6 form-group">
            <label for="">Client Issue Date</label>
            <input
              type="date"
              class="form-control"
              [(ngModel)]="chosenLeadIssueDate"
            />
          </div>
          <div class="col-xs-6 form-group">
            <label for="">Lead District</label>
            <input
              type="text"
              class="form-control"
              [(ngModel)]="chosenLeadDistrict"
            />
          </div>
          <div class="col-xs-6 form-group">
            <label for="">Lead Nationality</label>
            <input
              type="text"
              class="form-control"
              [(ngModel)]="chosenLeadNationality"
            />
          </div>
          <div class="col-xs-6 form-group">
            <label for="">Lead Nationality ID</label>
            <input
              type="text"
              class="form-control"
              [(ngModel)]="chosenLeadNationalityID"
            />
          </div>
          <div class="col-xs-12 form-group">
            <label for="">Reason:</label>
            <textarea
              type="text"
              class="form-control"
              [(ngModel)]="chosenLeadReason"
            ></textarea>
          </div>
        </div>
      </div>
    </modal-content>
    <modal-footer>
      <button class="btn btn-secondary" (click)="reAssignClientModal.close()">
        close
      </button>
    </modal-footer>
  </modal>

  <modal
    #refundAdminDeclineModal
    title="Admin Decline"
    submitButtonLabel="decline"
    modalClass="modal-md"
    [hideCloseButton]="true"
    [closeOnOutsideClick]="true"
    (onSubmit)="refundAdminDeclineModalSubmit(refundAdminDeclineModal)"
  >
    <modal-header> </modal-header>
    <modal-content>
      <form>
        <div class="row">
          <div class="col-xs-6">
            <div class="form-group">
              <label for="">Refund Reason</label>
              <select name="refundReason" [(ngModel)]="refundReason">
                <option *ngFor="let reason of refundReasons" [value]="reason">
                  {{ reason }}
                </option>
              </select>
            </div>
          </div>
        </div>
      </form>
    </modal-content>
    <modal-footer>
      <button
        class="btn btn-secondary"
        (click)="refundAdminDeclineModal.close()"
      >
        close
      </button>
    </modal-footer>
  </modal>

  <modal
    #commissionModal
    title="Commissions"
    submitButtonLabel="Submit"
    modalClass="modal-md"
    [hideCloseButton]="true"
    [closeOnOutsideClick]="true"
    (onSubmit)="commissionModalSubmit(commissionModal)"
  >
    <modal-header> </modal-header>
    <modal-content>
      <form>
        <div class="row">
          <div class="col-xs-6">
            <div class="form-group">
              <label for="">Date : </label>
              <input
                type="date"
                class="form-control"
                name="commission_date"
                [(ngModel)]="commission_date"
              />
            </div>
          </div>
          <div class="col-xs-6">
            <div class="form-group">
              <label for="">Commission To : </label>
              <select
                name="commission_to"
                class="form-control"
                [(ngModel)]="commission_to"
                id="commission_to"
              >
                <option value="property_consultant">Property Consultant</option>
                <option value="ambassador">Ambassador</option>
                <option value="broker">Broker</option>
              </select>
            </div>
          </div>
        </div>
      </form>
    </modal-content>
    <modal-footer>
      <button class="btn btn-secondary" (click)="commissionModal.close()">
        close
      </button>
    </modal-footer>
  </modal>

  <modal
    #claimModal
    title="claim"
    submitButtonLabel="Submit"
    modalClass="modal-md"
    [hideCloseButton]="true"
    [closeOnOutsideClick]="true"
    (onSubmit)="claimModalSubmit(claimModal)"
  >
    <modal-header> </modal-header>
    <modal-content>
      <form>
        <div class="row">
          <div class="col-xs-6">
            <div class="form-group">
              <label for="claim_date">Date : </label>
              <input
                type="date"
                class="form-control"
                name="claim_date"
                [(ngModel)]="claim_form.claim_date"
              />
            </div>
          </div>
          <div class="col-xs-6">
            <div class="form-group">
              <label for="claim_from">claim From : </label>
              <select
                name="claim_from"
                class="form-control"
                [(ngModel)]="claim_form.claim_from"
                id="claim_from"
              >
                <option value="ambassador">Ambassador</option>
                <option value="broker">Broker</option>
              </select>
            </div>
          </div>
        </div>
      </form>
    </modal-content>
    <modal-footer>
      <button class="btn btn-secondary" (click)="claimModal.close()">
        close
      </button>
    </modal-footer>
  </modal>

  <modal
    #printChequeModal
    title="Print Cheques"
    submitButtonLabel="Submit"
    modalClass="modal-md"
    [hideCloseButton]="true"
    [closeOnOutsideClick]="true"
    (onSubmit)="printChequeModalSubmit(printChequeModal)"
  >
    <modal-header> </modal-header>
    <modal-content>
      <form>
        <div class="row">
          <div class="col-xs-12">
            <div class="form-group">
              <label for="">Bank Name : </label>
              <select
                name="bank_id"
                class="form-control"
                [(ngModel)]="bank_id"
                id="bank_id"
              >
                <option *ngFor="let bank of banks" [value]="bank.id">
                  {{ bank?.name }}
                </option>
              </select>
            </div>
          </div>
        </div>
      </form>
    </modal-content>
    <modal-footer>
      <button class="btn btn-secondary" (click)="printChequeModal.close()">
        close
      </button>
    </modal-footer>
  </modal>

  <modal
    #printReciptModal
    title="Print Recipt"
    submitButtonLabel="Submit"
    modalClass="modal-md"
    [hideCloseButton]="true"
    [closeOnOutsideClick]="true"
    (onSubmit)="printReciptModal.close()"
  >
    <modal-header> </modal-header>
    <modal-content>
      <form>
        <div class="row">
          <ng-container *ngFor="let receipt of reservation_details.receipts">
            <div class="col-xs-8">{{ receipt.slip_number }}</div>
            <div class="col-xs-4">
              <button
                class="btn btn-primary"
                (click)="printReciptModalSubmit(receipt.id)"
              >
                Print
              </button>
            </div>
          </ng-container>
        </div>
      </form>
    </modal-content>
    <modal-footer>
      <button class="btn btn-secondary" (click)="printReciptModal.close()">
        close
      </button>
    </modal-footer>
  </modal>

  <modal
    #printReciptChequeModal
    title="Print Recipt"
    modalClass="modal-md"
    [hideCloseButton]="true"
    [closeOnOutsideClick]="true"
  >
    <modal-header> </modal-header>
    <modal-content>
      <div class="w-100 table-responsive">
        <table class="table table-bordered">
          <tr>
            <th>Slib Number</th>
            <th>Date</th>
            <th>Action</th>
          </tr>
          <ng-container *ngFor="let receipt of current_active_cheque?.receipts">
            <ng-container *ngIf="receipt.payment_collection_id">
              <tr>
                <td>{{ receipt.slip_number }}</td>
                <td>{{ receipt.created_at }}</td>
                <td>
                  <button
                    class="btn btn-primary"
                    (click)="printReciptModalSubmit(receipt.id)"
                  >
                    Print
                  </button>
                </td>
              </tr>
            </ng-container>
          </ng-container>
        </table>
      </div>
    </modal-content>
    <modal-footer>
      <button
        class="btn btn-secondary"
        (click)="printReciptChequeModal.close()"
      >
        close
      </button>
    </modal-footer>
  </modal>

  <modal
    #changeEventModal
    title="Change Event"
    submitButtonLabel="submit"
    modalClass="modal-md"
    [hideCloseButton]="true"
    [closeOnOutsideClick]="true"
    (onSubmit)="
      form.valid &&
        changeEventModalSubmit(changeEventModal, new_event_input.value)
    "
  >
    <modal-header> </modal-header>
    <modal-content>
      <form #form="ngForm">
        <div class="row search">
          <div class="col-xs-6 form-group">
            <label for="">Event</label>
            <select
              name="new_evnet"
              [ngModel]="reservation_details?.event?.id"
              required
              class="form-control"
              #new_event_input="ngModel"
            >
              <option *ngFor="let event of events" [value]="event.id">
                {{ event.name }}
              </option>
            </select>
          </div>
        </div>
      </form>
    </modal-content>
    <modal-footer>
      <button class="btn btn-secondary" (click)="changeEventModal.close()">
        close
      </button>
    </modal-footer>
  </modal>

  <modal
    #divisionModal
    title="Change Division"
    submitButtonLabel="submit"
    modalClass="modal-md"
    [hideCloseButton]="true"
    [closeOnOutsideClick]="true"
    (onOpen)="divisionModalOpen()"
    (onClose)="divisionModalClose()"
    (onSubmit)="divisionModalSubmit(divisionModal)"
  >
    <modal-header> </modal-header>
    <modal-content>
      <form action="">
        <div class="row search">
          <div class="col-xs-6 form-group">
            <label for="">Division</label>
            <select
              name="deal_type"
              [(ngModel)]="divisionForm.deal_type"
              class="form-control"
              (change)="channelChange($event)"
            >
              <option *ngFor="let channel of channels" [value]="channel.name">
                {{ channel.name }}
              </option>
            </select>
          </div>
          <div
            class="col-xs-6 form-group"
            *ngIf="divisionForm.deal_type == 'Direct'"
          >
            <label for="">Division Type</label>
            <select
              name="deal_category"
              [(ngModel)]="divisionForm.deal_category"
              class="form-control"
            >
              <option value="" disabled="true" [selected]="!deal_category">
                Type...
              </option>
              <option
                *ngFor="let division of leadSources"
                [value]="division.name"
              >
                {{ division.name }}
              </option>
            </select>
          </div>
          <div
            class="col-xs-6 form-group"
            *ngIf="divisionForm.deal_type == 'In-Direct'"
          >
            <label for="">Source</label>
            <select
              name="deal_source"
              [(ngModel)]="divisionForm.deal_source"
              class="form-control"
            >
              <option
                *ngFor="let leadSource of leadSources; let i = index"
                value="{{ leadSource.name }}"
              >
                {{ leadSource.name }}
              </option>
            </select>
          </div>

          <div
            class="col-xs-6 form-group"
            *ngIf="divisionForm.deal_category == 'Ambassador'"
          >
            <label for="">Ambassador :</label>
            <ng-select
              [items]="ambassadors"
              [virtualScroll]="true"
              [searchable]="true"
              bindLabel="name"
              bindValue="id"
              placeholder="Select Ambassador"
              [(ngModel)]="divisionForm.ambassador_id"
              name="ambassador_id"
              [clearSearchOnAdd]="true"
            >
              <ng-template ng-option-tmp let-item="item">
                <span>{{ item.name }}</span>
              </ng-template>
            </ng-select>
          </div>

          <div
            class="col-xs-6 form-group"
            *ngIf="
              divisionForm.deal_type == 'In-Direct' &&
              (divisionForm.deal_source == 'Broker' ||
                divisionForm.deal_source == 'Broker ARM')
            "
          >
            <label for="">Broker :</label>
            <ng-select
              [items]="brokers"
              [virtualScroll]="true"
              [searchable]="true"
              bindLabel="name"
              bindValue="id"
              placeholder="Select Broker"
              [(ngModel)]="divisionForm.broker_id"
              name="broker_id"
              [clearSearchOnAdd]="true"
            >
              <ng-template ng-option-tmp let-item="item">
                <span>{{ item.name }}</span>
              </ng-template>
            </ng-select>
          </div>
        </div>
      </form>
    </modal-content>
    <modal-footer>
      <button class="btn btn-secondary" (click)="divisionModal.close()">
        close
      </button>
    </modal-footer>
  </modal>

  <modal
    #garageSlots
    title="Change Number of Garage Slots"
    submitButtonLabel="submit"
    modalClass="modal-md"
    [hideCloseButton]="true"
    [closeOnOutsideClick]="true"
    (onOpen)="garageSlotsModalOpen()"
    (onClose)="garageSlotsModalClose()"
    (onSubmit)="garageSlotsSubmit(garageSlots)"
  >
    <modal-header> </modal-header>
    <modal-content>
      <div class="form-group">
        <label for="">Number of Garage Slots</label>
        <input
          type="number"
          class="form-control"
          name="slots"
          [(ngModel)]="slots"
        />
      </div>
    </modal-content>
    <modal-footer>
      <button class="btn btn-secondary" (click)="garageSlots.close()">
        close
      </button>
    </modal-footer>
  </modal>

  <modal
    #garageExtraSlots
    title="Change Number of Garage Slots"
    submitButtonLabel="submit"
    modalClass="modal-md"
    [hideCloseButton]="true"
    [closeOnOutsideClick]="true"
    (onSubmit)="garageExtraSlotsSubmit(garageExtraSlots)"
  >
    <modal-header> </modal-header>
    <modal-content>
      <div class="form-group">
        <label for="">Number of Extra Garage Slots</label>
        <input
          type="number"
          class="form-control"
          name="slots"
          [(ngModel)]="extra_slots"
        />
      </div>
    </modal-content>
    <modal-footer>
      <button class="btn btn-secondary" (click)="garageSlots.close()">
        close
      </button>
    </modal-footer>
  </modal>

  <modal
    #storageSlots
    title="Change Number of Storage Slots"
    submitButtonLabel="submit"
    modalClass="modal-md"
    [hideCloseButton]="true"
    [closeOnOutsideClick]="true"
    (onOpen)="storageSlotsModalOpen()"
    (onClose)="storageSlotsModalClose()"
    (onSubmit)="storageSlotsSubmit(storageSlots)"
  >
    <modal-header> </modal-header>
    <modal-content>
      <div class="form-group">
        <label for="">Number of Garage Slots</label>
        <input
          type="number"
          class="form-control"
          name="storage_slots"
          [(ngModel)]="storage_slots"
        />
      </div>
    </modal-content>
    <modal-footer>
      <button class="btn btn-secondary" (click)="storageSlots.close()">
        close
      </button>
    </modal-footer>
  </modal>

  <modal
    #addContractLogModal
    title="Add Contract Log"
    submitButtonLabel="submit"
    modalClass="modal-md"
    [hideCloseButton]="true"
    [closeOnOutsideClick]="true"
    (onSubmit)="
      addContractLogModalSubmit(addContractLogModal, contLogForm.valid)
    "
  >
    <modal-header> </modal-header>
    <modal-content>
      <form #contLogForm="ngForm"></form>
      <div class="form-group">
        <label for="">Agent</label>
        <ng-select
          name="log_agent"
          [(ngModel)]="addContractLog.agent_id"
          required
          placeholder="Select Agent"
        >
          <ng-option *ngFor="let agent of agents" [value]="agent.id">{{
            agent.name
          }}</ng-option>
        </ng-select>
      </div>
      <div class="form-group">
        <label for="">Delivered At</label>
        <input
          type="date"
          class="form-control"
          name="log_delivered_at"
          [(ngModel)]="addContractLog.delivered_at"
          required
        />
      </div>
      <div class="form-group">
        <label for="">Status</label>
        <input
          type="text"
          class="form-control"
          name="log_status"
          [(ngModel)]="addContractLog.status"
          required
        />
      </div>
      <div class="form-group">
        <label for="">Details</label>
        <textarea
          class="form-control"
          name="log_status"
          [(ngModel)]="addContractLog.details"
        >
        </textarea>
      </div>
    </modal-content>
    <modal-footer>
      <button class="btn btn-secondary" (click)="garageSlots.close()">
        close
      </button>
    </modal-footer>
  </modal>

  <modal
    #paymentTypeModal
    title="Change Payment Type"
    submitButtonLabel="submit"
    modalClass="modal-md"
    [hideCloseButton]="true"
    [closeOnOutsideClick]="true"
    (onOpen)="paymentTypeModalOpen()"
    (onClose)="paymentTypeModalClose()"
    (onSubmit)="paymentTypeSubmit(paymentTypeModal)"
  >
    <modal-header> </modal-header>
    <modal-content>
      <div class="form-group">
        <label for="">Payment Type</label>
        <select class="form-control" [(ngModel)]="last_payment_type">
          <option value="Installment">Installment</option>
          <option value="Cash">Cash</option>
        </select>
      </div>
    </modal-content>
    <modal-footer>
      <button class="btn btn-secondary" (click)="paymentTypeModal.close()">
        close
      </button>
    </modal-footer>
  </modal>

  <modal
    #paymentTermModal
    title="Change Payment Term"
    submitButtonLabel="submit"
    modalClass="modal-md"
    [hideCloseButton]="true"
    [formGroup]="paymentForm"
    [closeOnOutsideClick]="true"
    (onOpen)="paymentTermModalOpen()"
    (onClose)="paymentTermModalClose()"
    (onSubmit)="paymentTermSubmit(paymentTermModal)"
  >
    <modal-header> </modal-header>
    <modal-content>
      <div class="form-group">
        <label for="">Payment Method Type :</label>
        <select
          class="form-control"
          (change)="changePaymentMethod($event)"
          [(ngModel)]="payment_term_id"
          formControlName="payment_term_id"
          name="payment_term_id"
        >
          <option value="" disabled="true" [selected]="!payment_term_id">
            Year...
          </option>
          <option *ngFor="let method of methods" value="{{ method.id }}">
            {{ method.plan_name }}
          </option>
        </select>
      </div>
      <div class="form-group">
        <label>Down Payment Percentage %</label>
        <input
          type="number"
          class="form-control req"
          [(ngModel)]="percentage"
          formControlName="percentage"
          name="percentage"
          readonly
        />
      </div>
    </modal-content>
    <modal-footer>
      <button class="btn btn-secondary" (click)="paymentTermModal.close()">
        close
      </button>
    </modal-footer>
  </modal>

  <modal
    #overseasModal
    title="Change Overseas"
    submitButtonLabel="submit"
    modalClass="modal-md"
    [hideCloseButton]="true"
    [closeOnOutsideClick]="true"
    (onOpen)="overseasModalModalOpen()"
    (onClose)="overseasModalModalClose()"
    (onSubmit)="overseasModalSubmit(overseasModal)"
  >
    <modal-header> </modal-header>
    <modal-content>
      <div class="form-group">
        <label for="">Overseas</label>
        <select class="form-control" [(ngModel)]="is_overseas">
          <option value="0">No</option>
          <option value="1">Yes</option>
        </select>
      </div>
    </modal-content>
    <modal-footer>
      <button class="btn btn-secondary" (click)="overseasModal.close()">
        close
      </button>
    </modal-footer>
  </modal>

  <modal
    #editLead
    title="Edit Lead Info"
    submitButtonLabel="save"
    modalClass="modal-md"
    [hideCloseButton]="true"
    [closeOnOutsideClick]="true"
    (onOpen)="editLeadModalModalOpen()"
    (onClose)="editLeadModalModalClose()"
    (onSubmit)="editLeadModalSubmit(editLead)"
  >
    <modal-header> </modal-header>
    <modal-content>
      <div class="row">
        <div class="col-md-6">
          <label for="">Lead Name</label>
          <input
            type="text"
            name="lead_name"
            [(ngModel)]="edit_lead_data.lead_name"
            class="form-control"
          />
        </div>
        <div class="col-md-6">
          <label for="">Lead District</label>
          <input
            type="text"
            name="lead_district"
            [(ngModel)]="edit_lead_data.lead_district"
            class="form-control"
          />
        </div>
      </div>
      <div class="row">
        <div class="col-md-6">
          <div class="form-group">
            <label for="">Lead Nationality</label>
            <input
              type="text"
              name="lead_nationality"
              [(ngModel)]="edit_lead_data.lead_nationality"
              class="form-control"
            />
          </div>
        </div>
        <div class="col-md-6">
          <label for="">Lead National ID</label>
          <input
            type="text"
            name="lead_national_id"
            [(ngModel)]="edit_lead_data.lead_national_id"
            class="form-control"
          />
        </div>
      </div>
      <div class="row">
        <div class="col-md-6">
          <label for="">Lead Address</label>
          <input
            type="text"
            name="lead_address"
            [(ngModel)]="edit_lead_data.lead_address"
            class="form-control"
          />
        </div>
        <div class="col-md-6">
          <label for="">Lead Birthday</label>
          <input
            type="date"
            name="lead_birthday"
            [(ngModel)]="edit_lead_data.lead_birthday"
            class="form-control"
          />
        </div>
      </div>
    </modal-content>
    <modal-footer>
      <button class="btn btn-secondary" (click)="editLead.close()">
        close
      </button>
    </modal-footer>
  </modal>

  <modal
    #changeConfirmationDateModal
    title="Change Confirmation Date"
    submitButtonLabel="submit"
    modalClass="modal-md"
    [hideCloseButton]="true"
    [closeOnOutsideClick]="true"
    (onOpen)="openChangeConfirmationDateModal(reservation_details)"
    (onClose)="closeChangeConfirmationDateModal()"
    (onSubmit)="
      submitConfirmationDateModal(
        reservation_details,
        changeConfirmationDateModal
      )
    "
  >
    <modal-header> </modal-header>
    <modal-content>
      <div class="row">
        <form>
          <div class="form-group col-xs-6">
            <label for="">Confirmation Date</label>
            <input
              type="date"
              class="form-control"
              name="confirmation_date"
              [(ngModel)]="confirmation_date"
            />
          </div>
        </form>
      </div>
    </modal-content>
    <modal-footer>
      <button
        class="btn btn-secondary"
        (click)="changeConfirmationDateModal.close()"
      >
        close
      </button>
    </modal-footer>
  </modal>

  <modal
    #contractTypeModal
    title="Change Contract Type"
    submitButtonLabel="submit"
    modalClass="modal-md"
    [hideCloseButton]="true"
    [closeOnOutsideClick]="true"
    (onOpen)="contractTypeModalOpen()"
    (onClose)="contractTypeModalClose()"
    (onSubmit)="contractTypeModalSubmit(contractTypeModal)"
  >
    <modal-header> </modal-header>
    <modal-content>
      <form [formGroup]="contractForm" *ngIf="contractForm">
        <div class="form-group">
          <label for="">Contract Type</label>
          <select
            class="form-control"
            name="contract_type"
            id="contract_type"
            formControlName="contract_type"
          >
            <option value="sale">Sale</option>
            <option value="rent">Rent</option>
          </select>
        </div>
        <div *ngIf="contractTypeFromContractForm == 'rent'">
          <div class="form-group">
            <label for="">Rent Value :</label>
            <input
              type="number"
              id="rent_value"
              placeholder=""
              formControlName="rent_value"
              class="form-control"
            />
          </div>
          <div class="form-group">
            <label for="">Rent Start Date :</label>
            <input
              type="date"
              id="rent_start_date"
              placeholder=""
              formControlName="rent_start_date"
              class="form-control"
            />
          </div>
          <div class="form-group">
            <label for="">Rent End Date :</label>
            <input
              type="date"
              id="rent_end_date"
              placeholder=""
              formControlName="rent_end_date"
              class="form-control"
            />
          </div>
          <div class="form-group">
            <label for="">Number of Rent Years :</label>
            <input
              type="number"
              id="rent_years_num"
              placeholder=""
              formControlName="rent_years_num"
              class="form-control"
            />
          </div>
        </div>
        <div *ngIf="contractTypeFromContractForm == 'sale'">
          <div class="form-group">
            <label for="">Payment Type :</label>
            <select class="form-control" formControlName="payment_type">
              <option value="" disabled="true" [selected]="!payment_type">
                Type...
              </option>
              <option value="Installment">Installment</option>
              <option value="Cash">Cash</option>
            </select>
          </div>
          <div class="form-group">
            <label for="">Overseas :</label>
            <select class="form-control" formControlName="is_overseas">
              <option value="0">No</option>
              <option value="1">Yes</option>
            </select>
          </div>
          <div class="form-group">
            <label for="">Payment Plan :</label>
            <select class="form-control" formControlName="installment_years">
              <option value="" disabled="true" [selected]="!installment_years">
                Year...
              </option>
              <option
                *ngFor="let method of payment_plans"
                value="{{ method.plan_name }}"
              >
                {{ method.plan_name }}
              </option>
            </select>
          </div>
          <!-- <div class="form-group">
            <label for="">Installment Fees :</label>
            <input
              type="text"
              id="installment_fees"
              placeholder=""
              formControlName="installment_fees"
              class="form-control"
            />
          </div> -->
        </div>
      </form>
    </modal-content>
    <modal-footer>
      <button class="btn btn-secondary" (click)="contractTypeModal.close()">
        close
      </button>
    </modal-footer>
  </modal>

  <modal
    #overSeaContractSentModal
    title="Oversea contract send date"
    submitButtonLabel="submit"
    modalClass="modal-md"
    [hideCloseButton]="true"
    [closeOnOutsideClick]="true"
    (onOpen)="overSeaContractSentModalOpen()"
    (onClose)="overSeaContractSentModalClose()"
    (onSubmit)="overSeaContractSentModalubmit(overSeaContractSentModal)"
  >
    <modal-header> </modal-header>
    <modal-content>
      <div class="form-group">
        <label for="">Send Date</label>
        <input
          type="date"
          placeholder="Send Date"
          class="form-control"
          [(ngModel)]="oversea_contract_sent_date"
        />
      </div>
    </modal-content>
    <modal-footer>
      <button
        class="btn btn-secondary"
        (click)="overSeaContractSentModal.close()"
      >
        close
      </button>
    </modal-footer>
  </modal>

  <modal
    #actionChequeRecievedModal
    title="Cheuqe Received"
    submitButtonLabel="submit"
    modalClass="modal-md"
    [hideCloseButton]="true"
    [closeOnOutsideClick]="true"
    (onSubmit)="cheque_recieved_submit(actionChequeRecievedModal)"
  >
    <modal-header> </modal-header>
    <modal-content>
      <div class="row">
        <form>
          <div class="form-group col-xs-6">
            <label for="">Date</label>
            <input
              type="date"
              class="form-control"
              name="cheque_recieved_date"
              [(ngModel)]="cheque_recieved_date"
            />
          </div>
        </form>
      </div>
    </modal-content>
    <modal-footer>
      <button
        class="btn btn-secondary"
        (click)="actionChequeRecievedModal.close()"
      >
        close
      </button>
    </modal-footer>
  </modal>
  <modal
    #addCustomer
    title="Add Customer"
    submitButtonLabel="save"
    modalClass="modal-md"
    [hideCloseButton]="true"
    [closeOnOutsideClick]="true"
    (onOpen)="addCustomerModalOpen(reservation_details)"
    (onClose)="addCustomerModalClose(addCustomer)"
    (onSubmit)="addCustomerModalSubmit(reservation_details, addCustomer)"
  >
    <modal-header> </modal-header>
    <modal-content>
      <div class="row">
        <div class="col-md-12">
          <div class="form-group">
            <label>Search leads :</label>
            <div class="search-btn-container">
              <div style="margin-bottom: 10px">
                <input
                  ngui-auto-complete
                  [source]="customerSource.bind(this)"
                  placeholder="Search for lead by name "
                  class="form-control"
                  name="chosenCustomer"
                  [(ngModel)]="chosenCustomer"
                />
              </div>
              <button
                class="btn btn-default pull-right btn-black"
                type="button"
                [disabled]="!chosenCustomer"
                (click)="getCustomerDetails()"
              >
                Get info
              </button>
            </div>
          </div>
        </div>
      </div>

      <div class="row">
        <div class="col-md-6">
          <div class="form-group">
            <label for="">Customer Name</label>
            <input
              type="text"
              name="lead_name"
              [(ngModel)]="addCustomerForm.lead_name"
              class="form-control"
            />
          </div>
        </div>
        <div class="col-md-6">
          <div class="form-group">
            <label for="">Customer Phone</label>
            <input
              type="number"
              name="lead_phone"
              [(ngModel)]="addCustomerForm.lead_phone"
              class="form-control"
            />
          </div>
        </div>
      </div>

      <div class="row">
        <div class="col-md-6">
          <div class="form-group">
            <label for="">Customer Email</label>
            <input
              type="email"
              name="lead_email"
              [(ngModel)]="addCustomerForm.lead_email"
              class="form-control"
            />
          </div>
        </div>
        <div class="col-md-6">
          <div class="form-group">
            <label for="">Customer National ID</label>
            <input
              type="text"
              name="lead_national_id"
              [(ngModel)]="addCustomerForm.lead_national_id"
              class="form-control"
            />
          </div>
        </div>
      </div>

      <div class="row">
        <div class="col-md-6">
          <div class="form-group">
            <label for="">Customer Nationality</label>
            <input
              type="text"
              name="lead_nationality"
              [(ngModel)]="addCustomerForm.lead_nationality"
              class="form-control"
            />
          </div>
        </div>
        <div class="col-md-6">
          <div class="form-group">
            <label for="">Customer Religion</label>
            <ng-select
              name="religion"
              placeholder="Select Religion"
              [(ngModel)]="addCustomerForm.lead_religion"
            >
              <ng-option value="Muslim">Muslim</ng-option>
              <ng-option value="Christian">Christian</ng-option>
            </ng-select>
          </div>
        </div>
      </div>

      <div class="row">
        <div class="col-md-6">
          <div class="form-group">
            <label for="">Customer Other Phone</label>
            <input
              type="number"
              name="lead_other_phone"
              [(ngModel)]="addCustomerForm.lead_other_phone"
              class="form-control"
            />
          </div>
        </div>
        <div class="col-md-6">
          <div class="form-group">
            <label for="">Customer Address</label>
            <input
              type="text"
              name="lead_address"
              [(ngModel)]="addCustomerForm.lead_address"
              class="form-control"
            />
          </div>
        </div>
      </div>

      <div class="row">
        <div class="col-md-6">
          <div class="form-group">
            <label for="">Customer District</label>
            <input
              type="text"
              name="lead_district"
              [(ngModel)]="addCustomerForm.lead_district"
              class="form-control"
            />
          </div>
        </div>
        <div class="col-md-6">
          <div class="form-group">
            <label for="">Sharing Percentage</label>
            <input
              type="number"
              name="sharing_percentage"
              [(ngModel)]="addCustomerForm.sharing_percentage"
              class="form-control"
            />
          </div>
        </div>
      </div>

      <div class="row">
        <div class="col-md-6">
          <div class="form-group">
            <label for="">Customer Birthday</label>
            <input
              type="date"
              name="lead_birthday"
              [(ngModel)]="addCustomerForm.lead_birthday"
              class="form-control"
            />
          </div>
        </div>
      </div>
    </modal-content>
    <modal-footer>
      <button class="btn btn-secondary" (click)="addCustomer.close()">
        close
      </button>
    </modal-footer>
  </modal>

  <!-- cheque books -->

  <modal
    #printPaymentCollectionModal
    title="Print Payment collection"
    submitButtonLabel="submit"
    modalClass="modal-lg"
    [hideCloseButton]="true"
    [closeOnOutsideClick]="true"
    (onSubmit)="submitPrintPaymentCollectioModal(printPaymentCollectionModal)"
  >
    <modal-header> </modal-header>
    <modal-content>
      <div class="form-group">
        <label for="">Developer Name:</label>
        <select
          [(ngModel)]="developer_id"
          class="form-control"
          id="input-name"
          name="developer_id"
        >
          <option *ngFor="let developer of developers" [value]="developer.id">
            {{ developer.name }}
          </option>
        </select>
      </div>
      <div class="form-group">
        <label for="">Cheque book name :</label>
        <input
          type="text"
          class="form-control"
          [(ngModel)]="cheque_book_name"
        />
      </div>
      <div class="form-group">
        <label for="">Name on cheques :</label>
        <input type="text" class="form-control" [(ngModel)]="name_on_cheques" />
      </div>
    </modal-content>
    <modal-footer>
      <button
        class="btn btn-secondary"
        (click)="printPaymentCollectionModal.close()"
      >
        close
      </button>
    </modal-footer>
  </modal>

  <modal
    #enableReminder
    title="Enable Reminder"
    submitButtonLabel="Enable"
    modalClass="modal-lg"
    [hideCloseButton]="true"
    [closeOnOutsideClick]="true"
    (onSubmit)="submitEnableReminder(enableReminder)"
  >
    <modal-header> </modal-header>
    <modal-content>
      <div class="form-group">
        <label for="">Reason:</label>
        <input
          type="text"
          class="form-control"
          name="reminder_reason"
          [(ngModel)]="reminder_reason"
        />
      </div>
    </modal-content>
    <modal-footer>
      <button class="btn btn-secondary" (click)="enableReminder.close()">
        close
      </button>
    </modal-footer>
  </modal>

  <modal
    #disableReminder
    title="Disable Reminder"
    submitButtonLabel="Disable"
    modalClass="modal-lg"
    [hideCloseButton]="true"
    [closeOnOutsideClick]="true"
    (onSubmit)="submitDisableReminder(disableReminder)"
  >
    <modal-header> </modal-header>
    <modal-content>
      <div class="form-group">
        <label for="">Reason:</label>
        <input
          type="text"
          class="form-control"
          name="reminder_reason"
          [(ngModel)]="reminder_reason"
        />
      </div>
    </modal-content>
    <modal-footer>
      <button class="btn btn-secondary" (click)="disableReminder.close()">
        close
      </button>
    </modal-footer>
  </modal>

  <modal
    #uploadScannedCheques
    title="Upload Cheque"
    submitButtonLabel="submit"
    modalClass="modal-lg"
    [hideCloseButton]="true"
    [closeOnOutsideClick]="true"
    (onSubmit)="uploadScannedChequeSubmit(uploadScannedCheques)"
  >
    <modal-header> </modal-header>
    <modal-content>
      <form [formGroup]="filesForm">
        <div class="form-group flex-column">
          <label for="">Cheque</label>
          <input
            type="file"
            id="scanned_cheque"
            (change)="handleUploadScannedCheque($event)"
          />
        </div>
      </form>
    </modal-content>
    <modal-footer>
      <button class="btn btn-secondary" (click)="uploadScannedCheques.close()">
        close
      </button>
    </modal-footer>
  </modal>

  <modal
    #rejectPaymentCollectionModal
    title="Reject Payments"
    submitButtonLabel="Reject"
    modalClass="modal-md"
    [hideCloseButton]="true"
    [closeOnOutsideClick]="true"
    (onSubmit)="submitRejectCheque(rejectPaymentCollectionModal)"
  >
    <modal-header> </modal-header>
    <modal-content>
      <div class="row">
        <form>
          <div class="form-group col-xs-12">
            <label for="" class="price-label">Reject Reason :</label>
            <select
              class="form-control"
              name="reject_reason"
              [(ngModel)]="reject_reason"
            >
              <option value="wrong signature">wrong signature</option>
              <option value="insufficient funds">insufficient funds</option>
              <option value="other">other</option>
            </select>
          </div>
          <div class="form-group col-xs-12" *ngIf="reject_reason == 'other'">
            <label for="" class="price-label">Comment :</label>
            <input
              type="text"
              [(ngModel)]="reject_comment"
              name="reject_comment"
              class="form-control"
            />
          </div>
        </form>
      </div>
    </modal-content>
    <modal-footer>
      <button
        class="btn btn-secondary"
        (click)="rejectPaymentCollectionModal.close()"
      >
        close
      </button>
    </modal-footer>
  </modal>

  <modal
    #collectCheque
    title="Collect Cheque"
    submitButtonLabel="Collect"
    modalClass="modal-lg"
    [hideCloseButton]="true"
    [closeOnOutsideClick]="true"
    (onSubmit)="submitCollectCheque(collectCheque)"
  >
    <modal-header> </modal-header>
    <modal-content>
      <div class="form-group">
        <label for="collection_date">Collect Date:</label>
        <input
          type="date"
          class="form-control"
          name="collection_date"
          [(ngModel)]="collection_date"
        />
      </div>
      <div class="form-group">
        <label for="">Type:</label>
        <select
          class="form-control"
          [(ngModel)]="collect_type"
          name="collect_type"
        >
          <option value="fully-collected">Fully</option>
          <option
            value="partially-collected"
            [disabled]="chequeCollectType == 'multiple'"
          >
            Partially
          </option>
        </select>
      </div>
      <div class="form-group">
        <label for="chequeCollectCustomer">Customer:</label>
        <select
          class="form-control"
          [(ngModel)]="chequeCollectCustomer"
          name="chequeCollectCustomer"
        >
          <option value="" disabled hidden></option>
          <option
            value="{{ customer.lead_id }}"
            *ngFor="let customer of reservation_details?.sharing_leads"
          >
            {{ customer.lead_name }}
          </option>
        </select>
      </div>
      <div class="form-group">
        <label for="">Method:</label>
        <select
          class="form-control"
          [(ngModel)]="partially_method"
          name="partially_method"
        >
          <option value="1">Cash</option>
          <option value="2">Visa</option>
          <option value="3">Bank Transfer</option>
          <option value="4">Cheque</option>
        </select>
      </div>
      <div class="form-group" *ngIf="collect_type == 'partially-collected'">
        <label for="">Amount:</label>
        <input
          type="text"
          class="form-control"
          name="cheque_amount"
          [(ngModel)]="cheque_amount"
        />
      </div>
      <div
        class="form-group"
        *ngIf="collect_type == 'partially-collected' && partially_method == '3'"
      >
        <label for="">Cheque Number:</label>
        <input
          type="number"
          class="form-control"
          name="partially_data"
          [(ngModel)]="partially_data"
        />
      </div>
    </modal-content>
    <modal-footer>
      <button class="btn btn-secondary" (click)="collectCheque.close()">
        close
      </button>
    </modal-footer>
  </modal>

  <modal
    #acknowledgmentForm
    title="{{ acknowledgementForm?.title }}"
    submitButtonLabel="Submit"
    modalClass="modal-lg modal-arabic"
    [hideCloseButton]="true"
    [closeOnOutsideClick]="true"
    (onSubmit)="onSubmitAcknowledgment(acknowledgmentForm)"
  >
    <modal-header> </modal-header>
    <modal-content>
      <form
        *ngIf="acknowledgementForm"
        [formGroup]="acknowledgementForm?.form"
        class="row arabic-fields"
      >
        <div
          class="col-xs-6 form-group"
          *ngFor="let control of acknowledgementForm?.controls"
        >
          <ng-container *ngIf="control?.type == 'select'">
            <div class="form-group">
              <div class="form-group">
                <label for="">{{ control?.label }}</label>
                <select
                  class="form-control"
                  formControlName="{{ control.name }}"
                  name="{{ control.name }}"
                >
                  <option
                    *ngFor="let option of control?.options"
                    [value]="option.lead_id"
                  >
                    {{ option[control.bindValue] }}
                  </option>
                </select>
              </div>
            </div>
          </ng-container>
          <ng-container
            *ngIf="
              control?.type == 'date' ||
              control?.type == 'text' ||
              control?.type == 'email' ||
              control?.type == 'tel'
            "
          >
            <div class="form-group">
              <label for="{{ control?.name }}">{{ control?.label }}</label>
              <input
                type="{{ control.type }}"
                class="form-control"
                name="{{ control.name }}"
                formControlName="{{ control.name }}"
                [attr.readonly]="control.disabled"
              />
            </div>
          </ng-container>
          <ng-container *ngIf="control?.type == 'textarea'">
            <div class="form-group">
              <label for="{{ control?.name }}">{{ control?.label }}</label>
              <textarea
                class="form-control"
                name="{{ control.name }}"
                cols="30"
                rows="2"
                formControlName="{{ control.name }}"
              ></textarea>
            </div>
          </ng-container>
          <ng-container *ngIf="control?.type == 'unit_id'">
            <div class="form-group">
              <label for="unit_serial">Unit Serial</label>
              <div class="search-btn-container">
                <div>
                  <input
                    ng2-auto-complete
                    autocomplete="off"
                    placeholder="البحث عن الوحدة المراد التحويل"
                    [source]="control.observableSource.bind(this)"
                    class="form-control"
                    name="unit_serial"
                    formControlName="{{ control.name }}"
                    (ngModelChange)="control.valueChanged($event)"
                    required
                  />
                </div>
              </div>
            </div>
          </ng-container>
        </div>
      </form>
    </modal-content>
    <modal-footer>
      <button class="btn btn-secondary" (click)="acknowledgmentForm.close()">
        close
      </button>
    </modal-footer>
  </modal>

  <modal
    #collectChequeFine
    title="Collect Fine Cheque"
    submitButtonLabel="Collect"
    modalClass="modal-lg"
    [hideCloseButton]="true"
    [closeOnOutsideClick]="true"
    (onSubmit)="submitCollectChequeFine(collectChequeFine)"
  >
    <modal-header> </modal-header>
    <modal-content>
      <div class="form-group">
        <label for="collection_date_fine">Collect Date:</label>
        <input
          type="date"
          class="form-control"
          name="collection_date_fine"
          [(ngModel)]="collection_date_fine"
        />
      </div>
      <div class="form-group">
        <label for="">Type:</label>
        <select
          class="form-control"
          [(ngModel)]="collect_type_fine"
          name="collect_type_fine"
        >
          <option value="fully-collected">Fully</option>
          <option
            value="partially-collected"
            [disabled]="chequeCollectTypeFine == 'multiple'"
          >
            Partially
          </option>
        </select>
      </div>
      <div class="form-group">
        <label for="chequeCollectCustomerFines">Customer:</label>
        <select
          class="form-control"
          [(ngModel)]="chequeCollectCustomerFines"
          name="chequeCollectCustomerFines"
        >
          <option value="" disabled hidden></option>
          <option
            value="{{ customer.lead_id }}"
            *ngFor="let customer of reservation_details?.sharing_leads"
          >
            {{ customer.lead_name }}
          </option>
        </select>
      </div>
      <div class="form-group">
        <label for="">Method:</label>
        <select
          class="form-control"
          [(ngModel)]="partially_method_fines"
          name="partially_method_fines"
        >
          <option value="1">Cash</option>
          <option value="2">Visa</option>
          <option value="3">Bank Transfer</option>
          <option value="4">Cheque</option>
          <option value="5">Cash Insted Of Cheque</option>
        </select>
      </div>
      <div
        class="form-group"
        *ngIf="collect_type_fine == 'partially-collected'"
      >
        <label for="">Amount:</label>
        <input
          type="text"
          class="form-control"
          name="cheque_amount_fines"
          [(ngModel)]="cheque_amount_fines"
        />
      </div>
      <div
        class="form-group"
        *ngIf="
          collect_type_fine == 'partially-collected' &&
          partially_method_fines == '3'
        "
      >
        <label for="">Cheque Number:</label>
        <input
          type="number"
          class="form-control"
          name="partially_data_fines"
          [(ngModel)]="partially_data_fines"
        />
      </div>
    </modal-content>
    <modal-footer>
      <button class="btn btn-secondary" (click)="collectChequeFine.close()">
        close
      </button>
    </modal-footer>
  </modal>

  <modal
    #addChequeModal
    title="Add Payment"
    submitButtonLabel="submit"
    modalClass="modal-lg"
    [hideCloseButton]="true"
    [closeOnOutsideClick]="true"
    (onSubmit)="addChequeBook(addChequeModal)"
  >
    <modal-header> </modal-header>
    <modal-content>
      <div class="row">
        <div class="col-md-4">
          <div class="form-group">
            <label for="name">Name :</label>
            <input
              type="text"
              class="form-control min-width-200"
              [(ngModel)]="add_cheque.name"
              name="name"
            />
          </div>
        </div>
        <div class="col-md-4">
          <div class="form-group">
            <label for="">Bank Name :</label>
            <select
              class="form-control min-width-200"
              [(ngModel)]="add_cheque.bank_id"
              name="bank_id"
            >
              <option *ngFor="let bank of banks" [value]="bank.id">
                {{ bank.name }}
              </option>
            </select>
          </div>
        </div>
        <div class="col-md-4">
          <div class="form-group">
            <label for="">Store Bank Name :</label>
            <select
              class="form-control min-width-200"
              [(ngModel)]="add_cheque.store_status"
              name="store_status"
            >
              <option *ngFor="let bank of store_banks" [value]="bank.id">
                {{ bank.name }}
              </option>
            </select>
          </div>
        </div>
        <div class="col-md-4">
          <div class="form-group">
            <label for="">Cheque Number :</label>
            <input
              type="number"
              class="form-control"
              [(ngModel)]="add_cheque.cheque_number"
              name="cheque_number"
            />
          </div>
        </div>
        <div class="col-md-4">
          <div class="form-group">
            <label for="">Amount :</label>
            <input
              type="text"
              class="form-control"
              [(ngModel)]="add_cheque.amount"
              name="amount"
            />
          </div>
        </div>
        <div class="col-md-4">
          <div class="form-group">
            <label for="">Date :</label>
            <input
              type="date"
              class="form-control"
              [(ngModel)]="add_cheque.date"
              name="date"
            />
          </div>
        </div>
        <div class="col-md-4">
          <div class="form-group">
            <label for="">Type :</label>
            <select
              class="form-control min-width-200"
              [(ngModel)]="add_cheque.type"
              name="type"
            >
              <option value="1">Down Payment</option>
              <option value="2">Installment</option>
              <option value="3">Extra</option>
              <option value="3">Visa Instance</option>
            </select>
          </div>
        </div>
      </div>
    </modal-content>
    <modal-footer>
      <button class="btn btn-secondary" (click)="addChequeModal.close()">
        close
      </button>
    </modal-footer>
  </modal>

  <modal
    #addCDB
    title="Collect Cheque"
    submitButtonLabel="Collect"
    modalClass="modal-lg"
    [hideCloseButton]="true"
    [closeOnOutsideClick]="true"
    (onOpen)="openaddCDB()"
    (onSubmit)="submitaddCDB(addCDB)"
  >
    <modal-header> </modal-header>
    <modal-content>
      <div class="form-group">
        <label for="cdb_form_amount">Amount:</label>
        <input
          type="number"
          class="form-control"
          name="cdb_form_amount"
          [(ngModel)]="cdb_form.amount"
        />
      </div>
      <div class="form-group">
        <label for="cdb_form_date">Date:</label>
        <input
          type="date"
          class="form-control"
          name="cdb_form_date"
          [(ngModel)]="cdb_form.date"
        />
      </div>
    </modal-content>
    <modal-footer>
      <button class="btn btn-secondary" (click)="addCDB.close()">close</button>
    </modal-footer>
  </modal>

  <modal
    #cancelCheque
    title="Cancel Cheque"
    submitButtonLabel="Cancel"
    modalClass="modal-lg"
    [hideCloseButton]="true"
    [closeOnOutsideClick]="true"
    (onSubmit)="cancleForm.valid && submitCancelCheque(cancelCheque)"
  >
    <modal-header> </modal-header>
    <modal-content>
      <form #cancleForm="ngForm">
        <div class="form-group">
          <label for="">Cancel For:</label>
          <select
            class="form-control"
            [(ngModel)]="cancle_formdata.cancel_for"
            required
            name="partially_method"
            (ngModelChange)="
              cancle_formdata.early_payment_discount = 0;
              cancle_formdata.date = ''
            "
            #change_method_input="ngModel"
          >
            <option value="" selected>Change Method</option>
            <option value="early_payment">Early Payment</option>
            <option value="under-collection">Under Collection</option>
          </select>
        </div>
        <ng-container *ngIf="change_method_input.value !== 'under-collection'">
          <div
            class="form-group"
            *ngIf="change_method_input.value === 'early_payment'"
          >
            <label for="early_payment_discount">Early Payment Discount:</label>
            <input
              type="number"
              name="early_payment_discount"
              id="early_payment_discount"
              class="form-control"
              [(ngModel)]="cancle_formdata.early_payment_discount"
            />
          </div>
          <div
            class="form-group"
            *ngIf="change_method_input.value === 'early_payment'"
          >
            <label for="early_payment_date">Due Date:</label>
            <input
              type="date"
              name="early_payment_date"
              id="early_payment_date"
              class="form-control"
              [(ngModel)]="cancle_formdata.date"
            />
          </div>
          <div class="form-group">
            <label for="">Method:</label>
            <select
              class="form-control"
              [(ngModel)]="cancle_formdata.partially_method"
              required
              name="partially_method"
            >
              <ng-container
                *ngIf="
                  userProfile.role == 'Admin' ||
                  userProfile.role == 'Super Development' ||
                  userProfile.role == 'CFO' ||
                  userProfile.role === 'A.R Accountant'
                "
              >
                <option value="1">Cash</option>
                <option value="2">Visa</option>
                <option value="3">Bank Transfer</option>
              </ng-container>
              <option value="4">Cheque</option>
            </select>
          </div>
          <div class="form-group">
            <label for="">Cheque / Transaction No.:</label>
            <input
              type="number"
              class="form-control"
              name="cheque_number"
              [(ngModel)]="cancle_formdata.cheque_number"
            />
          </div>
          <div class="form-group">
            <label for="bank_id">Bank</label>
            <select
              class="form-control"
              [(ngModel)]="cancle_formdata.bank_id"
              name="bank_id"
            >
              <option *ngFor="let bank of banks" [value]="bank.id">
                {{ bank.name }}
              </option>
            </select>
          </div>
          <div class="form-group">
            <label for="store_status">Location</label>
            <select
              class="form-control"
              [(ngModel)]="cancle_formdata.store_status"
              name="store_status"
              required
            >
              <option *ngFor="let bank of store_banks" [value]="bank.id">
                {{ bank.name }}
              </option>
            </select>
          </div>
        </ng-container>
      </form>
    </modal-content>
    <modal-footer>
      <button class="btn btn-secondary" (click)="cancelCheque.close()">
        close
      </button>
    </modal-footer>
  </modal>

  <modal
    #AddDelayFineModal
    title="Add Delay Fine"
    modalClass="modal-md"
    [hideCloseButton]="true"
    [closeOnOutsideClick]="true"
  >
    <modal-header> </modal-header>
    <modal-content>
      <div class="row">
        <form>
          <div class="form-inline col-xs-12">
            <label for="fine_date">Fine Date:</label>
            <input
              type="date"
              style="width: 100%"
              class="form-control"
              name="fine_date"
              [(ngModel)]="add_fineModal.payload.fine_date"
            />
          </div>
          <div class="form-inline col-xs-12">
            <label for="num_days_late">number days late:</label>
            <input
              type="number"
              style="width: 100%"
              class="form-control"
              name="num_days_late"
              [(ngModel)]="add_fineModal.payload.num_days_late"
            />
          </div>
          <div class="form-inline col-xs-12">
            <label for="amount">Amount:</label>
            <input
              type="number"
              style="width: 100%"
              class="form-control"
              name="amount"
              [(ngModel)]="add_fineModal.payload.amount"
            />
          </div>
        </form>
      </div>
    </modal-content>
    <modal-footer>
      <button class="btn btn-secondary" (click)="AddDelayFineModal.close()">
        close
      </button>
      <button
        class="btn btn-success"
        [disabled]="submitting_add_fine"
        (click)="addDelayFineToCheque(AddDelayFineModal)"
      >
        Submit
      </button>
    </modal-footer>
  </modal>
</ng-container>

<modal
  #changeBasementModal
  title="Change Basement Data"
  submitButtonLabel="submit"
  modalClass="modal-md"
  [hideCloseButton]="true"
  [closeOnOutsideClick]="true"
  (onSubmit)="
    submitChangeBasementModal(reservation_details, changeBasementModal)
  "
>
  <modal-header> </modal-header>
  <modal-content>
    <div class="row">
      <form>
        <div class="form-group col-xs-6">
          <label for="basement_area">Basement Area</label>
          <input
            type="text"
            class="form-control"
            name="basement_area"
            [(ngModel)]="basement_area"
          />
        </div>
        <div class="form-group col-xs-6">
          <label for="basement_price">Basement Price</label>
          <input
            type="text"
            class="form-control"
            name="basement_price"
            [(ngModel)]="basement_price"
          />
        </div>
        <div class="form-group col-xs-6">
          <label for="has_basement">Has Basement</label>
          <input
            type="checkbox"
            name="has_basement"
            [(ngModel)]="has_basement"
          />
        </div>
      </form>
    </div>
  </modal-content>
  <modal-footer>
    <button class="btn btn-secondary" (click)="changeBasementModal.close()">
      close
    </button>
  </modal-footer>
</modal>

<modal
  #assignBrokerIncentiveModal
  title="Assign Broker Incentive"
  submitButtonLabel="submit"
  modalClass="modal-md"
  [hideCloseButton]="true"
  [closeOnOutsideClick]="true"
  (onSubmit)="assignBrokerIncentive(assignBrokerIncentiveModal)"
>
  <modal-header> </modal-header>
  <modal-content>
    <form action="">
      <div class="row search">
        <div class="col-xs-6 form-group">
          <label for="broker_incentive_id">Broker Incentive</label>
          <ng-select
            name="broker_incentive_id"
            [(ngModel)]="broker_incentive_id"
          >
            <ng-option *ngFor="let user of incentive_users" [value]="user.id">
              {{ user.name }}
            </ng-option>
          </ng-select>
        </div>
      </div>
    </form>
  </modal-content>
  <modal-footer>
    <button
      class="btn btn-secondary"
      (click)="assignBrokerIncentiveModal.close()"
    >
      close
    </button>
  </modal-footer>
</modal>
